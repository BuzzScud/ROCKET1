<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - The Rocket Trading Group</title>
    <link href="https://cdn.jsdelivr.net/npm/preline@2.0.0/dist/preline.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js for Financial Analysis -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Chart.js adapter for dates -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <!-- Chart.js Financial plugin for candlestick charts -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial@0.2.1/dist/chartjs-chart-financial.min.js"></script>
    <!-- Axios for API requests -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        /* Dark Theme Variables */
        :root {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --bg-quaternary: #30363d;
            --text-primary: #f0f6fc;
            --text-secondary: #c9d1d9;
            --text-muted: #8b949e;
            --border-color: #30363d;
            --border-light: #21262d;
            --accent-blue: #58a6ff;
            --accent-green: #56d364;
            --accent-red: #f85149;
            --accent-yellow: #e3b341;
            --accent-purple: #a5a5ff;
            --accent-muted: #6e7681;
            --hover-bg: #21262d;
            --sidebar-bg: #0d1117;
        }

        body {
            background-color: var(--bg-primary) !important;
            color: var(--text-primary) !important;
        }

        .sidebar {
            transition: transform 0.3s ease-in-out;
            background-color: var(--sidebar-bg) !important;
            border-right: 1px solid var(--border-color) !important;
        }
        
        .sidebar-hidden {
            transform: translateX(-100%);
        }
        
        /* Ensure sidebar stays visible on desktop */
        @media (min-width: 1024px) {
            .sidebar {
                transform: translateX(0) !important;
                display: block !important;
                visibility: visible !important;
            }
            .sidebar-hidden {
                transform: translateX(0) !important;
            }
        }
        
        /* Proper main content spacing */
        .main-content {
            margin-left: 0;
            background-color: var(--bg-primary) !important;
        }
        
        @media (min-width: 1024px) {
            .main-content {
                margin-left: 16rem; /* 256px = w-64 */
            }
        }

        /* Tailwind CSS Dropdown Styling */
        .dropdown-menu {
            /* Tailwind CSS dropdown shadow and background */
            backdrop-filter: blur(20px);
            background: var(--bg-tertiary) !important;
            border: 1px solid var(--border-color) !important;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5) !important;
            transform: scale(0.95);
            opacity: 0;
            transition: all 0.1s ease-in-out;
        }

        .dropdown-menu.show {
            transform: scale(1);
            opacity: 1;
        }

        /* Dropdown item hover effects */
        .dropdown-item {
            transition: all 0.15s ease-in-out;
        }

        .dropdown-item:hover {
            background-color: var(--hover-bg) !important;
            color: var(--text-primary) !important;
        }

        /* Custom select dropdown styling */
        .custom-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
        }

        .card-hover {
            transition: all 0.3s ease;
            background-color: var(--bg-secondary) !important;
            border: 1px solid var(--border-color) !important;
        }
        
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.4) !important;
            border-color: var(--border-light) !important;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, var(--accent-muted) 0%, var(--bg-quaternary) 100%) !important;
        }
        
        .glass-effect {
            backdrop-filter: blur(20px);
            background: rgba(33, 38, 45, 0.8) !important;
            border: 1px solid var(--border-color) !important;
        }

        /* Override all white backgrounds */
        .bg-white {
            background-color: var(--bg-secondary) !important;
            border: 1px solid var(--border-color) !important;
        }

        .bg-gray-50 {
            background-color: var(--bg-primary) !important;
        }

        .bg-gray-100 {
            background-color: var(--hover-bg) !important;
        }

        /* Text color overrides */
        .text-gray-900 {
            color: var(--text-primary) !important;
        }

        .text-gray-700 {
            color: var(--text-secondary) !important;
        }

        .text-gray-600 {
            color: var(--text-muted) !important;
        }

        .text-gray-500 {
            color: var(--text-muted) !important;
        }

        .text-gray-400 {
            color: var(--accent-muted) !important;
        }

        /* Border color overrides */
        .border-gray-200, .border-gray-300, .border-b {
            border-color: var(--border-color) !important;
        }

        .divide-gray-200 > * + * {
            border-color: var(--border-color) !important;
        }

        /* Form inputs */
        input, select, textarea {
            background-color: var(--bg-tertiary) !important;
            border-color: var(--border-color) !important;
            color: var(--text-primary) !important;
        }

        input:focus, select:focus, textarea:focus {
            border-color: var(--accent-blue) !important;
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.1) !important;
        }

        input::placeholder {
            color: var(--text-muted) !important;
        }

        /* Navigation links */
        .nav-link {
            color: var(--text-secondary) !important;
            transition: all 0.2s ease;
        }

        .nav-link:hover {
            background-color: var(--hover-bg) !important;
            color: var(--text-primary) !important;
        }

        .nav-link.active {
            background-color: var(--accent-muted) !important;
            color: var(--text-primary) !important;
        }

        /* Button color adjustments */
        .bg-indigo-600, .bg-blue-600 {
            background-color: var(--accent-blue) !important;
        }

        .bg-indigo-700, .bg-blue-700 {
            background-color: #4d8df0 !important;
        }

        .hover\:bg-indigo-700:hover, .hover\:bg-blue-700:hover {
            background-color: #4d8df0 !important;
        }

        .bg-green-600, .bg-green-500 {
            background-color: var(--accent-green) !important;
        }
        
        /* Line clamp utility for notes */
        .line-clamp-4 {
            display: -webkit-box;
            -webkit-line-clamp: 4;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .bg-green-700 {
            background-color: #46c957 !important;
        }

        .hover\:bg-green-700:hover {
            background-color: #46c957 !important;
        }

        .bg-red-500, .bg-red-600 {
            background-color: var(--accent-red) !important;
        }

        .hover\:bg-red-600:hover {
            background-color: #e5484d !important;
        }

        /* Badge backgrounds with muted colors */
        .bg-green-100 {
            background-color: rgba(86, 211, 100, 0.15) !important;
        }

        .text-green-800, .text-green-600 {
            color: var(--accent-green) !important;
        }

        .bg-blue-100 {
            background-color: rgba(88, 166, 255, 0.15) !important;
        }

        .text-blue-800, .text-blue-600 {
            color: var(--accent-blue) !important;
        }

        .bg-yellow-100 {
            background-color: rgba(227, 179, 65, 0.15) !important;
        }

        .text-yellow-800, .text-yellow-600 {
            color: var(--accent-yellow) !important;
        }

        .bg-purple-100 {
            background-color: rgba(165, 165, 255, 0.15) !important;
        }

        .text-purple-800, .text-purple-600 {
            color: var(--accent-purple) !important;
        }

        .bg-red-100 {
            background-color: rgba(248, 81, 73, 0.15) !important;
        }

        .text-red-800, .text-red-600 {
            color: var(--accent-red) !important;
        }

        .text-indigo-600 {
            color: var(--accent-blue) !important;
        }

        /* Shadow adjustments */
        .shadow-lg {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.2) !important;
        }

        .shadow {
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.3), 0 1px 2px 0 rgba(0, 0, 0, 0.2) !important;
        }

        .shadow-md {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2) !important;
        }

        .shadow-sm {
            background-color: var(--bg-secondary) !important;
            border-bottom: 1px solid var(--border-color) !important;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.3) !important;
        }

        /* Numerology forecast muted gradient */
        .bg-gradient-to-r {
            background: linear-gradient(to right, var(--bg-quaternary), var(--accent-muted)) !important;
        }

        /* Chart backgrounds */
        #stockChart, #energyChart {
            background-color: var(--bg-tertiary) !important;
        }

        /* Progress bars */
        .bg-gray-200 {
            background-color: var(--bg-tertiary) !important;
        }

        /* Modal overlay */
        .bg-black {
            background-color: rgba(0, 0, 0, 0.8) !important;
        }

        /* Tables */
        .bg-gray-50 thead {
            background-color: var(--bg-tertiary) !important;
        }

        /* Active states */
        .bg-indigo-50 {
            background-color: rgba(88, 166, 255, 0.1) !important;
        }

        .text-indigo-600 {
            color: var(--accent-blue) !important;
        }

        /* Animation for fade-in */
        .animate-fade-in {
            animation: fadeIn 0.8s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Hide scrollbar for all elements while maintaining scroll functionality */
        /* Global scrollbar hiding */
        * {
            /* Hide scrollbar for webkit browsers (Chrome, Safari, Edge) */
            -webkit-scrollbar {
                display: none;
            }
            /* Hide scrollbar for Firefox */
            scrollbar-width: none;
            /* Hide scrollbar for IE and older Edge */
            -ms-overflow-style: none;
        }

        /* Ensure scrollbars stay hidden on all elements */
        *::-webkit-scrollbar {
            display: none;
        }

        /* Specific body scrollbar hiding */
        body {
            -webkit-scrollbar: none;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        body::-webkit-scrollbar {
            display: none;
        }

        /* Hide scrollbar for common scrollable elements */
        .overflow-y-auto, .overflow-x-auto, .overflow-auto {
            -webkit-scrollbar: none;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .overflow-y-auto::-webkit-scrollbar, 
        .overflow-x-auto::-webkit-scrollbar, 
        .overflow-auto::-webkit-scrollbar {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div id="sidebar" class="sidebar fixed inset-y-0 left-0 z-50 w-64 bg-white shadow-lg">
        <div class="flex h-full flex-col">
            <!-- Logo -->
            <div class="flex h-16 items-center justify-between px-6 border-b">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-blue-600 to-purple-700 rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2L13.09 8.26L22 9.27L17.5 12.74L18.18 21.5L12 18.77L5.82 21.5L6.5 12.74L2 9.27L10.91 8.26L12 2Z"/>
                        </svg>
                    </div>
                    <h1 class="text-lg font-bold text-gray-900">The Rocket Trading Group</h1>
                </div>
                <button id="sidebarToggle" class="lg:hidden text-gray-500 hover:text-gray-700">
                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <!-- Navigation -->
            <nav class="flex-1 px-4 py-6 space-y-2">
                <a href="#" class="nav-link active flex items-center px-4 py-2 text-sm font-medium text-indigo-600 bg-indigo-50 rounded-lg" data-page="dashboard" onclick="navigateToPage('dashboard'); return false;">
                    <svg class="mr-3 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5a2 2 0 012-2h4a2 2 0 012 2v4H8V5z"></path>
                    </svg>
                    Dashboard
                </a>
                
                <a href="#" class="nav-link flex items-center px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg" data-page="analytics" onclick="navigateToPage('analytics'); return false;">
                    <svg class="mr-3 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                    </svg>
                    Analytics
                </a>
                
                <a href="#" class="nav-link flex items-center px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg" data-page="projects" onclick="navigateToPage('projects'); return false;">
                    <svg class="mr-3 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                    </svg>
                    Projects
                </a>
                


                
                <a href="#" class="nav-link flex items-center px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg" data-page="financial-analysis" onclick="navigateToPage('financial-analysis'); return false;">
                    <svg class="mr-3 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                    </svg>
                    Financial Analysis
                </a>
                
                <a href="#" class="nav-link flex items-center px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg" data-page="signals" onclick="navigateToPage('signals'); return false;">
                    <svg class="mr-3 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                    Signal Generator
                </a>
                
                <a href="#" class="nav-link flex items-center px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg" data-page="charts" onclick="navigateToPage('charts'); return false;">
                    <svg class="mr-3 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"></path>
                    </svg>
                    Financial Charts
                </a>
                
                <a href="#" class="nav-link flex items-center px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg" data-page="options-calculator" onclick="navigateToPage('options-calculator'); return false;">
                    <svg class="mr-3 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                    </svg>
                    Options Calculator
                </a>
                
                <a href="#" class="nav-link flex items-center px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg" data-page="notes" onclick="navigateToPage('notes'); return false;">
                    <svg class="mr-3 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                    </svg>
                    Notes
                </a>
            </nav>
            
            <!-- Notification Bell at Bottom -->
            <div class="px-4 py-6 border-t">
                <div class="relative">
                    <button id="notificationBell" class="flex items-center w-full px-4 py-3 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-lg transition-colors">
                        <svg class="mr-3 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
                        </svg>
                        <span class="flex-1 text-left">Notifications</span>
                        <span id="notificationCount" class="h-5 w-5 bg-red-500 rounded-full text-xs text-white flex items-center justify-center">3</span>
                    </button>
                    
                    <!-- Tailwind CSS Notification Dropdown -->
                    <div id="notificationDropdown" class="dropdown-menu absolute bottom-full left-0 right-0 mb-2 w-80 bg-white rounded-lg shadow-xl ring-1 ring-black ring-opacity-5 hidden z-50">
                        <div class="p-4">
                            <div class="flex items-center justify-between mb-3">
                                <h3 class="text-sm font-semibold text-gray-900">Notifications</h3>
                                <button id="markAllRead" class="dropdown-item text-xs text-indigo-600 hover:text-indigo-800 px-2 py-1 rounded">Mark all as read</button>
                            </div>
                            <div class="space-y-1 max-h-64 overflow-y-auto" id="notificationList">
                                <!-- Notifications will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Bar -->
        <div class="bg-white shadow-sm border-b border-gray-200">
            <div class="px-4 sm:px-6 lg:px-8">
                <div class="flex h-16 items-center justify-between">
                    <!-- Mobile menu button -->
                    <button id="mobileMenuToggle" class="lg:hidden text-gray-500 hover:text-gray-700">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                    
                    <!-- Search Bar -->
                    <div class="flex-1 max-w-2xl mx-4 relative">
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                            </div>
                            <input 
                                type="text" 
                                id="searchInput"
                                class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg text-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
                                placeholder="Search anything..."
                            >
                        </div>
                        
                        <!-- Tailwind CSS Search Results Dropdown -->
                        <div id="searchResults" class="dropdown-menu absolute top-full left-0 right-0 mt-1 bg-white rounded-lg shadow-xl ring-1 ring-black ring-opacity-5 divide-y divide-gray-100 hidden z-50">
                            <div class="p-4">
                                <div class="text-sm text-gray-500 mb-2">Recent searches</div>
                                <div class="space-y-1" id="searchResultsList">
                                    <!-- Search results will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Profile Widget -->
                    <div class="flex items-center space-x-4">


                        
                        <!-- Profile Dropdown -->
                        <div class="relative">
                            <button id="profileButton" class="flex items-center space-x-2 text-gray-700 hover:text-gray-900">
                                <div class="h-8 w-8 rounded-full bg-indigo-500 flex items-center justify-center">
                                    <span class="text-white text-sm font-medium" id="profileInitials">U</span>
                                </div>
                                <span class="text-sm font-medium hidden sm:block" id="profileName">User</span>
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </button>
                            
                            <!-- Tailwind CSS Profile Dropdown -->
                            <div id="profileDropdown" class="dropdown-menu absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-xl ring-1 ring-black ring-opacity-5 divide-y divide-gray-100 hidden z-50">
                                <div class="py-1">
                                    <div class="px-4 py-3">
                                        <p class="text-sm font-medium text-gray-900" id="dropdownUserName">User</p>
                                        <p class="text-xs text-gray-500" id="dropdownUserEmail">user@example.com</p>
                                    </div>
                                </div>
                                <div class="py-1">
                                    <a href="#" class="dropdown-item group flex items-center px-4 py-2 text-sm text-gray-700" id="profileLink">
                                        <svg class="mr-3 h-4 w-4 text-gray-400 group-hover:text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                        </svg>
                                        Profile
                                    </a>
                                    <a href="#" class="dropdown-item group flex items-center px-4 py-2 text-sm text-gray-700" id="settingsLink">
                                        <svg class="mr-3 h-4 w-4 text-gray-400 group-hover:text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                        </svg>
                                        Settings
                                    </a>
                                    <a href="#" class="dropdown-item group flex items-center px-4 py-2 text-sm text-gray-700" id="preferencesLink">
                                        <svg class="mr-3 h-4 w-4 text-gray-400 group-hover:text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 100 4m0-4v2m0-6V4"></path>
                                        </svg>
                                        Preferences
                                    </a>
                                    <a href="#" class="dropdown-item group flex items-center px-4 py-2 text-sm text-gray-700" id="helpLink">
                                        <svg class="mr-3 h-4 w-4 text-gray-400 group-hover:text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                        Help & Support
                                    </a>
                                    <a href="#" class="dropdown-item group flex items-center px-4 py-2 text-sm text-gray-700" id="adminLink">
                                        <svg class="mr-3 h-4 w-4 text-gray-400 group-hover:text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
                                        </svg>
                                        Admin Panel
                                    </a>
                                </div>
                                <div class="py-1">
                                    <button id="logoutButton" class="dropdown-item group flex items-center w-full px-4 py-2 text-sm text-red-600">
                                        <svg class="mr-3 h-4 w-4 text-red-400 group-hover:text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                                        </svg>
                                        Sign out
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- TradingView Ticker Widget -->
        <div class="bg-gray-900 border-b border-gray-700">
            <!-- TradingView Widget BEGIN -->
            <div class="tradingview-widget-container">
              <div class="tradingview-widget-container__widget"></div>
              <div class="tradingview-widget-copyright"><a href="https://www.tradingview.com/" rel="noopener nofollow" target="_blank"><span class="blue-text">Track all markets on TradingView</span></a></div>
              <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js" async>
              {
              "symbols": [
                {
                  "proName": "FOREXCOM:SPXUSD",
                  "title": "S&P 500 Index"
                },
                {
                  "proName": "FOREXCOM:NSXUSD",
                  "title": "US 100 Cash CFD"
                },
                {
                  "proName": "FX_IDC:EURUSD",
                  "title": "EUR to USD"
                },
                {
                  "proName": "BITSTAMP:BTCUSD",
                  "title": "Bitcoin"
                },
                {
                  "proName": "BINANCE:XLMUSD.P",
                  "title": "XLM"
                },
                {
                  "proName": "CAPITALCOM:US30",
                  "title": "US 30 CASH"
                },
                {
                  "proName": "FX:AUDUSD",
                  "title": "AUDUSD"
                },
                {
                  "proName": "FX:GBPUSD",
                  "title": "GBPUSD"
                },
                {
                  "proName": "NASDAQ:QQQ",
                  "title": "QQQ"
                },
                {
                  "proName": "AMEX:SPY",
                  "title": "SPY"
                },
                {
                  "proName": "NASDAQ:AAPL",
                  "title": "APPLE"
                },
                {
                  "proName": "NASDAQ:META",
                  "title": "META"
                },
                {
                  "proName": "NASDAQ:NVDA",
                  "title": "NVDA"
                }
              ],
              "colorTheme": "dark",
              "locale": "en",
              "largeChartUrl": "",
              "isTransparent": true,
              "showSymbolLogo": true,
              "displayMode": "adaptive"
            }
              </script>
            </div>
            <!-- TradingView Widget END -->
        </div>
        
        <!-- Main Content Area -->
        <main class="p-6">
            <div id="pageContent">
                <!-- Dashboard Content -->
                <div id="dashboardContent" class="page-content">
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold text-gray-900">Dashboard</h1>
                        <p class="text-gray-600">Welcome back! Here's what's happening with your projects.</p>
                    </div>
                    
                    <!-- Stats Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="card-hover bg-white rounded-lg shadow p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600">Total Users</p>
                                    <p class="text-2xl font-bold text-gray-900">1,234</p>
                                </div>
                                <div class="h-12 w-12 gradient-bg rounded-lg flex items-center justify-center">
                                    <svg class="h-6 w-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
                                    </svg>
                                </div>
                            </div>
                            <div class="mt-4">
                                <div class="flex items-center">
                                    <span class="text-sm text-green-600">+12%</span>
                                    <span class="text-sm text-gray-600 ml-2">from last month</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card-hover bg-white rounded-lg shadow p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600">Active Projects</p>
                                    <p class="text-2xl font-bold text-gray-900">56</p>
                                </div>
                                <div class="h-12 w-12 gradient-bg rounded-lg flex items-center justify-center">
                                    <svg class="h-6 w-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                                    </svg>
                                </div>
                            </div>
                            <div class="mt-4">
                                <div class="flex items-center">
                                    <span class="text-sm text-green-600">+8%</span>
                                    <span class="text-sm text-gray-600 ml-2">from last week</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card-hover bg-white rounded-lg shadow p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600">Revenue</p>
                                    <p class="text-2xl font-bold text-gray-900">$12,345</p>
                                </div>
                                <div class="h-12 w-12 gradient-bg rounded-lg flex items-center justify-center">
                                    <svg class="h-6 w-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                                    </svg>
                                </div>
                            </div>
                            <div class="mt-4">
                                <div class="flex items-center">
                                    <span class="text-sm text-green-600">+23%</span>
                                    <span class="text-sm text-gray-600 ml-2">from last month</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card-hover bg-white rounded-lg shadow p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600">Conversion Rate</p>
                                    <p class="text-2xl font-bold text-gray-900">3.2%</p>
                                </div>
                                <div class="h-12 w-12 gradient-bg rounded-lg flex items-center justify-center">
                                    <svg class="h-6 w-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                    </svg>
                                </div>
                            </div>
                            <div class="mt-4">
                                <div class="flex items-center">
                                    <span class="text-sm text-red-600">-2%</span>
                                    <span class="text-sm text-gray-600 ml-2">from last month</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Recent Activity -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Recent Activity</h3>
                            <div class="space-y-4">
                                <div class="flex items-center space-x-3">
                                    <div class="h-8 w-8 bg-blue-100 rounded-full flex items-center justify-center">
                                        <svg class="h-4 w-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                        </svg>
                                    </div>
                                    <div class="flex-1">
                                        <p class="text-sm text-gray-900">New user registered</p>
                                        <p class="text-xs text-gray-500">2 minutes ago</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <div class="h-8 w-8 bg-green-100 rounded-full flex items-center justify-center">
                                        <svg class="h-4 w-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                                        </svg>
                                    </div>
                                    <div class="flex-1">
                                        <p class="text-sm text-gray-900">Project completed</p>
                                        <p class="text-xs text-gray-500">1 hour ago</p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <div class="h-8 w-8 bg-yellow-100 rounded-full flex items-center justify-center">
                                        <svg class="h-4 w-4 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                                        </svg>
                                    </div>
                                    <div class="flex-1">
                                        <p class="text-sm text-gray-900">System maintenance scheduled</p>
                                        <p class="text-xs text-gray-500">3 hours ago</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Quick Actions</h3>
                            <div class="space-y-3">
                                <button onclick="showCreateProjectModal()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                                    <svg class="w-5 h-5 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                    </svg>
                                    Create New Project
                                </button>
                                <button onclick="showInviteTeamModal()" class="w-full bg-white hover:bg-gray-50 text-gray-700 font-medium py-2 px-4 rounded-lg border border-gray-300 transition-colors">
                                    <svg class="w-5 h-5 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"></path>
                                    </svg>
                                    Invite Team Members
                                </button>
                                <button onclick="showPage('analytics')" class="w-full bg-white hover:bg-gray-50 text-gray-700 font-medium py-2 px-4 rounded-lg border border-gray-300 transition-colors">
                                    <svg class="w-5 h-5 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                    </svg>
                                    View Reports
                                </button>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-gray-900">Team Members</h3>
                                <button onclick="showInviteTeamModal()" class="text-sm text-indigo-600 hover:text-indigo-700 font-medium">
                                    <svg class="w-4 h-4 mr-1 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                    </svg>
                                    Invite
                                </button>
                            </div>
                            <div id="teamMembersList" class="space-y-3">
                                <!-- Team members will be populated here -->
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white text-sm font-medium">
                                        JD
                                    </div>
                                    <div class="flex-1">
                                        <p class="text-sm font-medium text-gray-900">John Doe</p>
                                        <p class="text-xs text-gray-500">Developer • Online</p>
                                    </div>
                                    <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-purple-500 rounded-full flex items-center justify-center text-white text-sm font-medium">
                                        JS
                                    </div>
                                    <div class="flex-1">
                                        <p class="text-sm font-medium text-gray-900">Jane Smith</p>
                                        <p class="text-xs text-gray-500">Designer • 2h ago</p>
                                    </div>
                                    <div class="w-2 h-2 bg-gray-400 rounded-full"></div>
                                </div>
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center text-white text-sm font-medium">
                                        MB
                                    </div>
                                    <div class="flex-1">
                                        <p class="text-sm font-medium text-gray-900">Mike Brown</p>
                                        <p class="text-xs text-gray-500">Manager • Online</p>
                                    </div>
                                    <div class="w-2 h-2 bg-green-400 rounded-full"></div>
                                </div>
                                <div id="pendingInvitesList" class="pt-2 border-t border-gray-200">
                                    <!-- Pending invitations will be shown here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Analytics Content -->
                <div id="analyticsContent" class="page-content hidden">
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold text-gray-900">Analytics</h1>
                        <p class="text-gray-600">Monitor your application performance and user engagement.</p>
                    </div>
                    
                    <!-- Market Overview -->
                    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">Market Overview</h3>
                            <button onclick="refreshMarketData()" class="text-sm text-blue-600 hover:text-blue-800 font-medium flex items-center">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                </svg>
                                Refresh
                            </button>
                        </div>
                        <div id="marketOverview" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            <div class="bg-gray-50 rounded-lg p-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-gray-600">S&P 500</p>
                                        <p class="text-xl font-bold text-gray-900">Loading...</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-sm font-medium text-gray-600">...</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-gray-50 rounded-lg p-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-gray-600">NASDAQ</p>
                                        <p class="text-xl font-bold text-gray-900">Loading...</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-sm font-medium text-gray-600">...</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-gray-50 rounded-lg p-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-gray-600">DOW JONES</p>
                                        <p class="text-xl font-bold text-gray-900">Loading...</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-sm font-medium text-gray-600">...</p>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-gray-50 rounded-lg p-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-gray-600">VIX</p>
                                        <p class="text-xl font-bold text-gray-900">Loading...</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-sm font-medium text-gray-600">...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Daily Global Numerology Forecast -->
                    <div class="bg-gradient-to-r from-purple-600 to-indigo-600 rounded-lg shadow-lg p-6 mb-8 text-white">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-2xl font-bold">Daily Global Numerology Forecast</h2>
                            <div class="flex items-center space-x-2">
                                <div class="flex items-center">
                                    <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse mr-2"></div>
                                    <span class="text-sm opacity-80">Live Updates</span>
                                </div>
                                <button onclick="refreshNumerologyForecast()" class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-3 py-1 rounded-lg text-sm font-medium transition-all duration-200 flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                    </svg>
                                    Refresh
                                </button>
                            </div>
                        </div>
                        <div id="numerologyForecast" class="space-y-4">
                            <div id="numerologyLoading" class="text-center py-8">
                                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-white mx-auto mb-4"></div>
                                <p>Calculating today's energy...</p>
                            </div>
                            <div id="numerologyContent" class="hidden">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                                    <div class="bg-white bg-opacity-20 rounded-lg p-4">
                                        <h3 class="font-semibold mb-2">Date</h3>
                                        <p id="forecastDate" class="text-xl font-bold">--</p>
                                    </div>
                                    <div class="bg-white bg-opacity-20 rounded-lg p-4">
                                        <h3 class="font-semibold mb-2">Universal Day Number</h3>
                                        <p id="universalDayNumber" class="text-3xl font-bold">--</p>
                                    </div>
                                    <div class="bg-white bg-opacity-20 rounded-lg p-4">
                                        <h3 class="font-semibold mb-2">Energy Level</h3>
                                        <p id="energyLevel" class="text-xl font-bold">--</p>
                                    </div>
                                </div>
                                <div class="bg-white bg-opacity-20 rounded-lg p-6">
                                    <h3 class="font-semibold mb-3 text-lg">Today's Forecast</h3>
                                    <p id="forecastText" class="text-lg leading-relaxed mb-4">--</p>
                                    <div class="text-sm opacity-80 border-t border-white border-opacity-30 pt-4">
                                        <div class="flex items-center justify-between mb-2">
                                            <span id="lastUpdated" class="text-xs opacity-70">Last updated: --</span>
                                            <span id="nextUpdate" class="text-xs opacity-70">Next update: --</span>
                                        </div>
                                        <p id="disclaimer">These are global tendencies, not personal predictions. Free will prevails, and individual choices shape your day.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Market Progression Steps -->
                    <div class="bg-gray-800 rounded-lg shadow-lg p-6 mb-8 border border-gray-700">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-lg font-semibold text-gray-100">Market Progression Phases</h3>
                            <div class="flex items-center space-x-2">
                                <div class="w-3 h-3 bg-green-400 rounded-full animate-pulse"></div>
                                <span class="text-sm text-gray-300">Live Market Status</span>
                            </div>
                        </div>
                        
                        <div class="relative">
                            <!-- Progress Bar Background -->
                            <div class="absolute top-6 left-0 right-0 h-2 bg-gray-600 rounded-full"></div>
                            
                            <!-- Progress Bar Fill -->
                            <div class="absolute top-6 left-0 h-2 bg-gradient-to-r from-blue-400 via-purple-400 to-green-400 rounded-full transition-all duration-1000 ease-in-out" style="width: 65%"></div>
                            
                            <!-- Progress Steps -->
                            <div class="relative flex justify-between">
                                <!-- Step 1: Market Opening -->
                                <div class="flex flex-col items-center">
                                    <div class="w-12 h-12 bg-green-600 rounded-full flex items-center justify-center mb-2 border-4 border-white shadow-lg">
                                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                    </div>
                                    <div class="text-center">
                                        <h4 class="text-sm font-semibold text-gray-100">Market Opening</h4>
                                        <p class="text-xs text-gray-400">Pre-market Analysis</p>
                                        <div class="mt-1 px-2 py-1 bg-green-800 text-green-200 rounded-full text-xs">Complete</div>
                                    </div>
                                </div>
                                
                                <!-- Step 2: Early Session -->
                                <div class="flex flex-col items-center">
                                    <div class="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center mb-2 border-4 border-white shadow-lg">
                                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                        </svg>
                                    </div>
                                    <div class="text-center">
                                        <h4 class="text-sm font-semibold text-gray-100">Early Session</h4>
                                        <p class="text-xs text-gray-400">High Volume Trading</p>
                                        <div class="mt-1 px-2 py-1 bg-blue-800 text-blue-200 rounded-full text-xs">Complete</div>
                                    </div>
                                </div>
                                
                                <!-- Step 3: Mid-Day Trading -->
                                <div class="flex flex-col items-center">
                                    <div class="w-12 h-12 bg-purple-600 rounded-full flex items-center justify-center mb-2 border-4 border-white shadow-lg">
                                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                        </svg>
                                    </div>
                                    <div class="text-center">
                                        <h4 class="text-sm font-semibold text-gray-100">Mid-Day Trading</h4>
                                        <p class="text-xs text-gray-400">Trend Confirmation</p>
                                        <div class="mt-1 px-2 py-1 bg-purple-800 text-purple-200 rounded-full text-xs">Active</div>
                                    </div>
                                </div>
                                
                                <!-- Step 4: Afternoon Session -->
                                <div class="flex flex-col items-center">
                                    <div class="w-12 h-12 bg-gray-400 rounded-full flex items-center justify-center mb-2 border-4 border-white shadow-lg">
                                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                        </svg>
                                    </div>
                                    <div class="text-center">
                                        <h4 class="text-sm font-semibold text-gray-100">Afternoon Session</h4>
                                        <p class="text-xs text-gray-400">Position Adjustments</p>
                                        <div class="mt-1 px-2 py-1 bg-gray-600 text-gray-300 rounded-full text-xs">Pending</div>
                                    </div>
                                </div>
                                
                                <!-- Step 5: Market Close -->
                                <div class="flex flex-col items-center">
                                    <div class="w-12 h-12 bg-gray-300 rounded-full flex items-center justify-center mb-2 border-4 border-white shadow-lg">
                                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                        </svg>
                                    </div>
                                    <div class="text-center">
                                        <h4 class="text-sm font-semibold text-gray-100">Market Close</h4>
                                        <p class="text-xs text-gray-400">Final Analysis</p>
                                        <div class="mt-1 px-2 py-1 bg-gray-600 text-gray-300 rounded-full text-xs">Pending</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Current Phase Details -->
                        <div class="mt-6 bg-gray-700 rounded-lg p-4 border border-gray-600">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h4 class="text-lg font-semibold text-purple-300">Current Phase: Mid-Day Trading</h4>
                                    <p class="text-sm text-purple-200">Market is in trend confirmation phase with moderate volatility</p>
                                </div>
                                <div class="text-right">
                                    <div class="text-2xl font-bold text-purple-400" id="marketProgressPercent">65%</div>
                                    <div class="text-sm text-purple-300">Progress Today</div>
                                </div>
                            </div>
                            <div class="mt-3 grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="bg-gray-800 rounded-lg p-3 border border-gray-600">
                                    <div class="text-sm text-gray-300">Market Sentiment</div>
                                    <div class="text-lg font-semibold text-green-400">Bullish</div>
                                </div>
                                <div class="bg-gray-800 rounded-lg p-3 border border-gray-600">
                                    <div class="text-sm text-gray-300">Volume Status</div>
                                    <div class="text-lg font-semibold text-blue-400">Above Average</div>
                                </div>
                                <div class="bg-gray-800 rounded-lg p-3 border border-gray-600">
                                    <div class="text-sm text-gray-300">Volatility</div>
                                    <div class="text-lg font-semibold text-orange-400">Moderate</div>
                                </div>
                            </div>
                        </div>
                    </div>


                    <!-- Additional Analytics Features -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Weekly Energy Trends Chart -->
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-gray-900">Weekly Energy Trends</h3>
                                <button onclick="refreshEnergyChart()" class="text-sm text-blue-600 hover:text-blue-800 font-medium flex items-center">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                    </svg>
                                    Refresh
                                </button>
                            </div>
                            <div id="energyChart" class="h-64 bg-gray-50 rounded-lg">
                                <canvas id="energyChartCanvas"></canvas>
                            </div>
                        </div>

                        <!-- Numerology Insights -->
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Numerology Insights</h3>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                    <span class="text-sm font-medium text-gray-700">Most Frequent Number This Month</span>
                                    <span class="text-lg font-bold text-purple-600" id="frequentNumber">7</span>
                                </div>
                                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                    <span class="text-sm font-medium text-gray-700">Current Cycle Phase</span>
                                    <span class="text-sm font-bold text-indigo-600" id="cyclePhase">Transformation</span>
                                </div>
                                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                    <span class="text-sm font-medium text-gray-700">Global Energy Trend</span>
                                    <span class="text-sm font-bold text-green-600" id="energyTrend">↗ Rising</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Projects Content -->
                <div id="projectsContent" class="page-content hidden">
                    <div class="mb-6 flex items-center justify-between">
                        <div>
                            <h1 class="text-2xl font-bold text-gray-900">Projects</h1>
                            <p class="text-gray-600">Manage your projects and track their progress.</p>
                        </div>
                        <div class="flex space-x-3">
                            <button onclick="showCreateProjectModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                <svg class="w-5 h-5 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                                New Project
                            </button>
                            <button onclick="showProjectFilters()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                <svg class="w-5 h-5 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path>
                                </svg>
                                Filter
                            </button>
                        </div>
                    </div>

                    <!-- Project Statistics -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center">
                                <div class="p-3 bg-blue-100 rounded-full">
                                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                                    </svg>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm text-gray-600">Total Projects</p>
                                    <p class="text-2xl font-bold text-gray-900" id="totalProjects">12</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center">
                                <div class="p-3 bg-green-100 rounded-full">
                                    <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm text-gray-600">Completed</p>
                                    <p class="text-2xl font-bold text-gray-900" id="completedProjects">5</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center">
                                <div class="p-3 bg-yellow-100 rounded-full">
                                    <svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm text-gray-600">In Progress</p>
                                    <p class="text-2xl font-bold text-gray-900" id="inProgressProjects">4</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center">
                                <div class="p-3 bg-red-100 rounded-full">
                                    <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                                    </svg>
                                </div>
                                <div class="ml-4">
                                    <p class="text-sm text-gray-600">Overdue</p>
                                    <p class="text-2xl font-bold text-gray-900" id="overdueProjects">3</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Filter Controls -->
                    <div id="projectFilters" class="bg-white rounded-lg shadow p-4 mb-6 hidden">
                        <div class="flex flex-wrap gap-4 items-center">
                            <div class="flex items-center space-x-2">
                                <label class="text-sm font-medium text-gray-700">Status:</label>
                                <select id="statusFilter" class="custom-select px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white text-gray-700">
                                    <option value="">All</option>
                                    <option value="active">Active</option>
                                    <option value="completed">Completed</option>
                                    <option value="planning">Planning</option>
                                    <option value="overdue">Overdue</option>
                                </select>
                            </div>
                            <div class="flex items-center space-x-2">
                                <label class="text-sm font-medium text-gray-700">Priority:</label>
                                <select id="priorityFilter" class="custom-select px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white text-gray-700">
                                    <option value="">All</option>
                                    <option value="high">High</option>
                                    <option value="medium">Medium</option>
                                    <option value="low">Low</option>
                                </select>
                            </div>
                            <div class="flex items-center space-x-2">
                                <label class="text-sm font-medium text-gray-700">Team:</label>
                                <select id="teamFilter" class="custom-select px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white text-gray-700">
                                    <option value="">All Teams</option>
                                    <option value="development">Development</option>
                                    <option value="design">Design</option>
                                    <option value="marketing">Marketing</option>
                                    <option value="operations">Operations</option>
                                </select>
                            </div>
                            <button onclick="applyProjectFilters()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                Apply Filters
                            </button>
                            <button onclick="clearProjectFilters()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                Clear
                            </button>
                        </div>
                    </div>
                    
                    <!-- Projects Grid -->
                    <div id="projectsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Projects will be populated here -->
                    </div>
                </div>

                <!-- Create Project Modal -->
                <div id="createProjectModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
                    <div class="bg-white rounded-lg p-6 w-full max-w-md">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-xl font-bold text-gray-900">Create New Project</h2>
                            <button onclick="hideCreateProjectModal()" class="text-gray-400 hover:text-gray-600">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                        
                        <form id="createProjectForm" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Project Name</label>
                                <input type="text" id="projectName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                                <textarea id="projectDescription" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" rows="3" required></textarea>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Team</label>
                                <select id="projectTeam" class="custom-select w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white text-gray-700" required>
                                    <option value="">Select Team</option>
                                    <option value="development">Development</option>
                                    <option value="design">Design</option>
                                    <option value="marketing">Marketing</option>
                                    <option value="operations">Operations</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Priority</label>
                                <select id="projectPriority" class="custom-select w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white text-gray-700" required>
                                    <option value="">Select Priority</option>
                                    <option value="high">High</option>
                                    <option value="medium">Medium</option>
                                    <option value="low">Low</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Due Date</label>
                                <input type="date" id="projectDueDate" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" required>
                            </div>
                            
                            <div class="flex space-x-3 pt-4">
                                <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg font-medium transition-colors">
                                    Create Project
                                </button>
                                <button type="button" onclick="hideCreateProjectModal()" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded-lg font-medium transition-colors">
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Project Detail Modal -->
                <div id="projectDetailModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
                    <div class="bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto">
                        <div class="flex items-center justify-between mb-4">
                            <h2 id="projectDetailTitle" class="text-xl font-bold text-gray-900"></h2>
                            <button onclick="hideProjectDetailModal()" class="text-gray-400 hover:text-gray-600">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                        
                        <div id="projectDetailContent" class="space-y-6">
                            <!-- Project details will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Invite Team Members Modal -->
                <div id="inviteTeamModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
                    <div class="bg-white rounded-lg p-6 w-full max-w-lg">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-xl font-bold text-gray-900">Invite Team Members</h2>
                            <button onclick="hideInviteTeamModal()" class="text-gray-400 hover:text-gray-600">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                        
                        <form id="inviteTeamForm" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                                <input type="email" id="inviteEmail" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Enter email address" required>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Role</label>
                                <select id="inviteRole" class="custom-select w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white text-gray-700" required>
                                    <option value="">Select Role</option>
                                    <option value="admin">Admin</option>
                                    <option value="manager">Manager</option>
                                    <option value="developer">Developer</option>
                                    <option value="designer">Designer</option>
                                    <option value="analyst">Analyst</option>
                                    <option value="viewer">Viewer</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Team</label>
                                <select id="inviteTeam" class="custom-select w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white text-gray-700" required>
                                    <option value="">Select Team</option>
                                    <option value="development">Development Team</option>
                                    <option value="design">Design Team</option>
                                    <option value="marketing">Marketing Team</option>
                                    <option value="operations">Operations Team</option>
                                    <option value="trading">Trading Team</option>
                                    <option value="research">Research Team</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Personal Message (Optional)</label>
                                <textarea id="inviteMessage" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" rows="3" placeholder="Add a personal message to the invitation..."></textarea>
                            </div>
                            
                            <div class="flex items-center">
                                <input type="checkbox" id="sendNotification" class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                                <label for="sendNotification" class="ml-2 block text-sm text-gray-700">Send email notification immediately</label>
                            </div>
                            
                            <div class="flex space-x-3 pt-4">
                                <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg font-medium transition-colors">
                                    <svg class="w-5 h-5 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                                    </svg>
                                    Send Invitation
                                </button>
                                <button type="button" onclick="hideInviteTeamModal()" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-2 px-4 rounded-lg font-medium transition-colors">
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                

                
                <!-- Settings Content -->
                <div id="settingsContent" class="page-content hidden">
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold text-gray-900">Settings</h1>
                        <p class="text-gray-600">Configure your application preferences.</p>
                    </div>
                    
                    <div class="space-y-6">
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">General Settings</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Application Name</label>
                                    <input type="text" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" value="The Rocket Trading Group">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Language</label>
                                    <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500">
                                        <option>English</option>
                                        <option>Spanish</option>
                                        <option>French</option>
                                        <option>German</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Notifications</h3>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <label class="text-sm font-medium text-gray-700">Email Notifications</label>
                                        <p class="text-sm text-gray-500">Receive notifications via email</p>
                                    </div>
                                    <label class="inline-flex items-center">
                                        <input type="checkbox" class="form-checkbox h-5 w-5 text-indigo-600" checked>
                                    </label>
                                </div>
                                <div class="flex items-center justify-between">
                                    <div>
                                        <label class="text-sm font-medium text-gray-700">Push Notifications</label>
                                        <p class="text-sm text-gray-500">Receive push notifications</p>
                                    </div>
                                    <label class="inline-flex items-center">
                                        <input type="checkbox" class="form-checkbox h-5 w-5 text-indigo-600">
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Financial Analysis Content - Enhanced with Real-Time Data -->
                <div id="financial-analysisContent" class="page-content hidden">
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold text-gray-900">Advanced Financial Analysis</h1>
                        <p class="text-gray-600">Real-time market data, portfolio tracking, and comprehensive financial insights.</p>
                    </div>

                    <!-- Stock Search Section -->
                    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">
                            <svg class="w-5 h-5 text-blue-600 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                            </svg>
                            Real-Time Stock Analysis
                        </h3>
                        <div class="flex space-x-4">
                            <input type="text" id="stockSymbol" class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter stock symbol (e.g., AAPL, MSFT, GOOGL)">
                            <button onclick="fetchStockData()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium transition-colors">
                                <svg class="w-5 h-5 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                                </svg>
                                Analyze Stock
                            </button>
                        </div>
                    </div>

                    <!-- Stock Information Display -->
                    <div id="stockInfo" class="bg-white rounded-lg shadow-md p-6 mb-6" style="display: none;">
                        <div class="flex items-center justify-between mb-4">
                            <h3 id="companyName" class="text-xl font-bold text-gray-900"></h3>
                            <button onclick="addToPortfolio()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                <svg class="w-5 h-5 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                </svg>
                                Add to Portfolio
                            </button>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                            <div class="text-center p-4 bg-blue-50 rounded-lg">
                                <h4 class="text-sm font-medium text-gray-600 mb-2">Current Price</h4>
                                <p id="stockPrice" class="text-2xl font-bold text-blue-600"></p>
                            </div>
                            <div class="text-center p-4 bg-green-50 rounded-lg">
                                <h4 class="text-sm font-medium text-gray-600 mb-2">P/E Ratio</h4>
                                <p id="peRatio" class="text-2xl font-bold text-green-600"></p>
                            </div>
                            <div class="text-center p-4 bg-purple-50 rounded-lg">
                                <h4 class="text-sm font-medium text-gray-600 mb-2">Market Cap</h4>
                                <p id="marketCap" class="text-2xl font-bold text-purple-600"></p>
                            </div>
                            <div class="text-center p-4 bg-yellow-50 rounded-lg">
                                <h4 class="text-sm font-medium text-gray-600 mb-2">Volume</h4>
                                <p id="volume" class="text-2xl font-bold text-yellow-600"></p>
                            </div>
                        </div>
                    </div>

                    <!-- Stock Chart -->
                    <div id="stockChartCard" class="bg-white rounded-lg shadow-md p-6 mb-6" style="display: none;">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">
                            <svg class="w-5 h-5 text-purple-600 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                            30-Day Price History
                        </h3>
                        <div class="relative" style="height: 400px;">
                            <canvas id="stockChart"></canvas>
                        </div>
                    </div>

                    <!-- Portfolio Tracker and News Side by Side -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <!-- Portfolio Tracker -->
                        <div class="bg-white rounded-lg shadow-md p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-gray-900">
                                    <svg class="w-5 h-5 text-green-600 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                    </svg>
                                    My Portfolio
                                </h3>
                                <div class="flex space-x-2">
                                    <button onclick="showAddTradeModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-lg text-sm font-medium transition-colors">
                                        Add Trade
                                    </button>
                                    <button onclick="togglePortfolioView()" class="bg-gray-600 hover:bg-gray-700 text-white px-3 py-1 rounded-lg text-sm font-medium transition-colors">
                                        <span id="viewToggleText">Detailed View</span>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Portfolio Summary Stats -->
                            <div class="grid grid-cols-3 gap-4 mb-4 p-3 bg-gray-50 rounded-lg">
                                <div class="text-center">
                                    <div class="text-sm text-gray-600">Total Value</div>
                                    <div id="portfolioTotalValue" class="text-lg font-bold text-green-600">$0.00</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-sm text-gray-600">Total P&L</div>
                                    <div id="portfolioTotalPL" class="text-lg font-bold">$0.00</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-sm text-gray-600">Win Rate</div>
                                    <div id="portfolioWinRate" class="text-lg font-bold text-blue-600">0%</div>
                                </div>
                            </div>
                            
                            <div class="overflow-x-auto">
                                <table class="w-full">
                                    <thead>
                                        <tr class="border-b border-gray-200">
                                            <th class="text-left py-2 text-sm font-medium text-gray-700">Symbol</th>
                                            <th class="text-left py-2 text-sm font-medium text-gray-700">Qty</th>
                                            <th class="text-left py-2 text-sm font-medium text-gray-700">Avg Price</th>
                                            <th class="text-left py-2 text-sm font-medium text-gray-700">P&L</th>
                                            <th class="text-left py-2 text-sm font-medium text-gray-700">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="portfolioTable">
                                        <tr>
                                            <td colspan="5" class="py-8 text-center text-gray-500">
                                                <svg class="w-12 h-12 mx-auto mb-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                                                </svg>
                                                <p>No trades in portfolio. Add trades to track them here.</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- News Feed -->
                        <div id="newsFeed" class="bg-white rounded-lg shadow-md p-6" style="display: none;">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">
                                <svg class="w-5 h-5 text-red-600 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"></path>
                                </svg>
                                Latest News
                            </h3>
                            <div id="newsList" class="space-y-4 max-h-96 overflow-y-auto"></div>
                        </div>
                    </div>

                    <!-- Enhanced Financial Dashboard -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600">Portfolio Value</p>
                                    <p id="portfolioValue" class="text-2xl font-bold text-green-600">$0.00</p>
                                </div>
                                <div class="h-12 w-12 bg-green-100 rounded-lg flex items-center justify-center">
                                    <svg class="h-6 w-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                                    </svg>
                                </div>
                            </div>
                            <div class="mt-4">
                                <div class="flex items-center">
                                    <span class="text-sm text-green-600">+5.2%</span>
                                    <span class="text-sm text-gray-600 ml-2">today</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600">Portfolio Holdings</p>
                                    <p id="portfolioHoldings" class="text-2xl font-bold text-blue-600">0</p>
                                </div>
                                <div class="h-12 w-12 bg-blue-100 rounded-lg flex items-center justify-center">
                                    <svg class="h-6 w-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                    </svg>
                                </div>
                            </div>
                            <div class="mt-4">
                                <div class="flex items-center">
                                    <span class="text-sm text-blue-600">stocks tracked</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600">Market Status</p>
                                    <p class="text-2xl font-bold text-purple-600" id="marketStatus">Open</p>
                                </div>
                                <div class="h-12 w-12 bg-purple-100 rounded-lg flex items-center justify-center">
                                    <svg class="h-6 w-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </div>
                            </div>
                            <div class="mt-4">
                                <div class="flex items-center">
                                    <span class="text-sm text-purple-600" id="marketTime">Live trading</span>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-lg shadow p-6">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-sm font-medium text-gray-600">API Status</p>
                                    <p class="text-2xl font-bold text-green-600" id="apiStatus">Connected</p>
                                </div>
                                <div class="h-12 w-12 bg-green-100 rounded-lg flex items-center justify-center">
                                    <svg class="h-6 w-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </div>
                            </div>
                            <div class="mt-4">
                                <div class="flex items-center">
                                    <span class="text-sm text-green-600">Real-time data</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Financial Calculator -->
                    <div class="bg-white rounded-lg shadow p-6 mb-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">
                            <svg class="w-5 h-5 text-indigo-600 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                            </svg>
                            Investment Calculator
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Initial Investment ($)</label>
                                <input type="number" id="initialInvestment" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="10000">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Monthly Contribution ($)</label>
                                <input type="number" id="monthlyContribution" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Expected Return (%)</label>
                                <input type="number" id="expectedReturn" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="8">
                            </div>
                        </div>
                        <div class="mt-4 flex space-x-4 items-center">
                            <button id="calculateButton" onclick="calculateInvestment()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-4 rounded-lg transition-colors">Calculate Returns</button>
                            <div id="calculationResult" class="text-lg font-bold text-gray-900"></div>
                        </div>
                    </div>

                    <!-- Watchlist Management -->
                    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">
                                <svg class="w-5 h-5 text-yellow-600 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                </svg>
                                Stock Watchlist
                            </h3>
                            <button onclick="showAddWatchlistModal()" class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                Add to Watchlist
                            </button>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b border-gray-200">
                                        <th class="text-left py-2 text-sm font-medium text-gray-700">Symbol</th>
                                        <th class="text-left py-2 text-sm font-medium text-gray-700">Current Price</th>
                                        <th class="text-left py-2 text-sm font-medium text-gray-700">Target Price</th>
                                        <th class="text-left py-2 text-sm font-medium text-gray-700">% to Target</th>
                                        <th class="text-left py-2 text-sm font-medium text-gray-700">Alert</th>
                                        <th class="text-left py-2 text-sm font-medium text-gray-700">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="watchlistTable">
                                    <tr>
                                        <td colspan="6" class="py-8 text-center text-gray-500">
                                            <svg class="w-12 h-12 mx-auto mb-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                            </svg>
                                            <p>No stocks in watchlist. Add stocks to track price targets.</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Trade Journal -->
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">
                                <svg class="w-5 h-5 text-blue-600 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                </svg>
                                Trade Journal
                            </h3>
                            <div class="flex space-x-2">
                                <button onclick="showTradeJournalModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                    Add Journal Entry
                                </button>
                                <button onclick="exportTradeJournal()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                    Export
                                </button>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            <div class="bg-green-50 p-4 rounded-lg">
                                <h4 class="text-sm font-medium text-green-800 mb-2">Winning Trades</h4>
                                <p id="winningTrades" class="text-2xl font-bold text-green-600">0</p>
                            </div>
                            <div class="bg-red-50 p-4 rounded-lg">
                                <h4 class="text-sm font-medium text-red-800 mb-2">Losing Trades</h4>
                                <p id="losingTrades" class="text-2xl font-bold text-red-600">0</p>
                            </div>
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h4 class="text-sm font-medium text-blue-800 mb-2">Total P&L</h4>
                                <p id="totalPL" class="text-2xl font-bold text-blue-600">$0.00</p>
                            </div>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr class="border-b border-gray-200">
                                        <th class="text-left py-2 text-sm font-medium text-gray-700">Date</th>
                                        <th class="text-left py-2 text-sm font-medium text-gray-700">Symbol</th>
                                        <th class="text-left py-2 text-sm font-medium text-gray-700">Entry</th>
                                        <th class="text-left py-2 text-sm font-medium text-gray-700">Exit</th>
                                        <th class="text-left py-2 text-sm font-medium text-gray-700">P&L</th>
                                        <th class="text-left py-2 text-sm font-medium text-gray-700">Notes</th>
                                        <th class="text-left py-2 text-sm font-medium text-gray-700">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="journalTable">
                                    <tr>
                                        <td colspan="7" class="py-8 text-center text-gray-500">
                                            <svg class="w-12 h-12 mx-auto mb-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                            </svg>
                                            <p>No journal entries yet. Start documenting your trades.</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Portfolio Analytics Box -->
                    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">
                                <svg class="w-5 h-5 text-purple-600 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                </svg>
                                Portfolio Analytics
                            </h3>
                            <button onclick="refreshPortfolioAnalytics()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                Refresh Data
                            </button>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h4 class="text-sm font-medium text-blue-800 mb-2">Portfolio Beta</h4>
                                <p id="portfolioBeta" class="text-xl font-bold text-blue-600">1.2</p>
                                <p class="text-xs text-blue-600 mt-1">vs S&P 500</p>
                            </div>
                            <div class="bg-green-50 p-4 rounded-lg">
                                <h4 class="text-sm font-medium text-green-800 mb-2">Sharpe Ratio</h4>
                                <p id="sharpeRatio" class="text-xl font-bold text-green-600">1.45</p>
                                <p class="text-xs text-green-600 mt-1">Risk-adjusted return</p>
                            </div>
                            <div class="bg-yellow-50 p-4 rounded-lg">
                                <h4 class="text-sm font-medium text-yellow-800 mb-2">Max Drawdown</h4>
                                <p id="maxDrawdown" class="text-xl font-bold text-yellow-600">-12.3%</p>
                                <p class="text-xs text-yellow-600 mt-1">Largest loss</p>
                            </div>
                            <div class="bg-red-50 p-4 rounded-lg">
                                <h4 class="text-sm font-medium text-red-800 mb-2">Volatility</h4>
                                <p id="portfolioVolatility" class="text-xl font-bold text-red-600">18.2%</p>
                                <p class="text-xs text-red-600 mt-1">Annualized</p>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div>
                                <h4 class="text-md font-semibold text-gray-900 mb-3">Sector Allocation</h4>
                                <div class="space-y-2">
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-gray-600">Technology</span>
                                        <div class="flex items-center space-x-2">
                                            <div class="w-20 bg-gray-200 rounded-full h-2">
                                                <div class="bg-blue-600 h-2 rounded-full" style="width: 45%"></div>
                                            </div>
                                            <span class="text-sm font-medium">45%</span>
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-gray-600">Healthcare</span>
                                        <div class="flex items-center space-x-2">
                                            <div class="w-20 bg-gray-200 rounded-full h-2">
                                                <div class="bg-green-600 h-2 rounded-full" style="width: 25%"></div>
                                            </div>
                                            <span class="text-sm font-medium">25%</span>
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-gray-600">Finance</span>
                                        <div class="flex items-center space-x-2">
                                            <div class="w-20 bg-gray-200 rounded-full h-2">
                                                <div class="bg-yellow-600 h-2 rounded-full" style="width: 20%"></div>
                                            </div>
                                            <span class="text-sm font-medium">20%</span>
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-gray-600">Other</span>
                                        <div class="flex items-center space-x-2">
                                            <div class="w-20 bg-gray-200 rounded-full h-2">
                                                <div class="bg-purple-600 h-2 rounded-full" style="width: 10%"></div>
                                            </div>
                                            <span class="text-sm font-medium">10%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <h4 class="text-md font-semibold text-gray-900 mb-3">Performance Metrics</h4>
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span class="text-sm text-gray-600">YTD Return:</span>
                                        <span id="ytdReturn" class="text-sm font-medium text-green-600">+24.5%</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-sm text-gray-600">1-Year Return:</span>
                                        <span id="oneYearReturn" class="text-sm font-medium text-green-600">+18.2%</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-sm text-gray-600">Best Trade:</span>
                                        <span id="bestTrade" class="text-sm font-medium text-green-600">+$2,450</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-sm text-gray-600">Worst Trade:</span>
                                        <span id="worstTrade" class="text-sm font-medium text-red-600">-$890</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-sm text-gray-600">Avg Trade:</span>
                                        <span id="avgTrade" class="text-sm font-medium text-blue-600">+$347</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Market Alerts & Risk Management Box -->
                    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">
                                <svg class="w-5 h-5 text-orange-600 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 13.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                </svg>
                                Market Alerts & Risk Management
                            </h3>
                            <button onclick="showRiskManagementModal()" class="bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                                Set Risk Rules
                            </button>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            <div class="bg-red-50 p-4 rounded-lg">
                                <h4 class="text-sm font-medium text-red-800 mb-2">Active Alerts</h4>
                                <p id="activeAlerts" class="text-xl font-bold text-red-600">3</p>
                                <p class="text-xs text-red-600 mt-1">Price triggers</p>
                            </div>
                            <div class="bg-yellow-50 p-4 rounded-lg">
                                <h4 class="text-sm font-medium text-yellow-800 mb-2">Risk Score</h4>
                                <p id="riskScore" class="text-xl font-bold text-yellow-600">Medium</p>
                                <p class="text-xs text-yellow-600 mt-1">Portfolio risk</p>
                            </div>
                            <div class="bg-green-50 p-4 rounded-lg">
                                <h4 class="text-sm font-medium text-green-800 mb-2">Stop Losses</h4>
                                <p id="stopLossCount" class="text-xl font-bold text-green-600">7</p>
                                <p class="text-xs text-green-600 mt-1">Active orders</p>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div>
                                <h4 class="text-md font-semibold text-gray-900 mb-3">Recent Alerts</h4>
                                <div class="space-y-2 max-h-32 overflow-y-auto">
                                    <div class="flex items-center justify-between p-2 bg-red-50 rounded-lg">
                                        <div class="flex items-center space-x-2">
                                            <div class="w-2 h-2 bg-red-500 rounded-full"></div>
                                            <span class="text-sm font-medium">AAPL</span>
                                        </div>
                                        <span class="text-xs text-red-600">Price below $150</span>
                                    </div>
                                    <div class="flex items-center justify-between p-2 bg-yellow-50 rounded-lg">
                                        <div class="flex items-center space-x-2">
                                            <div class="w-2 h-2 bg-yellow-500 rounded-full"></div>
                                            <span class="text-sm font-medium">MSFT</span>
                                        </div>
                                        <span class="text-xs text-yellow-600">Volume spike</span>
                                    </div>
                                    <div class="flex items-center justify-between p-2 bg-green-50 rounded-lg">
                                        <div class="flex items-center space-x-2">
                                            <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                            <span class="text-sm font-medium">GOOGL</span>
                                        </div>
                                        <span class="text-xs text-green-600">Target reached</span>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <h4 class="text-md font-semibold text-gray-900 mb-3">Risk Management</h4>
                                <div class="space-y-3">
                                    <div class="flex justify-between">
                                        <span class="text-sm text-gray-600">Position Size Limit:</span>
                                        <span class="text-sm font-medium">5% per trade</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-sm text-gray-600">Stop Loss:</span>
                                        <span class="text-sm font-medium">-2% default</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-sm text-gray-600">Daily Loss Limit:</span>
                                        <span class="text-sm font-medium">-$1,000</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-sm text-gray-600">Margin Usage:</span>
                                        <span class="text-sm font-medium text-green-600">45% / 80%</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-sm text-gray-600">Correlation Risk:</span>
                                        <span class="text-sm font-medium text-yellow-600">Medium</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Signals Content -->
                <div id="signalsContent" class="page-content hidden">
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold text-gray-900">Financial Instrument Signal Generator</h1>
                        <p class="text-gray-600">Generate trading signals using advanced algorithms including ICT methodology, Fibonacci analysis, and Tesla Vortex patterns</p>
                    </div>
                    
                    <!-- Header Section -->
                    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between">
                            <div class="flex-1">
                                <h2 class="text-xl font-bold text-gray-900 mb-2">Signal Generation</h2>
                                <p class="text-gray-600">Enter a symbol to generate comprehensive trading signals</p>
                            </div>
                            <div class="mt-4 lg:mt-0 lg:ml-6">
                                <div class="flex items-center space-x-4">
                                    <div class="flex items-center">
                                        <input 
                                            type="text" 
                                            id="signalSymbolInput" 
                                            placeholder="Enter symbol (e.g., AAPL, EURUSD)"
                                            class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                        >
                                    </div>
                                    <button 
                                        onclick="generateSignalsInline()" 
                                        class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium transition-colors"
                                    >
                                        <svg class="w-5 h-5 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                        </svg>
                                        Generate Signal
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Trading Signals Section -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6 mb-6">
                        <!-- Live Signals -->
                        <div class="bg-white rounded-lg shadow-md p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">
                                <svg class="w-5 h-5 text-blue-600 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 4V2a1 1 0 011-1h4a1 1 0 011 1v2h4a1 1 0 011 1v4a1 1 0 01-1 1h-1v8a2 2 0 01-2 2H6a2 2 0 01-2-2V10H3a1 1 0 01-1-1V5a1 1 0 011-1h4z"></path>
                                </svg>
                                Live Signals
                            </h3>
                            <div id="inlineLiveSignals" class="space-y-3">
                                <div class="text-center py-8 text-gray-500">
                                    <svg class="w-12 h-12 mx-auto mb-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                    </svg>
                                    <p>Enter a symbol to generate signals</p>
                                </div>
                            </div>
                        </div>

                        <!-- Signal Statistics -->
                        <div class="bg-white rounded-lg shadow-md p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">
                                <svg class="w-5 h-5 text-green-600 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                </svg>
                                Signal Statistics
                            </h3>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Total Signals:</span>
                                    <span id="inlineTotalSignals" class="font-semibold">0</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Bullish:</span>
                                    <span id="inlineBullishSignals" class="font-semibold text-green-600">0</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Bearish:</span>
                                    <span id="inlineBearishSignals" class="font-semibold text-red-600">0</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Avg Confidence:</span>
                                    <span id="inlineAvgConfidence" class="font-semibold">0%</span>
                                </div>
                            </div>
                        </div>

                        <!-- Market Status -->
                        <div class="bg-white rounded-lg shadow-md p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">
                                <svg class="w-5 h-5 text-purple-600 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"></path>
                                </svg>
                                Market Status
                            </h3>
                            <div class="space-y-3">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Current Symbol:</span>
                                    <span id="inlineCurrentSymbol" class="font-semibold">-</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Last Update:</span>
                                    <span id="inlineLastUpdate" class="font-semibold">-</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Market Session:</span>
                                    <span id="inlineMarketSession" class="font-semibold">-</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Volatility:</span>
                                    <span id="inlineVolatility" class="font-semibold">-</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Detailed Signals Table -->
                    <div class="bg-white rounded-lg shadow-md mb-6">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-gray-900">
                                <svg class="w-5 h-5 text-blue-600 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                                </svg>
                                Detailed Signal Analysis
                            </h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Signal</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Direction</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Entry</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Stop Loss</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Take Profit</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">R:R Ratio</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Confidence</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Setup</th>
                                    </tr>
                                </thead>
                                <tbody id="inlineSignalsTableBody" class="bg-white divide-y divide-gray-200">
                                    <tr>
                                        <td colspan="8" class="px-6 py-8 text-center text-gray-500">
                                            <svg class="w-8 h-8 mx-auto mb-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                            </svg>
                                            <p>Generate signals to view detailed analysis</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Advanced Technical Analysis Section -->
                    <div class="space-y-6">
                        <!-- Enhanced Fibonacci Analysis - Full Width -->
                        <div class="bg-white rounded-lg shadow-md p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">
                                <svg class="w-5 h-5 text-blue-600 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                                </svg>
                                Advanced Fibonacci Calculator
                            </h3>
                            <div id="inlineFibonacciLevels" class="space-y-2">
                                <div class="text-center py-12 text-gray-500">
                                    <svg class="w-16 h-16 mx-auto mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                                    </svg>
                                    <h4 class="text-lg font-semibold mb-2">Professional Fibonacci Analysis</h4>
                                    <p class="mb-4">Generate signals to view comprehensive Fibonacci levels</p>
                                    <div class="text-sm text-gray-400 space-y-1">
                                        <div>Ready to analyze your trading signals</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ICT Analysis and Market Structure -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- ICT Wireframe -->
                            <div class="bg-white rounded-lg shadow-md p-6">
                                <h3 class="text-lg font-semibold text-gray-900 mb-4">
                                    <svg class="w-5 h-5 text-purple-600 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                                    </svg>
                                    ICT Wireframe Analysis
                                </h3>
                                <div id="inlineIctWireframe" class="space-y-3">
                                    <div class="text-center py-8 text-gray-500">
                                        <svg class="w-12 h-12 mx-auto mb-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                                        </svg>
                                        <p>Generate signals to view ICT wireframe</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Additional Market Analysis -->
                            <div class="bg-white rounded-lg shadow-md p-6">
                                <h3 class="text-lg font-semibold text-gray-900 mb-4">
                                    <svg class="w-5 h-5 text-green-600 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                                    </svg>
                                    Market Structure
                                </h3>
                                <div id="inlineMarketStructure" class="space-y-3">
                                    <div class="text-center py-8 text-gray-500">
                                        <svg class="w-12 h-12 mx-auto mb-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                                        </svg>
                                        <p>Market structure analysis coming soon</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts Content -->
                <div id="chartsContent" class="page-content hidden">
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold text-gray-900">Financial Charts</h1>
                        <p class="text-gray-600">Real-time financial charts and technical analysis tools</p>
                    </div>

                    <!-- Popular Symbols -->
                    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Popular Symbols</h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3">
                            <button onclick="loadSymbolChart('AAPL')" class="bg-gray-50 hover:bg-gray-100 rounded-lg p-3 text-center transition-colors">
                                <div class="text-sm font-medium text-gray-900">AAPL</div>
                                <div class="text-xs text-gray-500">Apple Inc.</div>
                            </button>
                            <button onclick="loadSymbolChart('MSFT')" class="bg-gray-50 hover:bg-gray-100 rounded-lg p-3 text-center transition-colors">
                                <div class="text-sm font-medium text-gray-900">MSFT</div>
                                <div class="text-xs text-gray-500">Microsoft</div>
                            </button>
                            <button onclick="loadSymbolChart('GOOGL')" class="bg-gray-50 hover:bg-gray-100 rounded-lg p-3 text-center transition-colors">
                                <div class="text-sm font-medium text-gray-900">GOOGL</div>
                                <div class="text-xs text-gray-500">Alphabet Inc.</div>
                            </button>
                            <button onclick="loadSymbolChart('AMZN')" class="bg-gray-50 hover:bg-gray-100 rounded-lg p-3 text-center transition-colors">
                                <div class="text-sm font-medium text-gray-900">AMZN</div>
                                <div class="text-xs text-gray-500">Amazon</div>
                            </button>
                            <button onclick="loadSymbolChart('TSLA')" class="bg-gray-50 hover:bg-gray-100 rounded-lg p-3 text-center transition-colors">
                                <div class="text-sm font-medium text-gray-900">TSLA</div>
                                <div class="text-xs text-gray-500">Tesla Inc.</div>
                            </button>
                            <button onclick="loadSymbolChart('NVDA')" class="bg-gray-50 hover:bg-gray-100 rounded-lg p-3 text-center transition-colors">
                                <div class="text-sm font-medium text-gray-900">NVDA</div>
                                <div class="text-xs text-gray-500">NVIDIA</div>
                            </button>
                            <button onclick="loadSymbolChart('QQQ')" class="bg-gray-50 hover:bg-gray-100 rounded-lg p-3 text-center transition-colors">
                                <div class="text-sm font-medium text-gray-900">NQ</div>
                                <div class="text-xs text-gray-500">NASDAQ-100 (QQQ ETF)</div>
                            </button>
                            <button onclick="loadSymbolChart('SPY')" class="bg-gray-50 hover:bg-gray-100 rounded-lg p-3 text-center transition-colors">
                                <div class="text-sm font-medium text-gray-900">ES</div>
                                <div class="text-xs text-gray-500">S&P 500 (SPY ETF)</div>
                            </button>
                            <button onclick="loadSymbolChart('DIA')" class="bg-gray-50 hover:bg-gray-100 rounded-lg p-3 text-center transition-colors">
                                <div class="text-sm font-medium text-gray-900">YM</div>
                                <div class="text-xs text-gray-500">Dow Jones (DIA ETF)</div>
                            </button>
                            <button onclick="loadSymbolChart('FXE')" class="bg-gray-50 hover:bg-gray-100 rounded-lg p-3 text-center transition-colors">
                                <div class="text-sm font-medium text-gray-900">EUR/USD</div>
                                <div class="text-xs text-gray-500">Euro (FXE ETF)</div>
                            </button>
                            <button onclick="loadSymbolChart('GLD')" class="bg-gray-50 hover:bg-gray-100 rounded-lg p-3 text-center transition-colors">
                                <div class="text-sm font-medium text-gray-900">GOLD</div>
                                <div class="text-xs text-gray-500">Gold (GLD ETF)</div>
                            </button>
                        </div>
                    </div>

                    <!-- Chart Controls -->
                    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between">
                            <div class="flex-1">
                                <h2 class="text-lg font-semibold text-gray-900 mb-2">Market Data Visualization</h2>
                                <p class="text-gray-600">Interactive charts with technical indicators and real-time data</p>
                            </div>
                            <div class="mt-4 lg:mt-0 lg:ml-6">
                                <div class="flex items-center space-x-4">
                                    <input type="text" id="chartSymbol" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter symbol (e.g., AAPL, MSFT)">
                                    <select id="chartTimeframe" class="custom-select px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white text-gray-700">
                                        <option value="1D">1 Day</option>
                                        <option value="5D">5 Days</option>
                                        <option value="1M">1 Month</option>
                                        <option value="3M">3 Months</option>
                                        <option value="6M">6 Months</option>
                                        <option value="1Y">1 Year</option>
                                        <option value="5Y">5 Years</option>
                                    </select>
                                    <button onclick="loadChart()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium transition-colors">
                                        <svg class="w-5 h-5 mr-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                        </svg>
                                        Load Chart
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Main Chart Container -->
                    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">
                                <span id="chartTitle">Stock Price Chart</span>
                            </h3>
                            <div class="flex items-center space-x-2">
                                <button onclick="toggleChartType('line')" class="px-3 py-1 text-sm bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition-colors">Line</button>
                                <button onclick="toggleChartType('candlestick')" class="px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors">Candlestick</button>
                                <button onclick="toggleChartType('bar')" class="px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors">Bar</button>
                                <button onclick="toggleChartType('area')" class="px-3 py-1 text-sm bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors">Area</button>
                            </div>
                        </div>
                        <div id="mainChart" class="w-full h-96 bg-gray-50 rounded-lg flex items-center justify-center">
                            <div class="text-center">
                                <svg class="w-16 h-16 mx-auto mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"></path>
                                </svg>
                                <p class="text-gray-600">Enter a symbol to load chart</p>
                            </div>
                        </div>
                    </div>

                    <!-- Technical Indicators & Analysis -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                        <div class="bg-white rounded-lg shadow-md p-4">
                            <h3 class="text-md font-semibold text-gray-900 mb-3">Technical Indicators</h3>
                            <div class="grid grid-cols-2 gap-2">
                                <div class="flex items-center justify-between">
                                    <label class="text-xs font-medium text-gray-700">MA20</label>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="ma20" class="sr-only peer" onchange="toggleIndicator('ma20')">
                                        <div class="w-8 h-4 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[1px] after:left-[1px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-3 after:w-3 after:transition-all peer-checked:bg-blue-600"></div>
                                    </label>
                                </div>
                                <div class="flex items-center justify-between">
                                    <label class="text-xs font-medium text-gray-700">MA50</label>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="ma50" class="sr-only peer" onchange="toggleIndicator('ma50')">
                                        <div class="w-8 h-4 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[1px] after:left-[1px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-3 after:w-3 after:transition-all peer-checked:bg-blue-600"></div>
                                    </label>
                                </div>
                                <div class="flex items-center justify-between">
                                    <label class="text-xs font-medium text-gray-700">RSI</label>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="rsi" class="sr-only peer" onchange="toggleIndicator('rsi')">
                                        <div class="w-8 h-4 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[1px] after:left-[1px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-3 after:w-3 after:transition-all peer-checked:bg-blue-600"></div>
                                    </label>
                                </div>
                                <div class="flex items-center justify-between">
                                    <label class="text-xs font-medium text-gray-700">MACD</label>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="macd" class="sr-only peer" onchange="toggleIndicator('macd')">
                                        <div class="w-8 h-4 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[1px] after:left-[1px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-3 after:w-3 after:transition-all peer-checked:bg-blue-600"></div>
                                    </label>
                                </div>
                                <div class="flex items-center justify-between">
                                    <label class="text-xs font-medium text-gray-700">Bollinger</label>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="bb" class="sr-only peer" onchange="toggleIndicator('bb')">
                                        <div class="w-8 h-4 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[1px] after:left-[1px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-3 after:w-3 after:transition-all peer-checked:bg-blue-600"></div>
                                    </label>
                                </div>
                                <div class="flex items-center justify-between">
                                    <label class="text-xs font-medium text-gray-700">Volume</label>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="volume" class="sr-only peer" onchange="toggleIndicator('volume')">
                                        <div class="w-8 h-4 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[1px] after:left-[1px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-3 after:w-3 after:transition-all peer-checked:bg-blue-600"></div>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gray-800 rounded-lg shadow-md p-4 lg:col-span-2 border border-gray-700">
                            <h3 class="text-md font-semibold text-gray-100 mb-3">Chart Analysis</h3>
                            <div id="chartAnalysis" class="space-y-3">
                                <div class="text-center py-6 text-gray-400">
                                    <svg class="w-8 h-8 mx-auto mb-2 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                                    </svg>
                                    <p class="text-sm">Load a chart to view analysis</p>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                
                <!-- Options Calculator Content -->
                <div id="options-calculatorContent" class="page-content hidden">
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold text-gray-900">Options Calculator</h1>
                        <p class="text-gray-600">Black-Scholes options pricing model with Greeks calculation</p>
                    </div>

                    <!-- Calculator Input Panel -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <!-- Input Parameters -->
                        <div class="bg-white rounded-lg shadow-md p-6">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">Input Parameters</h3>
                            <div class="space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Current Stock Price ($)</label>
                                        <input type="number" id="stockPrice" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="100.00" step="0.01" value="100.00">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Strike Price ($)</label>
                                        <input type="number" id="strikePrice" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="100.00" step="0.01" value="100.00">
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Time to Expiration (Years)</label>
                                        <input type="number" id="timeToExpiry" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="1.00" step="0.01" value="1.00">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Risk-Free Rate (%)</label>
                                        <input type="number" id="riskFreeRate" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="5.00" step="0.01" value="5.00">
                                    </div>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Volatility (%)</label>
                                        <input type="number" id="volatility" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="20.00" step="0.01" value="20.00">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Dividend Yield (%)</label>
                                        <input type="number" id="dividendYield" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="0.00" step="0.01" value="0.00">
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Option Type</label>
                                    <select id="optionType" class="custom-select w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white text-gray-700">
                                        <option value="call">Call Option</option>
                                        <option value="put">Put Option</option>
                                    </select>
                                </div>
                                
                                <div class="flex space-x-3">
                                    <button onclick="calculateOptions()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                        Calculate
                                    </button>
                                    <button onclick="resetCalculator()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                        Reset
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Results Panel -->
                        <div class="bg-white rounded-lg shadow-md p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h3 class="text-lg font-semibold text-gray-900">Calculation Results</h3>
                                <div class="flex space-x-2">
                                    <button onclick="saveCalculation()" class="text-sm bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded-lg font-medium transition-colors">
                                        Save
                                    </button>
                                    <button onclick="exportCalculation()" class="text-sm bg-purple-600 hover:bg-purple-700 text-white px-3 py-1 rounded-lg font-medium transition-colors">
                                        Export
                                    </button>
                                </div>
                            </div>
                            
                            <div id="calculationResults" class="space-y-4">
                                <div class="text-center py-8 text-gray-500">
                                    <svg class="w-16 h-16 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                                    </svg>
                                    <p>Enter parameters and click Calculate to see results</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Greeks Explanation -->
                    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Understanding the Greeks</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                            <div class="bg-blue-50 rounded-lg p-4">
                                <h4 class="font-semibold text-blue-900 mb-2">Delta (Δ)</h4>
                                <p class="text-sm text-blue-800">Measures how much the option price changes for a $1 change in the underlying stock price.</p>
                            </div>
                            <div class="bg-green-50 rounded-lg p-4">
                                <h4 class="font-semibold text-green-900 mb-2">Gamma (Γ)</h4>
                                <p class="text-sm text-green-800">Measures the rate of change of Delta with respect to the underlying stock price.</p>
                            </div>
                            <div class="bg-red-50 rounded-lg p-4">
                                <h4 class="font-semibold text-red-900 mb-2">Theta (Θ)</h4>
                                <p class="text-sm text-red-800">Measures how much the option price decreases per day due to time decay.</p>
                            </div>
                            <div class="bg-purple-50 rounded-lg p-4">
                                <h4 class="font-semibold text-purple-900 mb-2">Vega (ν)</h4>
                                <p class="text-sm text-purple-800">Measures how much the option price changes for a 1% change in implied volatility.</p>
                            </div>
                            <div class="bg-orange-50 rounded-lg p-4">
                                <h4 class="font-semibold text-orange-900 mb-2">Rho (ρ)</h4>
                                <p class="text-sm text-orange-800">Measures how much the option price changes for a 1% change in interest rates.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Saved Calculations -->
                    <div class="bg-white rounded-lg shadow-md p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">Saved Calculations</h3>
                            <button onclick="clearSavedCalculations()" class="text-sm bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded-lg font-medium transition-colors">
                                Clear All
                            </button>
                        </div>
                        <div id="savedCalculations" class="space-y-2">
                            <div class="text-center py-4 text-gray-500">
                                <p class="text-sm">No saved calculations yet</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Greeks Modal Overlays -->
                <!-- Delta Modal -->
                <div id="deltaModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
                    <div class="flex items-center justify-center min-h-screen px-4">
                        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h2 class="text-2xl font-bold text-green-900">Delta (Δ) - Price Sensitivity</h2>
                                <button onclick="closeGreekModal('deltaModal')" class="text-gray-400 hover:text-gray-600">
                                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="space-y-4">
                                <div class="bg-green-50 rounded-lg p-4 border-l-4 border-green-500">
                                    <h3 class="font-semibold text-green-900 mb-2">What is Delta?</h3>
                                    <p class="text-green-800">Delta measures how much an option's price will change for every $1 change in the underlying stock price, assuming all other factors remain constant.</p>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="bg-blue-50 rounded-lg p-4">
                                        <h4 class="font-semibold text-blue-900 mb-2">Call Options</h4>
                                        <ul class="text-sm text-blue-800 space-y-1">
                                            <li>• Delta ranges from 0 to 1</li>
                                            <li>• At-the-money: ~0.5</li>
                                            <li>• In-the-money: 0.5 to 1</li>
                                            <li>• Out-of-the-money: 0 to 0.5</li>
                                        </ul>
                                    </div>
                                    <div class="bg-red-50 rounded-lg p-4">
                                        <h4 class="font-semibold text-red-900 mb-2">Put Options</h4>
                                        <ul class="text-sm text-red-800 space-y-1">
                                            <li>• Delta ranges from -1 to 0</li>
                                            <li>• At-the-money: ~-0.5</li>
                                            <li>• In-the-money: -1 to -0.5</li>
                                            <li>• Out-of-the-money: -0.5 to 0</li>
                                        </ul>
                                    </div>
                                </div>
                                
                                <div class="bg-yellow-50 rounded-lg p-4">
                                    <h4 class="font-semibold text-yellow-900 mb-2">Trading Applications</h4>
                                    <ul class="text-sm text-yellow-800 space-y-1">
                                        <li>• <strong>Hedging:</strong> Use delta to hedge portfolio exposure</li>
                                        <li>• <strong>Risk Management:</strong> Higher delta = higher directional risk</li>
                                        <li>• <strong>Position Sizing:</strong> Delta helps determine equivalent stock exposure</li>
                                        <li>• <strong>Delta Neutral:</strong> Create strategies with zero directional exposure</li>
                                    </ul>
                                </div>
                                
                                <div class="bg-gray-100 rounded-lg p-4">
                                    <h4 class="font-semibold text-gray-900 mb-2">Example</h4>
                                    <p class="text-sm text-gray-700">
                                        If a call option has a delta of 0.6 and the stock price increases by $1, 
                                        the option price will increase by approximately $0.60.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Gamma Modal -->
                <div id="gammaModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
                    <div class="flex items-center justify-center min-h-screen px-4">
                        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h2 class="text-2xl font-bold text-purple-900">Gamma (Γ) - Delta Acceleration</h2>
                                <button onclick="closeGreekModal('gammaModal')" class="text-gray-400 hover:text-gray-600">
                                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="space-y-4">
                                <div class="bg-purple-50 rounded-lg p-4 border-l-4 border-purple-500">
                                    <h3 class="font-semibold text-purple-900 mb-2">What is Gamma?</h3>
                                    <p class="text-purple-800">Gamma measures the rate of change of delta with respect to changes in the underlying stock price. It's essentially the "acceleration" of delta.</p>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="bg-green-50 rounded-lg p-4">
                                        <h4 class="font-semibold text-green-900 mb-2">High Gamma</h4>
                                        <ul class="text-sm text-green-800 space-y-1">
                                            <li>• At-the-money options</li>
                                            <li>• Short-term expiration</li>
                                            <li>• Delta changes rapidly</li>
                                            <li>• Higher profit potential</li>
                                            <li>• Higher risk</li>
                                        </ul>
                                    </div>
                                    <div class="bg-orange-50 rounded-lg p-4">
                                        <h4 class="font-semibold text-orange-900 mb-2">Low Gamma</h4>
                                        <ul class="text-sm text-orange-800 space-y-1">
                                            <li>• Deep in/out-of-money</li>
                                            <li>• Long-term expiration</li>
                                            <li>• Delta changes slowly</li>
                                            <li>• More predictable behavior</li>
                                            <li>• Lower risk</li>
                                        </ul>
                                    </div>
                                </div>
                                
                                <div class="bg-blue-50 rounded-lg p-4">
                                    <h4 class="font-semibold text-blue-900 mb-2">Trading Implications</h4>
                                    <ul class="text-sm text-blue-800 space-y-1">
                                        <li>• <strong>Gamma Scalping:</strong> Trade around delta changes to capture profits</li>
                                        <li>• <strong>Risk Assessment:</strong> High gamma = high volatility in P&L</li>
                                        <li>• <strong>Portfolio Management:</strong> Monitor total gamma exposure</li>
                                        <li>• <strong>Hedging Frequency:</strong> High gamma requires more frequent rebalancing</li>
                                    </ul>
                                </div>
                                
                                <div class="bg-gray-100 rounded-lg p-4">
                                    <h4 class="font-semibold text-gray-900 mb-2">Key Points</h4>
                                    <ul class="text-sm text-gray-700 space-y-1">
                                        <li>• Gamma is highest for at-the-money options near expiration</li>
                                        <li>• Gamma is the same for calls and puts with same strike and expiration</li>
                                        <li>• Long options have positive gamma, short options have negative gamma</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Theta Modal -->
                <div id="thetaModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
                    <div class="flex items-center justify-center min-h-screen px-4">
                        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h2 class="text-2xl font-bold text-red-900">Theta (Θ) - Time Decay</h2>
                                <button onclick="closeGreekModal('thetaModal')" class="text-gray-400 hover:text-gray-600">
                                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="space-y-4">
                                <div class="bg-red-50 rounded-lg p-4 border-l-4 border-red-500">
                                    <h3 class="font-semibold text-red-900 mb-2">What is Theta?</h3>
                                    <p class="text-red-800">Theta measures how much an option's price decreases each day due to the passage of time, assuming all other factors remain constant. This is known as "time decay."</p>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="bg-orange-50 rounded-lg p-4">
                                        <h4 class="font-semibold text-orange-900 mb-2">Time Decay Acceleration</h4>
                                        <ul class="text-sm text-orange-800 space-y-1">
                                            <li>• Faster near expiration</li>
                                            <li>• Non-linear decay pattern</li>
                                            <li>• Weekends count as 3 days</li>
                                            <li>• At-the-money highest theta</li>
                                        </ul>
                                    </div>
                                    <div class="bg-yellow-50 rounded-lg p-4">
                                        <h4 class="font-semibold text-yellow-900 mb-2">Theta Characteristics</h4>
                                        <ul class="text-sm text-yellow-800 space-y-1">
                                            <li>• Always negative for long options</li>
                                            <li>• Always positive for short options</li>
                                            <li>• Expressed as daily rate</li>
                                            <li>• Accelerates near expiration</li>
                                        </ul>
                                    </div>
                                </div>
                                
                                <div class="bg-blue-50 rounded-lg p-4">
                                    <h4 class="font-semibold text-blue-900 mb-2">Trading Strategies</h4>
                                    <ul class="text-sm text-blue-800 space-y-1">
                                        <li>• <strong>Theta Positive:</strong> Sell options to benefit from time decay</li>
                                        <li>• <strong>Theta Negative:</strong> Buy options when expecting big moves</li>
                                        <li>• <strong>Calendar Spreads:</strong> Profit from differential time decay</li>
                                        <li>• <strong>Iron Condors:</strong> Collect theta while limiting risk</li>
                                    </ul>
                                </div>
                                
                                <div class="bg-green-50 rounded-lg p-4">
                                    <h4 class="font-semibold text-green-900 mb-2">Managing Theta</h4>
                                    <ul class="text-sm text-green-800 space-y-1">
                                        <li>• Monitor days to expiration carefully</li>
                                        <li>• Consider rolling positions before heavy decay</li>
                                        <li>• Balance theta with other Greeks</li>
                                        <li>• Account for weekend and holiday effects</li>
                                    </ul>
                                </div>
                                
                                <div class="bg-gray-100 rounded-lg p-4">
                                    <h4 class="font-semibold text-gray-900 mb-2">Important Note</h4>
                                    <p class="text-sm text-gray-700">
                                        Theta decay accelerates dramatically in the final 30 days before expiration, 
                                        with the most rapid decay occurring in the last week.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Vega Modal -->
                <div id="vegaModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
                    <div class="flex items-center justify-center min-h-screen px-4">
                        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h2 class="text-2xl font-bold text-orange-900">Vega (ν) - Volatility Sensitivity</h2>
                                <button onclick="closeGreekModal('vegaModal')" class="text-gray-400 hover:text-gray-600">
                                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="space-y-4">
                                <div class="bg-orange-50 rounded-lg p-4 border-l-4 border-orange-500">
                                    <h3 class="font-semibold text-orange-900 mb-2">What is Vega?</h3>
                                    <p class="text-orange-800">Vega measures how much an option's price changes for every 1% change in the underlying asset's implied volatility, assuming all other factors remain constant.</p>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="bg-purple-50 rounded-lg p-4">
                                        <h4 class="font-semibold text-purple-900 mb-2">High Vega Exposure</h4>
                                        <ul class="text-sm text-purple-800 space-y-1">
                                            <li>• At-the-money options</li>
                                            <li>• Longer time to expiration</li>
                                            <li>• More sensitive to vol changes</li>
                                            <li>• Higher potential profits/losses</li>
                                        </ul>
                                    </div>
                                    <div class="bg-teal-50 rounded-lg p-4">
                                        <h4 class="font-semibold text-teal-900 mb-2">Low Vega Exposure</h4>
                                        <ul class="text-sm text-teal-800 space-y-1">
                                            <li>• Deep in/out-of-money</li>
                                            <li>• Short time to expiration</li>
                                            <li>• Less vol sensitivity</li>
                                            <li>• More predictable pricing</li>
                                        </ul>
                                    </div>
                                </div>
                                
                                <div class="bg-blue-50 rounded-lg p-4">
                                    <h4 class="font-semibold text-blue-900 mb-2">Volatility Trading</h4>
                                    <ul class="text-sm text-blue-800 space-y-1">
                                        <li>• <strong>Long Vega:</strong> Buy options when expecting volatility increase</li>
                                        <li>• <strong>Short Vega:</strong> Sell options when expecting volatility decrease</li>
                                        <li>• <strong>Volatility Arbitrage:</strong> Trade mispriced implied volatility</li>
                                        <li>• <strong>Straddles/Strangles:</strong> Pure volatility plays</li>
                                    </ul>
                                </div>
                                
                                <div class="bg-green-50 rounded-lg p-4">
                                    <h4 class="font-semibold text-green-900 mb-2">Market Events & Vega</h4>
                                    <ul class="text-sm text-green-800 space-y-1">
                                        <li>• Earnings announcements increase implied volatility</li>
                                        <li>• Economic events can spike volatility</li>
                                        <li>• Volatility tends to cluster</li>
                                        <li>• Mean reversion is common in volatility</li>
                                    </ul>
                                </div>
                                
                                <div class="bg-red-50 rounded-lg p-4">
                                    <h4 class="font-semibold text-red-900 mb-2">Vega Risk Management</h4>
                                    <ul class="text-sm text-red-800 space-y-1">
                                        <li>• Monitor portfolio vega exposure</li>
                                        <li>• Consider volatility term structure</li>
                                        <li>• Hedge with opposite vega positions</li>
                                        <li>• Be aware of volatility smile effects</li>
                                    </ul>
                                </div>
                                
                                <div class="bg-gray-100 rounded-lg p-4">
                                    <h4 class="font-semibold text-gray-900 mb-2">Remember</h4>
                                    <p class="text-sm text-gray-700">
                                        Vega is the same for calls and puts with the same strike price and expiration date. 
                                        It decreases as options move further in or out of the money.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                                 <!-- Rho Modal -->
                <div id="rhoModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
                    <div class="flex items-center justify-center min-h-screen px-4">
                        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h2 class="text-2xl font-bold text-teal-900">Rho (ρ) - Interest Rate Sensitivity</h2>
                                <button onclick="closeGreekModal('rhoModal')" class="text-gray-400 hover:text-gray-600">
                                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            <div class="space-y-4">
                                <div class="bg-teal-50 rounded-lg p-4 border-l-4 border-teal-500">
                                    <h3 class="font-semibold text-teal-900 mb-2">What is Rho?</h3>
                                    <p class="text-teal-800">Rho measures how much an option's price changes for every 1% change in interest rates, assuming all other factors remain constant.</p>
                                </div>
                                
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div class="bg-blue-50 rounded-lg p-4">
                                        <h4 class="font-semibold text-blue-900 mb-2">Call Options</h4>
                                        <ul class="text-sm text-blue-800 space-y-1">
                                            <li>• Positive rho</li>
                                            <li>• Higher rates = higher prices</li>
                                            <li>• In-the-money calls most sensitive</li>
                                            <li>• Longer expiration = higher rho</li>
                                        </ul>
                                    </div>
                                    <div class="bg-red-50 rounded-lg p-4">
                                        <h4 class="font-semibold text-red-900 mb-2">Put Options</h4>
                                        <ul class="text-sm text-red-800 space-y-1">
                                            <li>• Negative rho</li>
                                            <li>• Higher rates = lower prices</li>
                                            <li>• In-the-money puts most sensitive</li>
                                            <li>• Longer expiration = more negative rho</li>
                                        </ul>
                                    </div>
                                </div>
                                
                                <div class="bg-yellow-50 rounded-lg p-4">
                                    <h4 class="font-semibold text-yellow-900 mb-2">When Rho Matters Most</h4>
                                    <ul class="text-sm text-yellow-800 space-y-1">
                                        <li>• <strong>Long-term options:</strong> LEAPS are most sensitive</li>
                                        <li>• <strong>Rate environment changes:</strong> Fed policy shifts</li>
                                        <li>• <strong>Deep in-the-money:</strong> Higher absolute rho values</li>
                                        <li>• <strong>High rate volatility:</strong> Uncertain monetary policy</li>
                                    </ul>
                                </div>
                                
                                <div class="bg-green-50 rounded-lg p-4">
                                    <h4 class="font-semibold text-green-900 mb-2">Interest Rate Impact</h4>
                                    <ul class="text-sm text-green-800 space-y-1">
                                        <li>• Present value of strike price changes with rates</li>
                                        <li>• Carrying cost of underlying asset affected</li>
                                        <li>• Risk-free rate used in Black-Scholes model</li>
                                        <li>• Dividend discount rates also affected</li>
                                    </ul>
                                </div>
                                
                                <div class="bg-purple-50 rounded-lg p-4">
                                    <h4 class="font-semibold text-purple-900 mb-2">Practical Considerations</h4>
                                    <ul class="text-sm text-purple-800 space-y-1">
                                        <li>• Usually the least important Greek for most traders</li>
                                        <li>• More relevant for institutional portfolios</li>
                                        <li>• Consider when holding long-term positions</li>
                                        <li>• Monitor during Fed announcement periods</li>
                                    </ul>
                                </div>
                                
                                <div class="bg-gray-100 rounded-lg p-4">
                                    <h4 class="font-semibold text-gray-900 mb-2">Example</h4>
                                    <p class="text-sm text-gray-700">
                                        If a call option has a rho of 0.05 and interest rates increase by 1%, 
                                        the option price will increase by approximately $0.05.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Notes Content -->
                <div id="notesContent" class="page-content hidden">
                    <div class="mb-6">
                        <h1 class="text-2xl font-bold text-gray-900">Notes</h1>
                        <p class="text-gray-600">Create, organize, and manage your trading notes and ideas</p>
                    </div>

                    <!-- Notes Header Actions -->
                    <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between">
                            <div class="flex-1 mb-4 lg:mb-0 lg:mr-6">
                                <div class="flex space-x-4">
                                    <div class="relative flex-1">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                            </svg>
                                        </div>
                                        <input type="text" id="noteSearch" class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg text-sm placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Search notes..." onkeyup="searchNotes()">
                                    </div>
                                    <select id="categoryFilter" class="custom-select px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white text-gray-700" onchange="filterNotes()">
                                        <option value="">All Categories</option>
                                        <option value="general">General</option>
                                        <option value="trading">Trading Strategy</option>
                                        <option value="analysis">Market Analysis</option>
                                        <option value="research">Research</option>
                                        <option value="ideas">Ideas</option>
                                        <option value="watchlist">Watchlist</option>
                                    </select>
                                </div>
                            </div>
                            <div class="flex space-x-3">
                                <button onclick="toggleViewMode()" id="viewModeToggle" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors flex items-center">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"></path>
                                    </svg>
                                    Table View
                                </button>
                                <button onclick="showFileUploadModal()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-medium transition-colors flex items-center">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                    </svg>
                                    Upload Files
                                </button>
                                <button onclick="showNewNoteModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors flex items-center">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                                    </svg>
                                    New Note
                                </button>
                                <button onclick="exportNotes()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors flex items-center">
                                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                    Export
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Bulk Actions Bar -->
                    <div id="bulkActionsBar" class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6 hidden">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4">
                                <span id="selectedCount" class="text-sm font-medium text-yellow-800">0 notes selected</span>
                                <button onclick="selectAllNotes()" class="text-sm text-yellow-700 hover:text-yellow-900 font-medium">Select All</button>
                                <button onclick="clearSelection()" class="text-sm text-yellow-700 hover:text-yellow-900 font-medium">Clear Selection</button>
                            </div>
                            <div class="flex space-x-2">
                                <button onclick="bulkCategorize()" class="bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-1 rounded text-sm font-medium transition-colors">
                                    Categorize
                                </button>
                                <button onclick="bulkDelete()" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm font-medium transition-colors">
                                    Delete
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Notes Data Table -->
                    <div id="notesTableContainer" class="bg-white rounded-lg shadow-md overflow-hidden">
                        <div class="overflow-x-auto">
                            <table id="notesTable" class="min-w-full divide-y divide-gray-200">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            <input type="checkbox" id="selectAllCheckbox" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500" onchange="toggleSelectAll()">
                                        </th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer" onclick="sortTable('title')">
                                            <div class="flex items-center">
                                                Title
                                                <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l4-4 4 4m0 6l-4 4-4-4"></path>
                                                </svg>
                                            </div>
                                        </th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer" onclick="sortTable('category')">
                                            <div class="flex items-center">
                                                Category
                                                <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l4-4 4 4m0 6l-4 4-4-4"></path>
                                                </svg>
                                            </div>
                                        </th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Content Preview
                                        </th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Files
                                        </th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Similarities
                                        </th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer" onclick="sortTable('lastModified')">
                                            <div class="flex items-center">
                                                Last Modified
                                                <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 9l4-4 4 4m0 6l-4 4-4-4"></path>
                                                </svg>
                                            </div>
                                        </th>
                                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            Actions
                                        </th>
                                    </tr>
                                </thead>
                                <tbody id="notesTableBody" class="bg-white divide-y divide-gray-200">
                                    <!-- Notes will be populated here -->
                                </tbody>
                            </table>
                        </div>
                        
                        <!-- Pagination -->
                        <div id="notesPagination" class="bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6">
                            <div class="flex-1 flex justify-between sm:hidden">
                                <button onclick="previousPage()" class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                                    Previous
                                </button>
                                <button onclick="nextPage()" class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                                    Next
                                </button>
                            </div>
                            <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
                                <div>
                                    <p class="text-sm text-gray-700">
                                        Showing <span id="showingStart" class="font-medium">1</span> to <span id="showingEnd" class="font-medium">10</span> of <span id="totalNotes" class="font-medium">0</span> notes
                                    </p>
                                </div>
                                <div>
                                    <nav class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px" aria-label="Pagination">
                                        <button onclick="previousPage()" class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                            Previous
                                        </button>
                                        <div id="paginationNumbers" class="flex">
                                            <!-- Page numbers will be populated here -->
                                        </div>
                                        <button onclick="nextPage()" class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                            Next
                                        </button>
                                    </nav>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Notes Grid (Card View) -->
                    <div id="notesGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6 hidden">
                        <!-- Notes will be populated here -->
                    </div>

                    <!-- Empty State -->
                    <div id="emptyNotesState" class="bg-white rounded-lg shadow-md p-12 text-center hidden">
                        <svg class="w-16 h-16 mx-auto mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                        </svg>
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">No notes yet</h3>
                        <p class="text-gray-600 mb-4">Start by creating your first note to capture trading ideas and strategies.</p>
                        <button onclick="showNewNoteModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                            Create First Note
                        </button>
                    </div>
                </div>

                <!-- Note Modal -->
                <div id="noteModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
                    <div class="flex items-center justify-center min-h-screen px-4">
                        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h2 id="noteModalTitle" class="text-xl font-bold text-gray-900">New Note</h2>
                                <button onclick="closeNoteModal()" class="text-gray-400 hover:text-gray-600">
                                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            
                            <form id="noteForm" class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Title</label>
                                    <input type="text" id="noteTitle" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Enter note title..." required>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
                                    <select id="noteCategory" class="custom-select w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white text-gray-700">
                                        <option value="general">General</option>
                                        <option value="trading">Trading Strategy</option>
                                        <option value="analysis">Market Analysis</option>
                                        <option value="research">Research</option>
                                        <option value="ideas">Ideas</option>
                                        <option value="watchlist">Watchlist</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Content</label>
                                    <textarea id="noteContent" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" rows="8" placeholder="Write your note here..." required></textarea>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Attached Files</label>
                                    <div id="noteAttachments" class="border border-gray-300 rounded-lg p-3 bg-gray-50 min-h-[80px]">
                                        <div id="attachmentsList" class="space-y-2">
                                            <!-- Attached files will be shown here -->
                                        </div>
                                        <button type="button" onclick="attachFilesToNote()" class="mt-2 text-sm text-blue-600 hover:text-blue-800 font-medium flex items-center">
                                            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"></path>
                                            </svg>
                                            Attach Files
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="flex justify-end space-x-3 pt-4">
                                    <button type="button" onclick="closeNoteModal()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                        Cancel
                                    </button>
                                    <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                        Save Note
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- File Upload Modal -->
                <div id="fileUploadModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
                    <div class="flex items-center justify-center min-h-screen px-4">
                        <div class="bg-white rounded-lg shadow-xl w-full max-w-lg p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h2 class="text-xl font-bold text-gray-900">Upload Files</h2>
                                <button onclick="closeFileUploadModal()" class="text-gray-400 hover:text-gray-600">
                                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            
                            <!-- File Drop Zone -->
                            <div id="fileDropZone" class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-gray-400 transition-colors cursor-pointer">
                                <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                </svg>
                                <p class="mt-2 text-sm text-gray-600">
                                    <span class="font-medium text-blue-600 hover:text-blue-500">Click to upload</span> or drag and drop
                                </p>
                                <p class="text-xs text-gray-500">PNG, JPG, PDF, DOC, TXT up to 10MB</p>
                                <input type="file" id="fileInput" class="hidden" multiple accept=".png,.jpg,.jpeg,.pdf,.doc,.docx,.txt,.md" onchange="handleFileSelect(event)">
                            </div>
                            
                            <!-- File List -->
                            <div id="fileList" class="mt-4 space-y-2 max-h-40 overflow-y-auto">
                                <!-- Files will be listed here -->
                            </div>
                            
                            <!-- Upload Progress -->
                            <div id="uploadProgress" class="mt-4 hidden">
                                <div class="flex items-center justify-between text-sm text-gray-600 mb-2">
                                    <span>Uploading files...</span>
                                    <span id="progressPercent">0%</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div id="progressBar" class="bg-blue-600 h-2 rounded-full transition-all duration-300 ease-in-out" style="width: 0%"></div>
                                </div>
                            </div>
                            
                            <div class="flex justify-end space-x-3 pt-4">
                                <button type="button" onclick="closeFileUploadModal()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                    Cancel
                                </button>
                                <button type="button" onclick="uploadFiles()" id="uploadButton" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50" disabled>
                                    Upload Files
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bulk Categorize Modal -->
                <div id="bulkCategorizeModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
                    <div class="flex items-center justify-center min-h-screen px-4">
                        <div class="bg-white rounded-lg shadow-xl w-full max-w-md p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h2 class="text-xl font-bold text-gray-900">Bulk Categorize</h2>
                                <button onclick="closeBulkCategorizeModal()" class="text-gray-400 hover:text-gray-600">
                                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            
                            <p class="text-gray-600 mb-4">Select a category to apply to all selected notes:</p>
                            
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Category</label>
                                <select id="bulkCategorySelect" class="custom-select w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 bg-white text-gray-700">
                                    <option value="general">General</option>
                                    <option value="trading">Trading Strategy</option>
                                    <option value="analysis">Market Analysis</option>
                                    <option value="research">Research</option>
                                    <option value="ideas">Ideas</option>
                                    <option value="watchlist">Watchlist</option>
                                </select>
                            </div>
                            
                            <div class="flex justify-end space-x-3">
                                <button type="button" onclick="closeBulkCategorizeModal()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                    Cancel
                                </button>
                                <button type="button" onclick="applyBulkCategorize()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition-colors">
                                    Apply Category
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Note Similarities Modal -->
                <div id="similaritiesModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
                    <div class="flex items-center justify-center min-h-screen px-4">
                        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl p-6">
                            <div class="flex items-center justify-between mb-4">
                                <h2 class="text-xl font-bold text-gray-900">Similar Notes</h2>
                                <button onclick="closeSimilaritiesModal()" class="text-gray-400 hover:text-gray-600">
                                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                    </svg>
                                </button>
                            </div>
                            
                            <div id="similaritiesContent" class="space-y-4">
                                <!-- Similarities will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
                
            </div>
        </main>
    </div>

    <!-- Mobile Overlay -->
    <div id="mobileOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden lg:hidden"></div>

    <!-- Profile Modal -->
    <!-- Add Trade Modal -->
    <div id="addTradeModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-lg p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold text-gray-900">Add New Trade</h2>
                    <button id="closeAddTradeModal" class="text-gray-400 hover:text-gray-600">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <form id="addTradeForm" class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Symbol</label>
                            <input type="text" id="tradeSymbol" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="AAPL" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Type</label>
                            <select id="tradeType" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="BUY">Buy</option>
                                <option value="SELL">Sell</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Quantity</label>
                            <input type="number" id="tradeQuantity" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="100" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Price ($)</label>
                            <input type="number" id="tradePrice" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="150.00" required>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Entry Date</label>
                            <input type="date" id="tradeDate" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Strategy</label>
                            <select id="tradeStrategy" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="Long Term">Long Term</option>
                                <option value="Swing Trade">Swing Trade</option>
                                <option value="Day Trade">Day Trade</option>
                                <option value="Options">Options</option>
                                <option value="Scalping">Scalping</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Notes (Optional)</label>
                        <textarea id="tradeNotes" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Trade rationale, stop loss, target..."></textarea>
                    </div>
                    
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" id="cancelAddTrade" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">Cancel</button>
                        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Add Trade</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Add Watchlist Modal -->
    <div id="addWatchlistModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-md p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold text-gray-900">Add to Watchlist</h2>
                    <button id="closeAddWatchlistModal" class="text-gray-400 hover:text-gray-600">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <form id="addWatchlistForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Symbol</label>
                        <input type="text" id="watchlistSymbol" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500" placeholder="AAPL" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Target Price ($)</label>
                        <input type="number" id="watchlistTargetPrice" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500" placeholder="200.00" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Alert Type</label>
                        <select id="watchlistAlertType" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500">
                            <option value="Above">Above Target</option>
                            <option value="Below">Below Target</option>
                            <option value="Both">Both Directions</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Notes (Optional)</label>
                        <textarea id="watchlistNotes" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500" placeholder="Reason for watching..."></textarea>
                    </div>
                    
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" id="cancelAddWatchlist" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">Cancel</button>
                        <button type="submit" class="px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700">Add to Watchlist</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Trade Journal Modal -->
    <div id="tradeJournalModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold text-gray-900">Add Trade Journal Entry</h2>
                    <button id="closeTradeJournalModal" class="text-gray-400 hover:text-gray-600">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <form id="tradeJournalForm" class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Symbol</label>
                            <input type="text" id="journalSymbol" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="AAPL" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Trade Date</label>
                            <input type="date" id="journalDate" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Entry Price ($)</label>
                            <input type="number" id="journalEntryPrice" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="150.00" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Exit Price ($)</label>
                            <input type="number" id="journalExitPrice" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="160.00">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Position Size</label>
                            <input type="number" id="journalPositionSize" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="100" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Trade Type</label>
                            <select id="journalTradeType" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="Long">Long</option>
                                <option value="Short">Short</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Strategy Used</label>
                        <select id="journalStrategy" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="Breakout">Breakout</option>
                            <option value="Mean Reversion">Mean Reversion</option>
                            <option value="Trend Following">Trend Following</option>
                            <option value="Swing Trading">Swing Trading</option>
                            <option value="Scalping">Scalping</option>
                            <option value="Options">Options</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Trade Notes</label>
                        <textarea id="journalNotes" rows="4" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="What worked? What didn't? Key lessons learned..."></textarea>
                    </div>
                    
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" id="cancelTradeJournal" class="px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50">Cancel</button>
                        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Add Entry</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="profileModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-md p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold text-gray-900">Profile Information</h2>
                    <button id="closeProfileModal" class="text-gray-400 hover:text-gray-600">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                        <input type="text" id="profileFullName" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter your full name">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                        <input type="email" id="profileEmailAddress" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" readonly>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
                        <input type="tel" id="profilePhoneNumber" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" placeholder="Enter your phone number">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Department</label>
                                                    <select id="profileDepartment" class="custom-select w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 bg-white text-gray-700">
                            <option value="">Select Department</option>
                            <option value="finance">Finance</option>
                            <option value="marketing">Marketing</option>
                            <option value="sales">Sales</option>
                            <option value="hr">Human Resources</option>
                            <option value="it">Information Technology</option>
                        </select>
                    </div>
                    <div class="flex space-x-3 pt-4">
                        <button id="saveProfile" class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-4 rounded-lg transition-colors">Save Changes</button>
                        <button id="cancelProfile" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-2 px-4 rounded-lg transition-colors">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Preferences Modal -->
    <div id="preferencesModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-md p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold text-gray-900">Preferences</h2>
                    <button id="closePreferencesModal" class="text-gray-400 hover:text-gray-600">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                <div class="space-y-4">
                    <div class="flex items-center justify-between">
                        <span class="text-sm font-medium text-gray-700">Email Notifications</span>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="emailNotifications" class="sr-only peer" checked>
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"></div>
                        </label>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-sm font-medium text-gray-700">Push Notifications</span>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="pushNotifications" class="sr-only peer">
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"></div>
                        </label>
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-sm font-medium text-gray-700">Auto-save</span>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="autoSave" class="sr-only peer" checked>
                            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"></div>
                        </label>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Theme</label>
                                                    <select id="themePreference" class="custom-select w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 bg-white text-gray-700">
                            <option value="light">Light</option>
                            <option value="dark">Dark</option>
                            <option value="auto">Auto</option>
                        </select>
                    </div>
                    <div class="flex space-x-3 pt-4">
                        <button id="savePreferences" class="flex-1 bg-indigo-600 hover:bg-indigo-700 text-white font-medium py-2 px-4 rounded-lg transition-colors">Save Preferences</button>
                        <button id="cancelPreferences" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-2 px-4 rounded-lg transition-colors">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-lg p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold text-gray-900">Help & Support</h2>
                    <button id="closeHelpModal" class="text-gray-400 hover:text-gray-600">
                        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                <div class="space-y-4">
                    <div>
                        <h3 class="font-semibold text-gray-900 mb-2">Frequently Asked Questions</h3>
                        <div class="space-y-2">
                            <details class="bg-gray-50 rounded-lg p-3">
                                <summary class="cursor-pointer font-medium text-gray-700">How to reset my password?</summary>
                                <p class="mt-2 text-sm text-gray-600">Go to the login page and click "Forgot Password" to reset your password.</p>
                            </details>
                            <details class="bg-gray-50 rounded-lg p-3">
                                <summary class="cursor-pointer font-medium text-gray-700">How to update my profile?</summary>
                                <p class="mt-2 text-sm text-gray-600">Click on your profile icon in the top right corner and select "Profile" to update your information.</p>
                            </details>
                            <details class="bg-gray-50 rounded-lg p-3">
                                <summary class="cursor-pointer font-medium text-gray-700">How to contact support?</summary>
                                <p class="mt-2 text-sm text-gray-600">You can reach our support team at support@example.com or call 1-800-SUPPORT.</p>
                            </details>
                        </div>
                    </div>
                    <div class="pt-4">
                        <h3 class="font-semibold text-gray-900 mb-2">Contact Support</h3>
                        <div class="space-y-2">
                            <p class="text-sm text-gray-600">Email: support@example.com</p>
                            <p class="text-sm text-gray-600">Phone: 1-800-SUPPORT</p>
                            <p class="text-sm text-gray-600">Live Chat: Available 24/7</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Main Application JavaScript
        class WebAppManager {
            constructor() {
                this.currentUser = null;
                this.searchHistory = [];

                this.initializeApp();
            }

            initializeApp() {
                this.checkAuthentication();
                this.initializeEventListeners();
                this.loadUserData();
                this.setupNavigation();

                this.ensureSidebarVisibility();
                
                // Add test method to window for debugging
                window.testNavigation = (page) => this.switchPage(page);
                
                // Ensure sidebar stays visible on window resize
                window.addEventListener('resize', () => {
                    this.ensureSidebarVisibility();
                });
            }

            checkAuthentication() {
                const sessionData = localStorage.getItem('userSession') || sessionStorage.getItem('userSession');
                
                if (!sessionData) {
                    window.location.href = 'login.html';
                    return;
                }

                try {
                    const session = JSON.parse(sessionData);
                    this.currentUser = session.user;
                } catch (error) {
                    console.error('Error parsing session data:', error);
                    window.location.href = 'login.html';
                }
            }

            loadUserData() {
                if (!this.currentUser) return;

                const userInitials = this.currentUser.email.substring(0, 2).toUpperCase();
                const userName = this.currentUser.email.split('@')[0];

                // Update all user display elements
                const userInitialsElement = document.getElementById('userInitials');
                if (userInitialsElement) userInitialsElement.textContent = userInitials;
                
                const profileInitialsElement = document.getElementById('profileInitials');
                if (profileInitialsElement) profileInitialsElement.textContent = userInitials;
                
                const sidebarUserNameElement = document.getElementById('sidebarUserName');
                if (sidebarUserNameElement) sidebarUserNameElement.textContent = userName;
                
                const profileNameElement = document.getElementById('profileName');
                if (profileNameElement) profileNameElement.textContent = userName;
                
                const dropdownUserNameElement = document.getElementById('dropdownUserName');
                if (dropdownUserNameElement) dropdownUserNameElement.textContent = userName;
                
                const sidebarUserEmailElement = document.getElementById('sidebarUserEmail');
                if (sidebarUserEmailElement) sidebarUserEmailElement.textContent = this.currentUser.email;
                
                const dropdownUserEmailElement = document.getElementById('dropdownUserEmail');
                if (dropdownUserEmailElement) dropdownUserEmailElement.textContent = this.currentUser.email;

                // Show/hide admin link based on user role
                const adminLink = document.getElementById('adminLink');
                if (this.currentUser.role === 'admin') {
                    adminLink.style.display = 'block';
                } else {
                    adminLink.style.display = 'none';
                }
            }

            initializeEventListeners() {
                // Mobile menu toggle
                document.getElementById('mobileMenuToggle').addEventListener('click', () => {
                    this.toggleMobileSidebar();
                });

                // Sidebar toggle
                document.getElementById('sidebarToggle').addEventListener('click', () => {
                    this.toggleMobileSidebar();
                });

                // Mobile overlay
                document.getElementById('mobileOverlay').addEventListener('click', () => {
                    this.closeMobileSidebar();
                });

                // Profile dropdown
                document.getElementById('profileButton').addEventListener('click', () => {
                    this.toggleProfileDropdown();
                });

                // Search functionality
                document.getElementById('searchInput').addEventListener('input', (e) => {
                    this.handleSearch(e.target.value);
                });

                document.getElementById('searchInput').addEventListener('focus', () => {
                    this.showSearchResults();
                });

                // Close dropdowns when clicking outside
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('#profileButton') && !e.target.closest('#profileDropdown')) {
                        this.hideProfileDropdown();
                    }
                    if (!e.target.closest('#searchInput') && !e.target.closest('#searchResults')) {
                        this.hideSearchResults();
                    }
                });

                // Logout functionality
                document.getElementById('logoutButton').addEventListener('click', () => {
                    this.logout();
                });

                // Admin link
                document.getElementById('adminLink').addEventListener('click', (e) => {
                    e.preventDefault();
                    window.location.href = 'admin.html';
                });

                // Profile dropdown links
                document.getElementById('profileLink').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.showProfileModal();
                });

                document.getElementById('settingsLink').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.switchPage('settings');
                    this.hideProfileDropdown();
                });

                document.getElementById('preferencesLink').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.showPreferencesModal();
                });

                document.getElementById('helpLink').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.showHelpModal();
                });



                // Notification bell functionality
                document.getElementById('notificationBell').addEventListener('click', () => {
                    this.toggleNotificationDropdown();
                });

                document.getElementById('markAllRead').addEventListener('click', () => {
                    this.markAllNotificationsAsRead();
                });

                // Financial calculator functionality
                document.getElementById('calculateButton').addEventListener('click', () => {
                    this.calculateFinancialProjection();
                });

                // Close notification dropdown when clicking outside
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('#notificationBell') && !e.target.closest('#notificationDropdown')) {
                        this.hideNotificationDropdown();
                    }
                });

                // Initialize notifications and financial tools
                this.initializeNotifications();
                this.initializeFinancialTools();
                this.initializeModals();
            }

            setupNavigation() {
                const navLinks = document.querySelectorAll('.nav-link');
                
                navLinks.forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const page = link.getAttribute('data-page');
                        this.switchPage(page);
                    });
                });
            }

            switchPage(page) {
                // Hide all page contents
                document.querySelectorAll('.page-content').forEach(content => {
                    content.classList.add('hidden');
                });

                // Show selected page
                const pageContentId = page + 'Content';
                const pageContent = document.getElementById(pageContentId);
                
                if (pageContent) {
                    pageContent.classList.remove('hidden');
                }

                // Update active nav link
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active', 'text-indigo-600', 'bg-indigo-50');
                    link.classList.add('text-gray-700');
                });

                const activeLink = document.querySelector(`[data-page="${page}"]`);
                if (activeLink) {
                    activeLink.classList.add('active', 'text-indigo-600', 'bg-indigo-50');
                    activeLink.classList.remove('text-gray-700');
                }

                // Close mobile sidebar if open (only on mobile)
                if (window.innerWidth < 1024) {
                    this.closeMobileSidebar();
                }

                // Special handling for pages
                if (page === 'financial-analysis') {
                    this.refreshFinancialData();
                } else if (page === 'charts') {
                    initializeChartsPage();
                }
            }

            toggleMobileSidebar() {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('mobileOverlay');
                
                sidebar.classList.toggle('sidebar-hidden');
                overlay.classList.toggle('hidden');
            }

            closeMobileSidebar() {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('mobileOverlay');
                
                sidebar.classList.add('sidebar-hidden');
                overlay.classList.add('hidden');
            }

            toggleProfileDropdown() {
                const dropdown = document.getElementById('profileDropdown');
                if (dropdown.classList.contains('hidden')) {
                    dropdown.classList.remove('hidden');
                    // Trigger animation after showing
                    setTimeout(() => dropdown.classList.add('show'), 10);
                } else {
                    dropdown.classList.remove('show');
                    // Hide after animation completes
                    setTimeout(() => dropdown.classList.add('hidden'), 100);
                }
            }

            hideProfileDropdown() {
                const dropdown = document.getElementById('profileDropdown');
                dropdown.classList.remove('show');
                setTimeout(() => dropdown.classList.add('hidden'), 100);
            }

            handleSearch(query) {
                if (query.length < 2) {
                    this.hideSearchResults();
                    return;
                }

                // Simulate search results
                const results = this.performSearch(query);
                this.displaySearchResults(results);
            }

            performSearch(query) {
                const mockData = [
                    { title: 'Dashboard Analytics', type: 'page', url: '#dashboard' },
                    { title: 'Project Management', type: 'page', url: '#projects' },
                    { title: 'Financial Analysis', type: 'page', url: '#financial-analysis' },
                    { title: 'Signal Generator', type: 'page', url: '#signals' },
                    { title: 'Charts & Trading', type: 'page', url: '#charts' },
                    { title: 'Revenue Report', type: 'document', url: '#reports' },
                    { title: 'Team Members', type: 'people', url: '#team' }
                ];

                return mockData.filter(item => 
                    item.title.toLowerCase().includes(query.toLowerCase())
                );
            }

            displaySearchResults(results) {
                const resultsList = document.getElementById('searchResultsList');
                
                if (results.length === 0) {
                    resultsList.innerHTML = '<div class="text-sm text-gray-500">No results found</div>';
                } else {
                    resultsList.innerHTML = results.map(result => `
                        <div class="flex items-center space-x-3 p-2 hover:bg-gray-50 rounded cursor-pointer">
                            <div class="h-8 w-8 bg-indigo-100 rounded flex items-center justify-center">
                                <svg class="h-4 w-4 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                            </div>
                            <div>
                                <div class="text-sm font-medium text-gray-900">${result.title}</div>
                                <div class="text-xs text-gray-500">${result.type}</div>
                            </div>
                        </div>
                    `).join('');
                }
                
                this.showSearchResults();
            }

            showSearchResults() {
                const resultsDiv = document.getElementById('searchResults');
                resultsDiv.classList.remove('hidden');
            }

            hideSearchResults() {
                const resultsDiv = document.getElementById('searchResults');
                resultsDiv.classList.add('hidden');
            }

            logout() {
                // Clear session data
                localStorage.removeItem('userSession');
                sessionStorage.removeItem('userSession');
                
                // Redirect to login
                window.location.href = 'login.html';
            }



            ensureSidebarVisibility() {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('mobileOverlay');
                
                if (window.innerWidth >= 1024) {
                    // Desktop: Always show sidebar
                    if (sidebar) {
                        sidebar.classList.remove('sidebar-hidden');
                    }
                    if (overlay) {
                        overlay.classList.add('hidden');
                    }
                } else {
                    // Mobile: Keep current state but ensure overlay is hidden if sidebar is hidden
                    if (sidebar && sidebar.classList.contains('sidebar-hidden') && overlay) {
                        overlay.classList.add('hidden');
                    }
                }
            }

            // Notification functionality
            toggleNotificationDropdown() {
                const dropdown = document.getElementById('notificationDropdown');
                if (dropdown.classList.contains('hidden')) {
                    dropdown.classList.remove('hidden');
                    // Trigger animation after showing
                    setTimeout(() => dropdown.classList.add('show'), 10);
                } else {
                    dropdown.classList.remove('show');
                    // Hide after animation completes
                    setTimeout(() => dropdown.classList.add('hidden'), 100);
                }
            }

            hideNotificationDropdown() {
                const dropdown = document.getElementById('notificationDropdown');
                dropdown.classList.remove('show');
                setTimeout(() => dropdown.classList.add('hidden'), 100);
            }

            initializeNotifications() {
                this.notifications = [
                    {
                        id: 1,
                        title: 'New user registration',
                        message: 'A new user has registered to your system',
                        time: '2 minutes ago',
                        type: 'info',
                        isRead: false
                    },
                    {
                        id: 2,
                        title: 'Portfolio alert',
                        message: 'Your portfolio has increased by 5.2% today',
                        time: '1 hour ago',
                        type: 'success',
                        isRead: false
                    },
                    {
                        id: 3,
                        title: 'System maintenance',
                        message: 'Scheduled maintenance tonight at 11 PM',
                        time: '3 hours ago',
                        type: 'warning',
                        isRead: false
                    }
                ];

                this.updateNotificationDisplay();
            }

            updateNotificationDisplay() {
                const notificationList = document.getElementById('notificationList');
                const notificationCount = document.getElementById('notificationCount');
                
                const unreadCount = this.notifications.filter(n => !n.isRead).length;
                notificationCount.textContent = unreadCount;
                
                if (unreadCount === 0) {
                    notificationCount.style.display = 'none';
                } else {
                    notificationCount.style.display = 'flex';
                }

                notificationList.innerHTML = this.notifications.map(notification => `
                    <div class="notification-item p-3 ${notification.isRead ? 'bg-gray-50' : 'bg-white'} border-l-4 ${this.getNotificationColor(notification.type)} rounded-r-lg">
                        <div class="flex items-start">
                            <div class="flex-shrink-0">
                                ${this.getNotificationIcon(notification.type)}
                            </div>
                            <div class="ml-3 flex-1">
                                <p class="text-sm font-medium text-gray-900">${notification.title}</p>
                                <p class="text-sm text-gray-600">${notification.message}</p>
                                <p class="text-xs text-gray-400 mt-1">${notification.time}</p>
                            </div>
                            ${!notification.isRead ? '<div class="w-2 h-2 bg-blue-500 rounded-full mt-2"></div>' : ''}
                        </div>
                    </div>
                `).join('');
            }

            getNotificationColor(type) {
                switch (type) {
                    case 'success': return 'border-green-500';
                    case 'warning': return 'border-yellow-500';
                    case 'error': return 'border-red-500';
                    default: return 'border-blue-500';
                }
            }

            getNotificationIcon(type) {
                switch (type) {
                    case 'success':
                        return '<svg class="h-5 w-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
                    case 'warning':
                        return '<svg class="h-5 w-5 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>';
                    case 'error':
                        return '<svg class="h-5 w-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
                    default:
                        return '<svg class="h-5 w-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
                }
            }

            markAllNotificationsAsRead() {
                this.notifications.forEach(notification => {
                    notification.isRead = true;
                });
                this.updateNotificationDisplay();
            }

            // Financial functionality
            initializeFinancialTools() {
                this.financialData = {
                    portfolioValue: 142850,
                    dailyPL: 3420,
                    activePositions: 23,
                    winRate: 68.5,
                    marketIndices: {
                        'S&P 500': { price: 4234.56, change: 2.3 },
                        'NASDAQ': { price: 13456.78, change: -1.2 },
                        'DOW JONES': { price: 34567.89, change: 0.8 }
                    }
                };
            }

            calculateFinancialProjection() {
                const initialInvestment = parseFloat(document.getElementById('initialInvestment').value) || 0;
                const monthlyContribution = parseFloat(document.getElementById('monthlyContribution').value) || 0;
                const expectedReturn = parseFloat(document.getElementById('expectedReturn').value) || 0;
                const years = 10; // Default to 10 years

                if (initialInvestment <= 0 || expectedReturn <= 0) {
                    document.getElementById('calculationResult').innerHTML = 'Please enter valid amounts';
                    return;
                }

                const monthlyRate = expectedReturn / 100 / 12;
                const months = years * 12;
                
                let futureValue = initialInvestment;
                
                if (monthlyContribution > 0) {
                    // Calculate compound interest with monthly contributions
                    futureValue = initialInvestment * Math.pow(1 + monthlyRate, months);
                    futureValue += monthlyContribution * (Math.pow(1 + monthlyRate, months) - 1) / monthlyRate;
                } else {
                    // Simple compound interest
                    futureValue = initialInvestment * Math.pow(1 + monthlyRate, months);
                }

                const totalContributed = initialInvestment + (monthlyContribution * months);
                const totalGain = futureValue - totalContributed;

                document.getElementById('calculationResult').innerHTML = `
                    <div class="text-sm">
                        <p class="font-bold text-green-600">Future Value: $${futureValue.toLocaleString('en-US', { maximumFractionDigits: 0 })}</p>
                        <p class="text-gray-600">Total Contributed: $${totalContributed.toLocaleString('en-US', { maximumFractionDigits: 0 })}</p>
                        <p class="text-gray-600">Total Gain: $${totalGain.toLocaleString('en-US', { maximumFractionDigits: 0 })}</p>
                    </div>
                `;
            }

            refreshFinancialData() {
                // Simulate real-time data updates
                this.financialData.portfolioValue += Math.random() * 1000 - 500;
                this.financialData.dailyPL += Math.random() * 200 - 100;
                
                // Update market indices with random changes
                Object.keys(this.financialData.marketIndices).forEach(key => {
                    const index = this.financialData.marketIndices[key];
                    const change = (Math.random() - 0.5) * 2;
                    index.change = change;
                    index.price = index.price * (1 + change / 100);
                });

                // Update UI if on financial analysis page
                const financialContent = document.getElementById('financial-analysisContent');
                if (financialContent && !financialContent.classList.contains('hidden')) {
                    this.updateFinancialDisplay();
                }
            }

            updateFinancialDisplay() {
                // Update portfolio value cards with real-time data
                const portfolioElements = document.querySelectorAll('#financial-analysisContent .text-2xl');
                if (portfolioElements.length > 0) {
                    portfolioElements[0].textContent = `$${this.financialData.portfolioValue.toLocaleString('en-US', { maximumFractionDigits: 0 })}`;
                    portfolioElements[1].textContent = `+$${this.financialData.dailyPL.toLocaleString('en-US', { maximumFractionDigits: 0 })}`;
                }
            }

            // Modal functionality
            initializeModals() {
                // Profile modal event listeners
                document.getElementById('closeProfileModal').addEventListener('click', () => {
                    this.hideProfileModal();
                });
                document.getElementById('saveProfile').addEventListener('click', () => {
                    this.saveProfileData();
                });
                document.getElementById('cancelProfile').addEventListener('click', () => {
                    this.hideProfileModal();
                });

                // Preferences modal event listeners
                document.getElementById('closePreferencesModal').addEventListener('click', () => {
                    this.hidePreferencesModal();
                });
                document.getElementById('savePreferences').addEventListener('click', () => {
                    this.savePreferencesData();
                });
                document.getElementById('cancelPreferences').addEventListener('click', () => {
                    this.hidePreferencesModal();
                });

                // Help modal event listeners
                document.getElementById('closeHelpModal').addEventListener('click', () => {
                    this.hideHelpModal();
                });

                // Close modals on background click
                document.getElementById('profileModal').addEventListener('click', (e) => {
                    if (e.target === e.currentTarget) {
                        this.hideProfileModal();
                    }
                });
                document.getElementById('preferencesModal').addEventListener('click', (e) => {
                    if (e.target === e.currentTarget) {
                        this.hidePreferencesModal();
                    }
                });
                document.getElementById('helpModal').addEventListener('click', (e) => {
                    if (e.target === e.currentTarget) {
                        this.hideHelpModal();
                    }
                });
                
                // Add Trade modal event listeners
                document.getElementById('closeAddTradeModal').addEventListener('click', hideAddTradeModal);
                document.getElementById('cancelAddTrade').addEventListener('click', hideAddTradeModal);
                document.getElementById('addTradeForm').addEventListener('submit', addTrade);
                
                document.getElementById('addTradeModal').addEventListener('click', (e) => {
                    if (e.target === e.currentTarget) {
                        hideAddTradeModal();
                    }
                });
                
                // Watchlist modal event listeners
                document.getElementById('closeAddWatchlistModal').addEventListener('click', hideAddWatchlistModal);
                document.getElementById('cancelAddWatchlist').addEventListener('click', hideAddWatchlistModal);
                document.getElementById('addWatchlistForm').addEventListener('submit', addWatchlistItem);
                
                document.getElementById('addWatchlistModal').addEventListener('click', (e) => {
                    if (e.target === e.currentTarget) {
                        hideAddWatchlistModal();
                    }
                });
                
                // Trade Journal modal event listeners
                document.getElementById('closeTradeJournalModal').addEventListener('click', hideTradeJournalModal);
                document.getElementById('cancelTradeJournal').addEventListener('click', hideTradeJournalModal);
                document.getElementById('tradeJournalForm').addEventListener('submit', addJournalEntry);
                
                document.getElementById('tradeJournalModal').addEventListener('click', (e) => {
                    if (e.target === e.currentTarget) {
                        hideTradeJournalModal();
                    }
                });
            }

            showProfileModal() {
                const modal = document.getElementById('profileModal');
                modal.classList.remove('hidden');
                this.hideProfileDropdown();
                
                // Populate profile data
                document.getElementById('profileEmailAddress').value = this.currentUser.email;
                document.getElementById('profileFullName').value = localStorage.getItem('userFullName') || '';
                document.getElementById('profilePhoneNumber').value = localStorage.getItem('userPhone') || '';
                document.getElementById('profileDepartment').value = localStorage.getItem('userDepartment') || '';
            }

            hideProfileModal() {
                const modal = document.getElementById('profileModal');
                modal.classList.add('hidden');
            }

            saveProfileData() {
                const fullName = document.getElementById('profileFullName').value;
                const phone = document.getElementById('profilePhoneNumber').value;
                const department = document.getElementById('profileDepartment').value;

                // Save to localStorage
                localStorage.setItem('userFullName', fullName);
                localStorage.setItem('userPhone', phone);
                localStorage.setItem('userDepartment', department);

                // Show success message
                this.showSuccessMessage('Profile updated successfully!');
                this.hideProfileModal();
            }

            showPreferencesModal() {
                const modal = document.getElementById('preferencesModal');
                modal.classList.remove('hidden');
                this.hideProfileDropdown();

                // Load current preferences
                document.getElementById('emailNotifications').checked = localStorage.getItem('emailNotifications') !== 'false';
                document.getElementById('pushNotifications').checked = localStorage.getItem('pushNotifications') === 'true';
                document.getElementById('autoSave').checked = localStorage.getItem('autoSave') !== 'false';
                document.getElementById('themePreference').value = localStorage.getItem('themePreference') || 'light';
            }

            hidePreferencesModal() {
                const modal = document.getElementById('preferencesModal');
                modal.classList.add('hidden');
            }

            savePreferencesData() {
                const emailNotifications = document.getElementById('emailNotifications').checked;
                const pushNotifications = document.getElementById('pushNotifications').checked;
                const autoSave = document.getElementById('autoSave').checked;
                const themePreference = document.getElementById('themePreference').value;

                // Save preferences to localStorage
                localStorage.setItem('emailNotifications', emailNotifications.toString());
                localStorage.setItem('pushNotifications', pushNotifications.toString());
                localStorage.setItem('autoSave', autoSave.toString());
                localStorage.setItem('themePreference', themePreference);

                // Theme preference saved (dark theme is now fixed)

                this.showSuccessMessage('Preferences saved successfully!');
                this.hidePreferencesModal();
            }

            showHelpModal() {
                const modal = document.getElementById('helpModal');
                modal.classList.remove('hidden');
                this.hideProfileDropdown();
            }

            hideHelpModal() {
                const modal = document.getElementById('helpModal');
                modal.classList.add('hidden');
            }

            showSuccessMessage(message) {
                // Create a temporary notification
                const notification = {
                    id: Date.now(),
                    title: 'Success',
                    message: message,
                    time: 'Just now',
                    type: 'success',
                    isRead: false
                };

                this.notifications.unshift(notification);
                this.updateNotificationDisplay();

                // Remove the notification after 5 seconds
                setTimeout(() => {
                    this.notifications = this.notifications.filter(n => n.id !== notification.id);
                    this.updateNotificationDisplay();
                }, 5000);
            }
        }

        // Projects Management Functions
        let projectsData = [
            {
                id: 1,
                name: "Website Redesign",
                description: "Complete redesign of the company website with modern UI/UX principles",
                team: "design",
                priority: "high",
                status: "active",
                progress: 75,
                dueDate: "2024-02-15",
                createdDate: "2024-01-01",
                tags: ["UI/UX", "Responsive", "Modern"]
            },
            {
                id: 2,
                name: "Mobile App Development",
                description: "Native iOS and Android application with offline capabilities",
                team: "development",
                priority: "high",
                status: "active",
                progress: 45,
                dueDate: "2024-03-01",
                createdDate: "2024-01-15",
                tags: ["React Native", "Cross-platform", "Offline"]
            },
            {
                id: 3,
                name: "API Integration",
                description: "Integration with third-party APIs for enhanced functionality",
                team: "development",
                priority: "medium",
                status: "planning",
                progress: 20,
                dueDate: "2024-02-28",
                createdDate: "2024-01-20",
                tags: ["API", "Integration", "Backend"]
            },
            {
                id: 4,
                name: "Marketing Campaign",
                description: "Q1 digital marketing campaign across multiple channels",
                team: "marketing",
                priority: "high",
                status: "active",
                progress: 60,
                dueDate: "2024-01-30",
                createdDate: "2024-01-05",
                tags: ["Digital", "Multi-channel", "Q1"]
            },
            {
                id: 5,
                name: "Data Analytics Dashboard",
                description: "Real-time analytics dashboard with custom metrics",
                team: "development",
                priority: "medium",
                status: "completed",
                progress: 100,
                dueDate: "2024-01-20",
                createdDate: "2023-12-01",
                tags: ["Analytics", "Dashboard", "Real-time"]
            },
            {
                id: 6,
                name: "Security Audit",
                description: "Comprehensive security audit and vulnerability assessment",
                team: "operations",
                priority: "high",
                status: "overdue",
                progress: 30,
                dueDate: "2024-01-15",
                createdDate: "2023-12-15",
                tags: ["Security", "Audit", "Vulnerability"]
            }
        ];

        function renderProjects(projects = projectsData) {
            const projectsGrid = document.getElementById('projectsGrid');
            if (!projectsGrid) return;

            projectsGrid.innerHTML = projects.map(project => `
                <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow cursor-pointer" onclick="showProjectDetail(${project.id})">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-900">${project.name}</h3>
                        <span class="px-2 py-1 text-xs font-medium rounded-full ${getStatusColor(project.status)}">${project.status.charAt(0).toUpperCase() + project.status.slice(1)}</span>
                    </div>
                    <p class="text-gray-600 mb-4 line-clamp-2">${project.description}</p>
                    <div class="mb-4">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm text-gray-600">Progress</span>
                            <span class="text-sm font-medium text-gray-900">${project.progress}%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-blue-600 h-2 rounded-full" style="width: ${project.progress}%"></div>
                        </div>
                    </div>
                    <div class="flex items-center justify-between text-sm text-gray-500">
                        <span class="flex items-center">
                            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                            </svg>
                            ${project.team.charAt(0).toUpperCase() + project.team.slice(1)}
                        </span>
                        <span class="flex items-center">
                            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                            ${new Date(project.dueDate).toLocaleDateString()}
                        </span>
                    </div>
                    <div class="flex items-center justify-between mt-4">
                        <div class="flex items-center space-x-1">
                            <span class="px-2 py-1 text-xs bg-gray-100 text-gray-700 rounded-full ${getPriorityColor(project.priority)}">${project.priority.charAt(0).toUpperCase() + project.priority.slice(1)}</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button onclick="editProject(${project.id}); event.stopPropagation();" class="text-blue-600 hover:text-blue-800 text-sm">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                </svg>
                            </button>
                            <button onclick="deleteProject(${project.id}); event.stopPropagation();" class="text-red-600 hover:text-red-800 text-sm">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');

            updateProjectStats(projects);
        }

        function getStatusColor(status) {
            switch(status) {
                case 'active': return 'bg-green-100 text-green-800';
                case 'completed': return 'bg-blue-100 text-blue-800';
                case 'planning': return 'bg-yellow-100 text-yellow-800';
                case 'overdue': return 'bg-red-100 text-red-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function getPriorityColor(priority) {
            switch(priority) {
                case 'high': return 'bg-red-100 text-red-800';
                case 'medium': return 'bg-yellow-100 text-yellow-800';
                case 'low': return 'bg-green-100 text-green-800';
                default: return 'bg-gray-100 text-gray-800';
            }
        }

        function updateProjectStats(projects = projectsData) {
            const stats = {
                total: projects.length,
                completed: projects.filter(p => p.status === 'completed').length,
                inProgress: projects.filter(p => p.status === 'active').length,
                overdue: projects.filter(p => p.status === 'overdue').length
            };

            document.getElementById('totalProjects').textContent = stats.total;
            document.getElementById('completedProjects').textContent = stats.completed;
            document.getElementById('inProgressProjects').textContent = stats.inProgress;
            document.getElementById('overdueProjects').textContent = stats.overdue;
        }

        function showCreateProjectModal() {
            document.getElementById('createProjectModal').classList.remove('hidden');
        }

        function hideCreateProjectModal() {
            document.getElementById('createProjectModal').classList.add('hidden');
            document.getElementById('createProjectForm').reset();
        }

        function showProjectFilters() {
            const filters = document.getElementById('projectFilters');
            filters.classList.toggle('hidden');
        }

        function applyProjectFilters() {
            const statusFilter = document.getElementById('statusFilter').value;
            const priorityFilter = document.getElementById('priorityFilter').value;
            const teamFilter = document.getElementById('teamFilter').value;

            let filteredProjects = projectsData;

            if (statusFilter) {
                filteredProjects = filteredProjects.filter(p => p.status === statusFilter);
            }
            if (priorityFilter) {
                filteredProjects = filteredProjects.filter(p => p.priority === priorityFilter);
            }
            if (teamFilter) {
                filteredProjects = filteredProjects.filter(p => p.team === teamFilter);
            }

            renderProjects(filteredProjects);
        }

        function clearProjectFilters() {
            document.getElementById('statusFilter').value = '';
            document.getElementById('priorityFilter').value = '';
            document.getElementById('teamFilter').value = '';
            renderProjects(projectsData);
        }

        function showProjectDetail(projectId) {
            const project = projectsData.find(p => p.id === projectId);
            if (!project) return;

            document.getElementById('projectDetailTitle').textContent = project.name;
            document.getElementById('projectDetailContent').innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="text-lg font-semibold text-gray-900 mb-2">Project Details</h4>
                        <div class="space-y-3">
                            <div><strong>Description:</strong> ${project.description}</div>
                            <div><strong>Team:</strong> ${project.team.charAt(0).toUpperCase() + project.team.slice(1)}</div>
                            <div><strong>Priority:</strong> 
                                <span class="px-2 py-1 text-xs font-medium rounded-full ${getPriorityColor(project.priority)}">${project.priority.charAt(0).toUpperCase() + project.priority.slice(1)}</span>
                            </div>
                            <div><strong>Status:</strong> 
                                <span class="px-2 py-1 text-xs font-medium rounded-full ${getStatusColor(project.status)}">${project.status.charAt(0).toUpperCase() + project.status.slice(1)}</span>
                            </div>
                            <div><strong>Progress:</strong> ${project.progress}%</div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-blue-600 h-2 rounded-full" style="width: ${project.progress}%"></div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <h4 class="text-lg font-semibold text-gray-900 mb-2">Timeline</h4>
                        <div class="space-y-3">
                            <div><strong>Created:</strong> ${new Date(project.createdDate).toLocaleDateString()}</div>
                            <div><strong>Due Date:</strong> ${new Date(project.dueDate).toLocaleDateString()}</div>
                            <div><strong>Days Remaining:</strong> ${Math.ceil((new Date(project.dueDate) - new Date()) / (1000 * 60 * 60 * 24))} days</div>
                        </div>
                        <h4 class="text-lg font-semibold text-gray-900 mt-4 mb-2">Tags</h4>
                        <div class="flex flex-wrap gap-2">
                            ${project.tags.map(tag => `<span class="px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded-full">${tag}</span>`).join('')}
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('projectDetailModal').classList.remove('hidden');
        }

        function hideProjectDetailModal() {
            document.getElementById('projectDetailModal').classList.add('hidden');
        }

        // Invite Team Members Modal Functions
        function showInviteTeamModal() {
            document.getElementById('inviteTeamModal').classList.remove('hidden');
        }

        function hideInviteTeamModal() {
            document.getElementById('inviteTeamModal').classList.add('hidden');
            document.getElementById('inviteTeamForm').reset();
        }

        function sendTeamInvitation(email, role, team, message, sendNotification) {
            // Simulate sending invitation
            const inviteData = {
                email: email,
                role: role,
                team: team,
                message: message,
                sendNotification: sendNotification,
                sentAt: new Date().toISOString(),
                status: 'pending'
            };

            // In a real app, this would make an API call
            console.log('Sending invitation:', inviteData);
            
            // Show success message
            showNotification('Invitation sent successfully!', 'success');
            
            // Add to pending invitations list (for demo purposes)
            if (!window.pendingInvitations) {
                window.pendingInvitations = [];
            }
            window.pendingInvitations.push(inviteData);
            
            // Update the pending invitations display
            updatePendingInvitationsDisplay();
            
            return true;
        }

        function updatePendingInvitationsDisplay() {
            const pendingList = document.getElementById('pendingInvitesList');
            if (!pendingList) return;

            if (!window.pendingInvitations || window.pendingInvitations.length === 0) {
                pendingList.innerHTML = '';
                return;
            }

            const invitationsHtml = window.pendingInvitations.map(invite => {
                const initials = invite.email.slice(0, 2).toUpperCase();
                const timeAgo = getTimeAgo(new Date(invite.sentAt));
                
                return `
                    <div class="flex items-center space-x-3 py-2">
                        <div class="w-8 h-8 bg-orange-500 rounded-full flex items-center justify-center text-white text-sm font-medium">
                            ${initials}
                        </div>
                        <div class="flex-1">
                            <p class="text-sm font-medium text-gray-900">${invite.email}</p>
                            <p class="text-xs text-gray-500">${invite.role} • ${invite.team} • Invited ${timeAgo}</p>
                        </div>
                        <div class="text-xs text-orange-600 bg-orange-100 px-2 py-1 rounded-full">
                            Pending
                        </div>
                    </div>
                `;
            }).join('');

            pendingList.innerHTML = `
                <div class="text-xs text-gray-500 mb-2 font-medium">Pending Invitations</div>
                ${invitationsHtml}
            `;
        }

        function getTimeAgo(date) {
            const now = new Date();
            const diffInSeconds = Math.floor((now - date) / 1000);
            
            if (diffInSeconds < 60) {
                return 'just now';
            } else if (diffInSeconds < 3600) {
                const minutes = Math.floor(diffInSeconds / 60);
                return `${minutes}m ago`;
            } else if (diffInSeconds < 86400) {
                const hours = Math.floor(diffInSeconds / 3600);
                return `${hours}h ago`;
            } else {
                const days = Math.floor(diffInSeconds / 86400);
                return `${days}d ago`;
            }
        }

        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg transition-all duration-300 ${
                type === 'success' ? 'bg-green-500 text-white' : 
                type === 'error' ? 'bg-red-500 text-white' : 
                'bg-blue-500 text-white'
            }`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        ${type === 'success' ? 
                            '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>' :
                            '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>'
                        }
                    </svg>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        function editProject(projectId) {
            const project = projectsData.find(p => p.id === projectId);
            if (!project) return;

            // Fill form with project data
            document.getElementById('projectName').value = project.name;
            document.getElementById('projectDescription').value = project.description;
            document.getElementById('projectTeam').value = project.team;
            document.getElementById('projectPriority').value = project.priority;
            document.getElementById('projectDueDate').value = project.dueDate;

            // Show modal with edit mode
            showCreateProjectModal();
        }

        function deleteProject(projectId) {
            if (confirm('Are you sure you want to delete this project?')) {
                projectsData = projectsData.filter(p => p.id !== projectId);
                renderProjects();
            }
        }

        // Chart Management Functions
        let currentChart = null;
        let chartData = {};
        let activeIndicators = {};
        let currentChartType = 'line';

        function loadChart() {
            const symbol = document.getElementById('chartSymbol').value.toUpperCase();
            const timeframe = document.getElementById('chartTimeframe').value;
            
            if (!symbol) {
                alert('Please enter a symbol');
                return;
            }

            loadSymbolChart(symbol, timeframe);
        }

        async function loadSymbolChart(symbol, timeframe = '1M') {
            console.log('Loading chart for:', symbol, 'timeframe:', timeframe);
            console.log('API_KEY available:', typeof API_KEY !== 'undefined');
            
            document.getElementById('chartSymbol').value = symbol;
            document.getElementById('chartTimeframe').value = timeframe;
            document.getElementById('chartTitle').textContent = `${symbol} - ${timeframe}`;

            // Show loading state
            const chartContainer = document.getElementById('mainChart');
            chartContainer.innerHTML = `
                <div class="flex items-center justify-center h-96">
                    <div class="text-center">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
                        <p class="text-gray-600">Loading ${symbol} chart data...</p>
                    </div>
                </div>
            `;

            try {
                // Fetch real chart data from Alpha Vantage
                console.log('Fetching real chart data...');
                const realData = await fetchRealChartData(symbol, timeframe);
                console.log('Real data received:', realData);
                chartData = realData;

                renderChart(realData);
                updateChartAnalysis(realData);
            } catch (error) {
                console.error('Error loading chart data:', error);
                console.log('Attempting to use fallback data for:', symbol);
                
                // Try to use fallback data
                try {
                    const fallbackData = generateFallbackChartData(symbol, timeframe);
                    chartData = fallbackData;
                    renderChart(fallbackData);
                    updateChartAnalysis(fallbackData);
                    
                    // Show warning about fallback data
                    chartContainer.style.position = 'relative';
                    const warningBanner = document.createElement('div');
                    warningBanner.className = 'absolute top-0 left-0 right-0 bg-yellow-100 border border-yellow-300 text-yellow-800 px-4 py-2 text-sm z-10';
                    warningBanner.innerHTML = `<strong>Note:</strong> Live data unavailable. Showing sample data for ${symbol}.`;
                    chartContainer.insertBefore(warningBanner, chartContainer.firstChild);
                } catch (fallbackError) {
                    console.error('Fallback data generation failed:', fallbackError);
                    chartContainer.innerHTML = `
                        <div class="flex items-center justify-center h-96">
                            <div class="text-center">
                                <svg class="w-16 h-16 mx-auto mb-4 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <p class="text-red-600 mb-2">Error loading chart data</p>
                                <p class="text-gray-600 text-sm">${error.message}</p>
                            </div>
                        </div>
                    `;
                }
            }
        }

        async function fetchRealChartData(symbol, timeframe) {
            console.log('fetchRealChartData called with:', symbol, timeframe);
            console.log('Using Yahoo Finance API via Python backend');
            
            const API_BASE_URL = 'http://localhost:5001';
            const url = `${API_BASE_URL}/api/chart/${symbol}?timeframe=${timeframe}`;

            console.log('Making API request to:', url);
            
            const response = await axios.get(url);
            const data = response.data;
            
            console.log('API response received:', data);

            if (data.error) {
                console.error('API error:', data.error);
                throw new Error(data.error);
            }

            // Convert date strings to Date objects
            const processedData = data.data.map(item => ({
                date: new Date(item.date),
                price: item.price,
                high: item.high,
                low: item.low,
                open: item.open,
                volume: item.volume
            }));

            return {
                symbol: data.symbol,
                timeframe: data.timeframe,
                data: processedData,
                current: data.current,
                change: data.change,
                changePercent: data.changePercent
            };
        }

        function renderChart(data) {
            const chartContainer = document.getElementById('mainChart');
            
            // Create Chart.js chart
            const canvas = document.createElement('canvas');
            canvas.id = 'financialChart';
            canvas.className = 'w-full h-full';
            
            // Clear container and add canvas
            chartContainer.innerHTML = '';
            chartContainer.appendChild(canvas);
            
            const ctx = canvas.getContext('2d');
            
            // Destroy existing chart if it exists
            if (currentChart) {
                currentChart.destroy();
            }
            
            // Prepare data for Chart.js
            const labels = data.data.map(d => d.date.toLocaleDateString());
            const prices = data.data.map(d => d.price);
            const volumes = data.data.map(d => d.volume);
            
            // Prepare data based on chart type
            let chartConfig = {};
            
            if (currentChartType === 'candlestick') {
                // Prepare candlestick data
                const candlestickData = data.data.map(d => ({
                    x: d.date,
                    o: d.open || d.price,
                    h: d.high || d.price,
                    l: d.low || d.price,
                    c: d.price
                }));
                
                chartConfig = {
                    type: 'candlestick',
                    data: {
                        datasets: [{
                            label: `${data.symbol} Price`,
                            data: candlestickData,
                            borderColor: '#3b82f6',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)'
                        }]
                    }
                };
            } else {
                // Standard line/bar/area chart
                chartConfig = {
                    type: currentChartType,
                    data: {
                        labels: labels,
                        datasets: [{
                            label: `${data.symbol} Price`,
                            data: prices,
                            borderColor: '#3b82f6',
                            backgroundColor: currentChartType === 'area' ? 'rgba(59, 130, 246, 0.3)' : 'rgba(59, 130, 246, 0.1)',
                            borderWidth: 2,
                            fill: currentChartType === 'area',
                            tension: 0.1
                        }]
                    }
                };
            }
            
            // Create Chart.js configuration
            const config = {
                ...chartConfig,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    scales: currentChartType === 'candlestick' ? {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'day',
                                displayFormats: {
                                    day: 'MMM DD'
                                }
                            },
                            title: {
                                display: true,
                                text: 'Date'
                            }
                        },
                        y: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Price (USD)'
                            }
                        }
                    } : {
                        x: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Date'
                            }
                        },
                        y: {
                            display: true,
                            title: {
                                display: true,
                                text: 'Price (USD)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `Price: $${context.parsed.y.toFixed(2)}`;
                                }
                            }
                        }
                    }
                }
            };
            
            // Add technical indicators if enabled
            if (activeIndicators.ma20) {
                config.data.datasets.push({
                    label: 'MA 20',
                    data: calculateMA(prices, 20),
                    borderColor: '#ef4444',
                    backgroundColor: 'transparent',
                    borderWidth: 1,
                    fill: false,
                    pointRadius: 0
                });
            }
            
            if (activeIndicators.ma50) {
                config.data.datasets.push({
                    label: 'MA 50',
                    data: calculateMA(prices, 50),
                    borderColor: '#f59e0b',
                    backgroundColor: 'transparent',
                    borderWidth: 1,
                    fill: false,
                    pointRadius: 0
                });
            }
            
            if (activeIndicators.volume) {
                config.data.datasets.push({
                    label: 'Volume',
                    data: volumes,
                    type: 'bar',
                    backgroundColor: 'rgba(156, 163, 175, 0.3)',
                    borderColor: 'rgba(156, 163, 175, 0.5)',
                    borderWidth: 1,
                    yAxisID: 'y1'
                });
                
                config.options.scales.y1 = {
                    type: 'linear',
                    display: true,
                    position: 'right',
                    title: {
                        display: true,
                        text: 'Volume'
                    },
                    grid: {
                        drawOnChartArea: false,
                    },
                };
            }
            
            currentChart = new Chart(ctx, config);
        }
        
        function calculateMA(prices, period) {
            const ma = [];
            for (let i = 0; i < prices.length; i++) {
                if (i < period - 1) {
                    ma.push(null);
                } else {
                    const sum = prices.slice(i - period + 1, i + 1).reduce((a, b) => a + b, 0);
                    ma.push(sum / period);
                }
            }
            return ma;
        }

        function generateFallbackChartData(symbol, timeframe) {
            console.log('Generating fallback data for:', symbol, timeframe);
            
            // Base prices for different symbols
            const basePrices = {
                'QQQ': 400,
                'SPY': 500,
                'DIA': 350,
                'AAPL': 180,
                'MSFT': 400,
                'GOOGL': 150,
                'AMZN': 180,
                'TSLA': 250,
                'META': 500,
                'NVDA': 800
            };
            
            const basePrice = basePrices[symbol] || 100;
            
            // Generate different number of data points based on timeframe
            let dataPoints;
            switch(timeframe) {
                case '1D': dataPoints = 24; break;
                case '5D': dataPoints = 5; break;
                case '1M': dataPoints = 30; break;
                case '3M': dataPoints = 90; break;
                case '6M': dataPoints = 180; break;
                case '1Y': dataPoints = 365; break;
                case '5Y': dataPoints = 1825; break;
                default: dataPoints = 30; break;
            }
            
            const data = [];
            const today = new Date();
            
            for (let i = 0; i < dataPoints; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() - (dataPoints - i));
                
                // Generate realistic price movements
                const priceVariation = (Math.random() - 0.5) * 0.1; // ±5% variation
                const price = basePrice * (1 + priceVariation * (i / dataPoints));
                
                // Add some noise for realism
                const noise = (Math.random() - 0.5) * 0.02; // ±1% noise
                const finalPrice = price * (1 + noise);
                
                data.push({
                    date: date,
                    price: finalPrice,
                    high: finalPrice * 1.02,
                    low: finalPrice * 0.98,
                    open: finalPrice * (1 + (Math.random() - 0.5) * 0.01),
                    volume: Math.floor(Math.random() * 10000000) + 1000000
                });
            }
            
            const currentPrice = data[data.length - 1].price;
            const firstPrice = data[0].price;
            const change = currentPrice - firstPrice;
            const changePercent = (change / firstPrice) * 100;
            
            return {
                symbol: symbol,
                timeframe: timeframe,
                data: data,
                current: currentPrice,
                change: change,
                changePercent: changePercent
            };
        }



        function toggleChartType(type) {
            // Update current chart type
            currentChartType = type;
            
            // Update active button
            document.querySelectorAll('[onclick^="toggleChartType"]').forEach(btn => {
                btn.className = btn.className.replace('bg-blue-100 text-blue-700', 'bg-gray-100 text-gray-700');
            });
            
            event.target.className = event.target.className.replace('bg-gray-100 text-gray-700', 'bg-blue-100 text-blue-700');
            
            console.log('Chart type changed to:', currentChartType);
            
            // Re-render chart with new type
            if (chartData.data) {
                renderChart(chartData);
            }
        }

        function toggleIndicator(indicator) {
            activeIndicators[indicator] = !activeIndicators[indicator];
            
            if (chartData.data) {
                renderChart(chartData);
            }
        }

        // Market Overview Functions
        async function loadMarketOverview() {
            const container = document.getElementById('marketOverview');
            
            if (!container) {
                console.error('Market overview container not found');
                return;
            }
            
            console.log('Loading market overview data from Yahoo Finance API...');
            
            try {
                const API_BASE_URL = 'http://localhost:5001';
                const response = await axios.get(`${API_BASE_URL}/api/market-overview`);
                
                console.log('Market overview response:', response.data);
                
                const marketData = response.data.data;
                
                for (let i = 0; i < marketData.length; i++) {
                    const data = marketData[i];
                    const card = container.children[i];
                    
                    if (card && data) {
                        const priceElement = card.querySelector('.text-xl.font-bold');
                        const changeElement = card.querySelector('.text-right p');
                        
                        if (priceElement) {
                            priceElement.textContent = data.price.toFixed(2);
                        }
                        if (changeElement) {
                            changeElement.className = `text-sm font-medium ${data.is_positive ? 'text-green-600' : 'text-red-600'}`;
                            changeElement.textContent = `${data.is_positive ? '+' : ''}${data.change_percent.toFixed(2)}%`;
                        }
                        
                        console.log(`Updated ${data.symbol} with real-time data: ${data.price.toFixed(2)}`);
                    }
                }
                
            } catch (error) {
                console.error('Error loading market overview:', error);
                
                // Fallback with demo data if API fails
                const symbols = ['SPY', 'QQQ', 'DIA', 'VIX'];
                for (let i = 0; i < symbols.length; i++) {
                    const demoData = getDemoMarketData(symbols[i]);
                    const card = container.children[i];
                    if (card) {
                        const priceElement = card.querySelector('.text-xl.font-bold');
                        const changeElement = card.querySelector('.text-right p');
                        
                        if (priceElement) {
                            priceElement.textContent = demoData.price;
                        }
                        if (changeElement) {
                            changeElement.className = `text-sm font-medium ${demoData.isPositive ? 'text-green-600' : 'text-red-600'}`;
                            changeElement.textContent = demoData.change;
                        }
                        
                        console.log(`Used fallback data for ${symbols[i]} due to API error`);
                    }
                }
            }
            
            console.log('Market overview loading complete');
        }

        // Fallback demo data for when API fails
        function getDemoMarketData(symbol) {
            const demoData = {
                'SPY': { price: '625.82', change: '+0.28%', isPositive: true },
                'QQQ': { price: '555.45', change: '-0.14%', isPositive: false },
                'DIA': { price: '431.25', change: '+0.18%', isPositive: true },
                'VIX': { price: '12.84', change: '-2.15%', isPositive: false }
            };
            
            return demoData[symbol] || { price: '0.00', change: '0.00%', isPositive: true };
        }

        // Ensure all tickers load with fallback data if needed
        function ensureAllTickersLoad() {
            const symbols = ['SPY', 'QQQ', 'DIA', 'VIX'];
            const container = document.getElementById('marketOverview');
            
            if (!container) return;
            
            // Check each ticker and load fallback data if still showing "Loading..."
            for (let i = 0; i < symbols.length; i++) {
                const card = container.children[i];
                if (card) {
                    const priceElement = card.querySelector('.text-xl.font-bold');
                    
                    if (priceElement && priceElement.textContent === 'Loading...') {
                        console.log(`Loading fallback data for ${symbols[i]}`);
                        const demoData = getDemoMarketData(symbols[i]);
                        const changeElement = card.querySelector('.text-right p');
                        
                        priceElement.textContent = demoData.price;
                        if (changeElement) {
                            changeElement.className = `text-sm font-medium ${demoData.isPositive ? 'text-green-600' : 'text-red-600'}`;
                            changeElement.textContent = demoData.change;
                        }
                    }
                }
            }
        }

        // Auto-load market data when charts page is accessed
        function initializeChartsPage() {
            loadMarketOverview();
        }

        // Initialize market overview immediately when DOM is ready
        function initializeMarketOverview() {
            console.log('Initializing market overview...');
            const container = document.getElementById('marketOverview');
            
            if (!container) {
                console.error('Market overview container not found, retrying...');
                setTimeout(initializeMarketOverview, 500);
                return;
            }
            
            // Load market data
            loadMarketOverview();
        }

        // Refresh market data with visual feedback
        function refreshMarketData() {
            console.log('Refreshing market data...');
            const container = document.getElementById('marketOverview');
            
            if (!container) {
                console.error('Market overview container not found');
                return;
            }
            
            // Reset all cards to loading state
            const cards = container.children;
            for (let i = 0; i < cards.length; i++) {
                const priceElement = cards[i].querySelector('.text-xl.font-bold');
                const changeElement = cards[i].querySelector('.text-right p');
                
                if (priceElement) {
                    priceElement.textContent = 'Loading...';
                }
                if (changeElement) {
                    changeElement.textContent = '...';
                    changeElement.className = 'text-sm font-medium text-gray-600';
                }
            }
            
            // Show notification
            showNotification('Refreshing market data...', 'info');
            
            // Load fresh data
            loadMarketOverview();
        }



        function updateChartAnalysis(data) {
            const analysisContainer = document.getElementById('chartAnalysis');
            const change = data.change;
            const changePercent = data.changePercent;
            
            analysisContainer.innerHTML = `
                <div class="space-y-3">
                    <div class="flex items-center justify-between p-3 bg-gray-700 rounded-lg border border-gray-600">
                        <div>
                            <h4 class="font-semibold text-gray-100 text-sm">Current Price</h4>
                            <p class="text-xl font-bold text-white">$${data.current.toFixed(2)}</p>
                        </div>
                        <div class="text-right">
                            <p class="text-xs text-gray-300">Change</p>
                            <p class="text-md font-semibold ${change >= 0 ? 'text-green-400' : 'text-red-400'}">
                                ${change >= 0 ? '+' : ''}${change.toFixed(2)} (${changePercent.toFixed(2)}%)
                            </p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <div class="p-2 bg-blue-900 rounded-lg border border-blue-700">
                            <h5 class="font-medium text-blue-200 text-xs">High</h5>
                            <p class="text-md font-semibold text-blue-100">$${Math.max(...data.data.map(d => d.high || d.price)).toFixed(2)}</p>
                        </div>
                        <div class="p-2 bg-red-900 rounded-lg border border-red-700">
                            <h5 class="font-medium text-red-200 text-xs">Low</h5>
                            <p class="text-md font-semibold text-red-100">$${Math.min(...data.data.map(d => d.low || d.price)).toFixed(2)}</p>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <div class="p-2 bg-green-900 rounded-lg border border-green-700">
                            <h5 class="font-medium text-green-200 text-xs">Volume</h5>
                            <p class="text-md font-semibold text-green-100">${formatLargeNumber(data.data[data.data.length - 1].volume)}</p>
                        </div>
                        <div class="p-2 bg-purple-900 rounded-lg border border-purple-700">
                            <h5 class="font-medium text-purple-200 text-xs">Timeframe</h5>
                            <p class="text-md font-semibold text-purple-100">${data.timeframe}</p>
                        </div>
                    </div>
                </div>
            `;
        }

        // Weekly Energy Trends Chart Functions
        let energyChart = null;
        
        async function initializeEnergyChart() {
            const canvas = document.getElementById('energyChartCanvas');
            if (!canvas) {
                console.error('Energy chart canvas not found');
                return;
            }
            
            const ctx = canvas.getContext('2d');
            
            // Show loading indicator
            const chartContainer = document.getElementById('energyChart');
            if (chartContainer) {
                chartContainer.innerHTML = '<div class="flex items-center justify-center h-64"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"></div><span class="ml-2 text-gray-600">Loading energy data...</span></div>';
            }
            
            try {
                // Generate live energy data for the past 7 days
                const energyData = await generateEnergyData();
                
                // Restore canvas after loading
                if (chartContainer) {
                    chartContainer.innerHTML = '<canvas id="energyChartCanvas"></canvas>';
                    const newCanvas = document.getElementById('energyChartCanvas');
                    const newCtx = newCanvas.getContext('2d');
                    
                    energyChart = new Chart(newCtx, {
                        type: 'line',
                        data: {
                            labels: energyData.labels,
                            datasets: [{
                                label: 'Market Energy Level',
                                data: energyData.values,
                                borderColor: '#8B5CF6',
                                backgroundColor: 'rgba(139, 92, 246, 0.1)',
                                borderWidth: 3,
                                fill: true,
                                tension: 0.4,
                                pointBackgroundColor: '#8B5CF6',
                                pointBorderColor: '#FFFFFF',
                                pointBorderWidth: 2,
                                pointRadius: 5,
                                pointHoverRadius: 8
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: true,
                                    position: 'top',
                                    labels: {
                                        color: '#6B7280',
                                        font: {
                                            size: 12
                                        }
                                    }
                                },
                                tooltip: {
                                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                    titleColor: '#FFFFFF',
                                    bodyColor: '#FFFFFF',
                                    borderColor: '#8B5CF6',
                                    borderWidth: 1,
                                    callbacks: {
                                        label: function(context) {
                                            return `Energy Level: ${context.parsed.y.toFixed(1)}`;
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    max: 100,
                                    grid: {
                                        color: 'rgba(0, 0, 0, 0.1)',
                                        borderDash: [5, 5]
                                    },
                                    ticks: {
                                        color: '#6B7280',
                                        font: {
                                            size: 12
                                        },
                                        callback: function(value) {
                                            return value + '%';
                                        }
                                    }
                                },
                                x: {
                                    grid: {
                                        display: false
                                    },
                                    ticks: {
                                        color: '#6B7280',
                                        font: {
                                            size: 12
                                        }
                                    }
                                }
                            }
                        }
                    });
                }
                
                showNotification('Energy chart loaded with live market data', 'success');
            } catch (error) {
                console.error('Error initializing energy chart:', error);
                showNotification('Failed to load live energy data, using fallback', 'warning');
                
                // Fallback to basic chart
                if (chartContainer) {
                    chartContainer.innerHTML = '<canvas id="energyChartCanvas"></canvas>';
                    const newCanvas = document.getElementById('energyChartCanvas');
                    const newCtx = newCanvas.getContext('2d');
                    
                    energyChart = new Chart(newCtx, {
                        type: 'line',
                        data: {
                            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                            datasets: [{
                                label: 'Energy Level (Fallback)',
                                data: [65, 72, 58, 83, 76, 69, 71],
                                borderColor: '#8B5CF6',
                                backgroundColor: 'rgba(139, 92, 246, 0.1)',
                                borderWidth: 3,
                                fill: true,
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { display: false } },
                            scales: {
                                y: { beginAtZero: true, max: 100 },
                                x: { grid: { display: false } }
                            }
                        }
                    });
                }
            }
        }
        
        async function generateEnergyData() {
            const labels = [];
            const values = [];
            
            // Market symbols to track for energy calculation
            const marketSymbols = ['SPY', 'QQQ', 'DIA', 'VIX', 'UVXY'];
            
            try {
                // Generate past 7 days with live market data
                for (let i = 6; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    
                    labels.push(date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' }));
                    
                    // Calculate energy based on real market data
                    const energy = await calculateMarketEnergy(date, marketSymbols);
                    values.push(energy);
                }
            } catch (error) {
                console.error('Error fetching live market data for energy calculation:', error);
                // Fallback to enhanced numerology-based calculation
                for (let i = 6; i >= 0; i--) {
                    const date = new Date();
                    date.setDate(date.getDate() - i);
                    
                    labels.push(date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' }));
                    
                    // Enhanced numerology calculation with real-time elements
                    const dayOfWeek = date.getDay();
                    const dayOfMonth = date.getDate();
                    const hour = new Date().getHours();
                    
                    // Base energy calculation using numerology
                    const dayNumber = calculateDayEnergyNumber(date);
                    const baseEnergy = 30 + (dayNumber * 3) + (Math.sin(i * 0.8) * 15);
                    
                    // Market session energy modifier
                    const marketHours = hour >= 9 && hour <= 16;
                    const marketModifier = marketHours ? 15 : 5;
                    
                    // Day-specific energy patterns
                    let energyModifier = 0;
                    switch (dayOfWeek) {
                        case 0: energyModifier = 8; break;  // Sunday - spiritual preparation
                        case 1: energyModifier = 20; break; // Monday - new beginnings (high energy)
                        case 2: energyModifier = 15; break; // Tuesday - action and momentum
                        case 3: energyModifier = 25; break; // Wednesday - peak communication
                        case 4: energyModifier = 18; break; // Thursday - expansion and growth
                        case 5: energyModifier = 22; break; // Friday - creativity and completion
                        case 6: energyModifier = 12; break; // Saturday - reflection and analysis
                    }
                    
                    // Lunar cycle influence (simplified)
                    const lunarInfluence = Math.sin((dayOfMonth / 29.5) * Math.PI * 2) * 8;
                    
                    const finalEnergy = baseEnergy + energyModifier + marketModifier + lunarInfluence;
                    values.push(Math.max(15, Math.min(95, finalEnergy)));
                }
            }
            
            return { labels, values };
        }

        // Calculate energy number for a specific date using numerology
        function calculateDayEnergyNumber(date) {
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            
            // Sum all digits
            const dateStr = `${year}${month < 10 ? '0' + month : month}${day < 10 ? '0' + day : day}`;
            let sum = dateStr.split('').reduce((acc, digit) => acc + parseInt(digit), 0);
            
            // Reduce to single digit or master number
            while (sum > 9 && ![11, 22, 33].includes(sum)) {
                sum = sum.toString().split('').reduce((acc, digit) => acc + parseInt(digit), 0);
            }
            
            return sum;
        }

        // Calculate market energy based on real market data
        async function calculateMarketEnergy(date, symbols) {
            let totalEnergy = 0;
            let validSymbols = 0;
            
            // Only fetch data for current date to avoid weekend/holiday issues
            const today = new Date();
            const isToday = date.toDateString() === today.toDateString();
            
            if (!isToday) {
                // For historical dates, use numerology-based calculation
                return calculateHistoricalEnergy(date);
            }
            
            try {
                // Fetch market data from our API
                const promises = symbols.map(symbol => 
                    fetch(`/api/quote/${symbol}`)
                        .then(response => response.json())
                        .catch(error => {
                            console.warn(`Failed to fetch ${symbol}:`, error);
                            return null;
                        })
                );
                
                const marketData = await Promise.all(promises);
                
                marketData.forEach((data, index) => {
                    if (data && data.price > 0) {
                        const symbol = symbols[index];
                        let energy = 0;
                        
                        // Calculate energy based on different factors
                        if (symbol === 'VIX' || symbol === 'UVXY') {
                            // Volatility symbols - high VIX = higher energy
                            energy = Math.min(30, data.price * 2);
                        } else {
                            // Price change energy
                            const changeEnergy = Math.abs(data.change_percent) * 2;
                            
                            // Volume energy (normalized)
                            const volumeEnergy = Math.min(15, (data.volume / 1000000) * 2);
                            
                            // Momentum energy
                            const momentumEnergy = data.change_percent > 0 ? 10 : 8;
                            
                            energy = changeEnergy + volumeEnergy + momentumEnergy;
                        }
                        
                        totalEnergy += energy;
                        validSymbols++;
                    }
                });
                
                if (validSymbols > 0) {
                    const avgEnergy = totalEnergy / validSymbols;
                    // Add time-based boost
                    const timeBoost = Math.sin((new Date().getHours() / 24) * Math.PI * 2) * 5;
                    
                    return Math.max(20, Math.min(90, avgEnergy + timeBoost + 25));
                }
                
            } catch (error) {
                console.error('Error calculating market energy:', error);
            }
            
            // Fallback to enhanced numerology calculation
            return calculateHistoricalEnergy(date);
        }

        // Calculate historical energy for past dates
        function calculateHistoricalEnergy(date) {
            const dayOfWeek = date.getDay();
            const dayOfMonth = date.getDate();
            const dayNumber = calculateDayEnergyNumber(date);
            
            const baseEnergy = 35 + (dayNumber * 2.5);
            
            // Historical day patterns
            const dayModifiers = {
                0: 12, // Sunday
                1: 22, // Monday
                2: 18, // Tuesday
                3: 28, // Wednesday
                4: 20, // Thursday
                5: 25, // Friday
                6: 15  // Saturday
            };
            
            const weekdayModifier = dayModifiers[dayOfWeek];
            const lunarInfluence = Math.sin((dayOfMonth / 29.5) * Math.PI * 2) * 6;
            
            return Math.max(18, Math.min(88, baseEnergy + weekdayModifier + lunarInfluence));
        }
        
        async function refreshEnergyChart() {
            if (energyChart) {
                try {
                    // Show loading state
                    const refreshButton = document.querySelector('button[onclick="refreshEnergyChart()"]');
                    if (refreshButton) {
                        refreshButton.disabled = true;
                        refreshButton.innerHTML = '<svg class="w-4 h-4 mr-1 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>Refreshing...';
                    }
                    
                    const newData = await generateEnergyData();
                    energyChart.data.labels = newData.labels;
                    energyChart.data.datasets[0].data = newData.values;
                    energyChart.update();
                    
                    // Update chart title if live data was used
                    const hasLiveData = newData.values.some(val => val > 0);
                    if (hasLiveData) {
                        energyChart.data.datasets[0].label = 'Market Energy Level (Live)';
                        energyChart.update();
                    }
                    
                    showNotification('Energy chart refreshed with live market data', 'success');
                } catch (error) {
                    console.error('Error refreshing energy chart:', error);
                    showNotification('Failed to refresh energy data', 'error');
                } finally {
                    // Restore button state
                    const refreshButton = document.querySelector('button[onclick="refreshEnergyChart()"]');
                    if (refreshButton) {
                        refreshButton.disabled = false;
                        refreshButton.innerHTML = '<svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>Refresh';
                    }
                }
            }
        }

        // Black-Scholes Options Calculator Functions
        class BlackScholesCalculator {
            constructor(S, K, T, r, sigma, optionType = "call", dividendYield = 0.0) {
                // Input validation
                if (S <= 0) throw new Error("Stock price must be positive");
                if (K <= 0) throw new Error("Strike price must be positive");
                if (T <= 0) throw new Error("Time to expiration must be positive");
                if (sigma <= 0) throw new Error("Volatility must be positive");
                if (!['call', 'put'].includes(optionType.toLowerCase())) {
                    throw new Error("Option type must be 'call' or 'put'");
                }
                
                this.S = parseFloat(S);
                this.K = parseFloat(K);
                this.T = parseFloat(T);
                this.r = parseFloat(r);
                this.sigma = parseFloat(sigma);
                this.optionType = optionType.toLowerCase();
                this.q = parseFloat(dividendYield);
            }
            
            // Calculate d1 and d2 parameters
            _d1_d2() {
                const d1 = (Math.log(this.S / this.K) + (this.r - this.q + 0.5 * this.sigma ** 2) * this.T) / (this.sigma * Math.sqrt(this.T));
                const d2 = d1 - this.sigma * Math.sqrt(this.T);
                return [d1, d2];
            }
            
            // Calculate option price
            price() {
                const [d1, d2] = this._d1_d2();
                
                let price;
                if (this.optionType === 'call') {
                    price = (this.S * Math.exp(-this.q * this.T) * normalCdf(d1) -
                            this.K * Math.exp(-this.r * this.T) * normalCdf(d2));
                } else { // put
                    price = (this.K * Math.exp(-this.r * this.T) * normalCdf(-d2) -
                            this.S * Math.exp(-this.q * this.T) * normalCdf(-d1));
                }
                return Math.max(0, price);
            }
            
            // Calculate Delta
            delta() {
                const [d1, ] = this._d1_d2();
                if (this.optionType === 'call') {
                    return Math.exp(-this.q * this.T) * normalCdf(d1);
                } else { // put
                    return Math.exp(-this.q * this.T) * (normalCdf(d1) - 1);
                }
            }
            
            // Calculate Gamma
            gamma() {
                const [d1, ] = this._d1_d2();
                return (Math.exp(-this.q * this.T) * normalPdf(d1) /
                        (this.S * this.sigma * Math.sqrt(this.T)));
            }
            
            // Calculate Theta (per day)
            theta() {
                const [d1, d2] = this._d1_d2();
                const term1 = -(this.S * Math.exp(-this.q * this.T) * normalPdf(d1) * this.sigma) / (2 * Math.sqrt(this.T));
                
                let theta;
                if (this.optionType === 'call') {
                    const term2 = -this.q * this.S * Math.exp(-this.q * this.T) * normalCdf(d1);
                    const term3 = this.r * this.K * Math.exp(-this.r * this.T) * normalCdf(d2);
                    theta = term1 + term2 + term3;
                } else { // put
                    const term2 = this.q * this.S * Math.exp(-this.q * this.T) * normalCdf(-d1);
                    const term3 = -this.r * this.K * Math.exp(-this.r * this.T) * normalCdf(-d2);
                    theta = term1 - term2 + term3;
                }
                
                return theta / 365; // Convert to daily theta
            }
            
            // Calculate Vega (per 1% change in volatility)
            vega() {
                const [d1, ] = this._d1_d2();
                return this.S * Math.exp(-this.q * this.T) * normalPdf(d1) * Math.sqrt(this.T) / 100;
            }
            
            // Calculate Rho (per 1% change in interest rate)
            rho() {
                const [, d2] = this._d1_d2();
                if (this.optionType === 'call') {
                    return this.K * this.T * Math.exp(-this.r * this.T) * normalCdf(d2) / 100;
                } else { // put
                    return -this.K * this.T * Math.exp(-this.r * this.T) * normalCdf(-d2) / 100;
                }
            }
        }
        
        // Normal distribution helper functions
        function normalPdf(x) {
            return Math.exp(-0.5 * x * x) / Math.sqrt(2 * Math.PI);
        }
        
        function normalCdf(x) {
            // Approximation of the cumulative standard normal distribution
            const a1 =  0.254829592;
            const a2 = -0.284496736;
            const a3 =  1.421413741;
            const a4 = -1.453152027;
            const a5 =  1.061405429;
            const p  =  0.3275911;
            
            const sign = x < 0 ? -1 : 1;
            x = Math.abs(x) / Math.sqrt(2.0);
            
            const t = 1.0 / (1.0 + p * x);
            const y = 1.0 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * Math.exp(-x * x);
            
            return 0.5 * (1.0 + sign * y);
        }
        
        // Options Calculator UI Functions
        function calculateOptions() {
            try {
                // Get input values
                const S = parseFloat(document.getElementById('stockPrice').value);
                const K = parseFloat(document.getElementById('strikePrice').value);
                const T = parseFloat(document.getElementById('timeToExpiry').value);
                const r = parseFloat(document.getElementById('riskFreeRate').value) / 100; // Convert percentage to decimal
                const sigma = parseFloat(document.getElementById('volatility').value) / 100; // Convert percentage to decimal
                const q = parseFloat(document.getElementById('dividendYield').value) / 100; // Convert percentage to decimal
                const optionType = document.getElementById('optionType').value;
                
                // Validate inputs
                if (isNaN(S) || isNaN(K) || isNaN(T) || isNaN(r) || isNaN(sigma) || isNaN(q)) {
                    throw new Error("Please enter valid numbers for all parameters");
                }
                
                // Create calculator instance
                const calculator = new BlackScholesCalculator(S, K, T, r, sigma, optionType, q);
                
                // Calculate all Greeks
                const price = calculator.price();
                const delta = calculator.delta();
                const gamma = calculator.gamma();
                const theta = calculator.theta();
                const vega = calculator.vega();
                const rho = calculator.rho();
                
                // Display results
                displayResults({
                    price: price,
                    delta: delta,
                    gamma: gamma,
                    theta: theta,
                    vega: vega,
                    rho: rho,
                    optionType: optionType,
                    S: S,
                    K: K,
                    T: T,
                    r: r * 100,
                    sigma: sigma * 100,
                    q: q * 100
                });
                
                // Store current calculation for saving
                window.currentCalculation = {
                    inputs: { S, K, T, r: r * 100, sigma: sigma * 100, q: q * 100, optionType },
                    results: { price, delta, gamma, theta, vega, rho },
                    timestamp: new Date().toISOString()
                };
                
                showNotification('Options calculation completed successfully!', 'success');
                
            } catch (error) {
                showNotification(error.message, 'error');
                console.error('Options calculation error:', error);
            }
        }
        
        function displayResults(results) {
            const resultsContainer = document.getElementById('calculationResults');
            
            const changeColor = results.price >= results.K ? 'text-green-600' : 'text-red-600';
            const changeSymbol = results.price >= results.K ? '↗' : '↘';
            
            resultsContainer.innerHTML = `
                <div class="space-y-4">
                    <!-- Option Price -->
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-lg p-4 border border-blue-200">
                        <div class="flex items-center justify-between">
                            <div>
                                <h4 class="text-lg font-semibold text-blue-900">${results.optionType.charAt(0).toUpperCase() + results.optionType.slice(1)} Option Price</h4>
                                <p class="text-3xl font-bold text-blue-800">$${results.price.toFixed(4)}</p>
                            </div>
                            <div class="text-right">
                                <span class="text-2xl ${changeColor}">${changeSymbol}</span>
                            </div>
                        </div>
                    </div>
                    
                                         <!-- Greeks Grid -->
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                         <div onclick="openGreekModal('deltaModal')" class="bg-green-50 rounded-lg p-4 border border-green-200 cursor-pointer hover:bg-green-100 hover:shadow-md transition-all duration-200">
                             <div class="flex items-center justify-between">
                                 <div>
                                     <h5 class="font-semibold text-green-900">Delta (Δ)</h5>
                                     <p class="text-xl font-bold text-green-800">${results.delta.toFixed(4)}</p>
                                     <p class="text-sm text-green-700">Price sensitivity to stock price</p>
                                 </div>
                                 <div class="text-green-600">
                                     <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                     </svg>
                                 </div>
                             </div>
                         </div>
                         <div onclick="openGreekModal('gammaModal')" class="bg-purple-50 rounded-lg p-4 border border-purple-200 cursor-pointer hover:bg-purple-100 hover:shadow-md transition-all duration-200">
                             <div class="flex items-center justify-between">
                                 <div>
                                     <h5 class="font-semibold text-purple-900">Gamma (Γ)</h5>
                                     <p class="text-xl font-bold text-purple-800">${results.gamma.toFixed(4)}</p>
                                     <p class="text-sm text-purple-700">Rate of change of Delta</p>
                                 </div>
                                 <div class="text-purple-600">
                                     <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                     </svg>
                                 </div>
                             </div>
                         </div>
                         <div onclick="openGreekModal('thetaModal')" class="bg-red-50 rounded-lg p-4 border border-red-200 cursor-pointer hover:bg-red-100 hover:shadow-md transition-all duration-200">
                             <div class="flex items-center justify-between">
                                 <div>
                                     <h5 class="font-semibold text-red-900">Theta (Θ)</h5>
                                     <p class="text-xl font-bold text-red-800">${results.theta.toFixed(4)}</p>
                                     <p class="text-sm text-red-700">Time decay per day</p>
                                 </div>
                                 <div class="text-red-600">
                                     <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                     </svg>
                                 </div>
                             </div>
                         </div>
                         <div onclick="openGreekModal('vegaModal')" class="bg-orange-50 rounded-lg p-4 border border-orange-200 cursor-pointer hover:bg-orange-100 hover:shadow-md transition-all duration-200">
                             <div class="flex items-center justify-between">
                                 <div>
                                     <h5 class="font-semibold text-orange-900">Vega (ν)</h5>
                                     <p class="text-xl font-bold text-orange-800">${results.vega.toFixed(4)}</p>
                                     <p class="text-sm text-orange-700">Volatility sensitivity</p>
                                 </div>
                                 <div class="text-orange-600">
                                     <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                     </svg>
                                 </div>
                             </div>
                         </div>
                         <div onclick="openGreekModal('rhoModal')" class="bg-teal-50 rounded-lg p-4 border border-teal-200 md:col-span-2 cursor-pointer hover:bg-teal-100 hover:shadow-md transition-all duration-200">
                             <div class="flex items-center justify-between">
                                 <div>
                                     <h5 class="font-semibold text-teal-900">Rho (ρ)</h5>
                                     <p class="text-xl font-bold text-teal-800">${results.rho.toFixed(4)}</p>
                                     <p class="text-sm text-teal-700">Interest rate sensitivity</p>
                                 </div>
                                 <div class="text-teal-600">
                                     <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                     </svg>
                                 </div>
                             </div>
                         </div>
                     </div>
                    
                    <!-- Summary -->
                    <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                        <h5 class="font-semibold text-gray-900 mb-2">Calculation Summary</h5>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <div>Stock Price: $${results.S.toFixed(2)}</div>
                            <div>Strike Price: $${results.K.toFixed(2)}</div>
                            <div>Time to Expiry: ${results.T.toFixed(2)} years</div>
                            <div>Risk-Free Rate: ${results.r.toFixed(2)}%</div>
                            <div>Volatility: ${results.sigma.toFixed(2)}%</div>
                            <div>Dividend Yield: ${results.q.toFixed(2)}%</div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function resetCalculator() {
            // Reset all input fields to default values
            document.getElementById('stockPrice').value = '100.00';
            document.getElementById('strikePrice').value = '100.00';
            document.getElementById('timeToExpiry').value = '1.00';
            document.getElementById('riskFreeRate').value = '5.00';
            document.getElementById('volatility').value = '20.00';
            document.getElementById('dividendYield').value = '0.00';
            document.getElementById('optionType').value = 'call';
            
            // Reset results display
            const resultsContainer = document.getElementById('calculationResults');
            resultsContainer.innerHTML = `
                <div class="text-center py-8 text-gray-500">
                    <svg class="w-16 h-16 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
                    </svg>
                    <p>Enter parameters and click Calculate to see results</p>
                </div>
            `;
            
            // Clear current calculation
            window.currentCalculation = null;
            
            showNotification('Calculator reset successfully', 'info');
        }
        
        function saveCalculation() {
            if (!window.currentCalculation) {
                showNotification('No calculation to save. Please calculate first.', 'error');
                return;
            }
            
            // Get existing saved calculations
            let savedCalculations = JSON.parse(localStorage.getItem('optionsCalculations') || '[]');
            
            // Add current calculation
            const calculationToSave = {
                id: Date.now(),
                ...window.currentCalculation,
                name: `${window.currentCalculation.inputs.optionType.toUpperCase()} - $${window.currentCalculation.inputs.S} / $${window.currentCalculation.inputs.K}`
            };
            
            savedCalculations.push(calculationToSave);
            
            // Save to localStorage
            localStorage.setItem('optionsCalculations', JSON.stringify(savedCalculations));
            
            // Update UI
            updateSavedCalculationsDisplay();
            
            showNotification('Calculation saved successfully!', 'success');
        }
        
        function exportCalculation() {
            if (!window.currentCalculation) {
                showNotification('No calculation to export. Please calculate first.', 'error');
                return;
            }
            
            const data = {
                timestamp: new Date().toISOString(),
                inputs: window.currentCalculation.inputs,
                results: window.currentCalculation.results
            };
            
            // Create CSV content
            const csvContent = [
                ['Parameter', 'Value'],
                ['Timestamp', data.timestamp],
                ['Stock Price', '$' + data.inputs.S.toFixed(2)],
                ['Strike Price', '$' + data.inputs.K.toFixed(2)],
                ['Time to Expiry', data.inputs.T.toFixed(2) + ' years'],
                ['Risk-Free Rate', data.inputs.r.toFixed(2) + '%'],
                ['Volatility', data.inputs.sigma.toFixed(2) + '%'],
                ['Dividend Yield', data.inputs.q.toFixed(2) + '%'],
                ['Option Type', data.inputs.optionType],
                ['', ''],
                ['Greeks', 'Value'],
                ['Option Price', '$' + data.results.price.toFixed(4)],
                ['Delta', data.results.delta.toFixed(4)],
                ['Gamma', data.results.gamma.toFixed(4)],
                ['Theta', data.results.theta.toFixed(4)],
                ['Vega', data.results.vega.toFixed(4)],
                ['Rho', data.results.rho.toFixed(4)]
            ].map(row => row.join(',')).join('\n');
            
            // Download CSV
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `options_calculation_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
            
            showNotification('Calculation exported successfully!', 'success');
        }
        
        function updateSavedCalculationsDisplay() {
            const savedCalculations = JSON.parse(localStorage.getItem('optionsCalculations') || '[]');
            const container = document.getElementById('savedCalculations');
            
            if (savedCalculations.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-4 text-gray-500">
                        <p class="text-sm">No saved calculations yet</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = savedCalculations.map(calc => `
                <div class="bg-gray-50 rounded-lg p-3 flex items-center justify-between">
                    <div>
                        <h4 class="font-medium text-gray-900">${calc.name}</h4>
                        <p class="text-sm text-gray-600">
                            Price: $${calc.results.price.toFixed(4)} | 
                            Delta: ${calc.results.delta.toFixed(3)} | 
                            ${new Date(calc.timestamp).toLocaleDateString()}
                        </p>
                    </div>
                    <div class="flex space-x-2">
                        <button onclick="loadCalculation(${calc.id})" class="text-sm bg-blue-600 hover:bg-blue-700 text-white px-2 py-1 rounded">
                            Load
                        </button>
                        <button onclick="deleteCalculation(${calc.id})" class="text-sm bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded">
                            Delete
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        function loadCalculation(id) {
            const savedCalculations = JSON.parse(localStorage.getItem('optionsCalculations') || '[]');
            const calculation = savedCalculations.find(calc => calc.id === id);
            
            if (!calculation) {
                showNotification('Calculation not found', 'error');
                return;
            }
            
            // Load inputs
            document.getElementById('stockPrice').value = calculation.inputs.S.toFixed(2);
            document.getElementById('strikePrice').value = calculation.inputs.K.toFixed(2);
            document.getElementById('timeToExpiry').value = calculation.inputs.T.toFixed(2);
            document.getElementById('riskFreeRate').value = calculation.inputs.r.toFixed(2);
            document.getElementById('volatility').value = calculation.inputs.sigma.toFixed(2);
            document.getElementById('dividendYield').value = calculation.inputs.q.toFixed(2);
            document.getElementById('optionType').value = calculation.inputs.optionType;
            
            // Display results
            displayResults({
                ...calculation.results,
                ...calculation.inputs
            });
            
            // Set current calculation
            window.currentCalculation = calculation;
            
            showNotification('Calculation loaded successfully!', 'success');
        }
        
        function deleteCalculation(id) {
            let savedCalculations = JSON.parse(localStorage.getItem('optionsCalculations') || '[]');
            savedCalculations = savedCalculations.filter(calc => calc.id !== id);
            localStorage.setItem('optionsCalculations', JSON.stringify(savedCalculations));
            
            updateSavedCalculationsDisplay();
            showNotification('Calculation deleted successfully!', 'success');
        }
        
                 function clearSavedCalculations() {
             if (confirm('Are you sure you want to clear all saved calculations?')) {
                 localStorage.removeItem('optionsCalculations');
                 updateSavedCalculationsDisplay();
                 showNotification('All saved calculations cleared!', 'success');
             }
         }
         
         // Greek Modal Functions
         function openGreekModal(modalId) {
             const modal = document.getElementById(modalId);
             if (modal) {
                 modal.classList.remove('hidden');
                 // Prevent body scroll when modal is open
                 document.body.style.overflow = 'hidden';
                 
                 // Add escape key listener
                 const escapeHandler = (e) => {
                     if (e.key === 'Escape') {
                         closeGreekModal(modalId);
                         document.removeEventListener('keydown', escapeHandler);
                     }
                 };
                 document.addEventListener('keydown', escapeHandler);
                 
                 // Close modal when clicking outside
                 modal.addEventListener('click', (e) => {
                     if (e.target === modal) {
                         closeGreekModal(modalId);
                     }
                 });
             }
         }
         
         function closeGreekModal(modalId) {
             const modal = document.getElementById(modalId);
             if (modal) {
                 modal.classList.add('hidden');
                 // Restore body scroll
                 document.body.style.overflow = '';
             }
         }

        // Enhanced Notes Management System
        let currentEditingNoteId = null;
        let currentViewMode = 'table'; // 'table' or 'grid'
        let currentPage = 1;
        let itemsPerPage = 10;
        let sortField = 'lastModified';
        let sortDirection = 'desc';
        let selectedNotes = new Set();
        let allNotes = [];
        let filteredNotes = [];
        let uploadedFiles = [];
        
        function initializeNotes() {
            loadNotes();
            setupEventHandlers();
            setupFileUpload();
            
            // Initialize table view by default
            toggleViewMode();
        }
        
        function setupEventHandlers() {
            // Add form submit handler
            const noteForm = document.getElementById('noteForm');
            if (noteForm) {
                noteForm.addEventListener('submit', handleNoteSave);
            }
            
            // File drop zone handlers
            setupFileDropZone();
            
            // Search and filter handlers
            const searchInput = document.getElementById('noteSearch');
            if (searchInput) {
                let searchTimeout;
                searchInput.addEventListener('input', (e) => {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => {
                        searchNotes();
                    }, 300);
                });
            }
        }
        
        function setupFileDropZone() {
            const dropZone = document.getElementById('fileDropZone');
            if (!dropZone) return;
            
            dropZone.addEventListener('click', () => {
                document.getElementById('fileInput').click();
            });
            
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('border-blue-400', 'bg-blue-50');
            });
            
            dropZone.addEventListener('dragleave', (e) => {
                e.preventDefault();
                dropZone.classList.remove('border-blue-400', 'bg-blue-50');
            });
            
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('border-blue-400', 'bg-blue-50');
                
                const files = Array.from(e.dataTransfer.files);
                handleFileSelect({ target: { files } });
            });
        }
        
        function loadNotes() {
            allNotes = JSON.parse(localStorage.getItem('tradingNotes') || '[]');
            
            // Also load uploaded files
            uploadedFiles = JSON.parse(localStorage.getItem('uploadedFiles') || '[]');
            
            // Apply filters and search
            applyFiltersAndSearch();
            
            // Update display based on current view mode
            if (currentViewMode === 'table') {
                loadNotesTable();
            } else {
                loadNotesGrid();
            }
            
            // Update bulk actions state
            updateBulkActionsVisibility();
        }
        
        function applyFiltersAndSearch() {
            const searchTerm = document.getElementById('noteSearch')?.value.toLowerCase().trim() || '';
            const categoryFilter = document.getElementById('categoryFilter')?.value || '';
            
            filteredNotes = allNotes.filter(note => {
                const matchesSearch = !searchTerm || 
                    note.title.toLowerCase().includes(searchTerm) ||
                    note.content.toLowerCase().includes(searchTerm) ||
                    note.category.toLowerCase().includes(searchTerm);
                
                const matchesCategory = !categoryFilter || note.category === categoryFilter;
                
                return matchesSearch && matchesCategory;
            });
            
            // Apply sorting
            sortNotes();
            
            // Reset pagination
            currentPage = 1;
        }
        
        function sortNotes() {
            filteredNotes.sort((a, b) => {
                let aValue = a[sortField];
                let bValue = b[sortField];
                
                if (sortField === 'lastModified' || sortField === 'created') {
                    aValue = new Date(aValue).getTime();
                    bValue = new Date(bValue).getTime();
                }
                
                if (typeof aValue === 'string') {
                    aValue = aValue.toLowerCase();
                    bValue = bValue.toLowerCase();
                }
                
                if (sortDirection === 'desc') {
                    return bValue > aValue ? 1 : -1;
                } else {
                    return aValue > bValue ? 1 : -1;
                }
            });
        }
        
        function loadNotesTable() {
            const tableBody = document.getElementById('notesTableBody');
            const emptyState = document.getElementById('emptyNotesState');
            const tableContainer = document.getElementById('notesTableContainer');
            
            if (filteredNotes.length === 0) {
                tableContainer.classList.add('hidden');
                emptyState.classList.remove('hidden');
                return;
            }
            
            tableContainer.classList.remove('hidden');
            emptyState.classList.add('hidden');
            
            // Calculate pagination
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedNotes = filteredNotes.slice(startIndex, endIndex);
            
            // Generate table rows
            tableBody.innerHTML = paginatedNotes.map(note => createNoteRow(note)).join('');
            
            // Update pagination
            updatePagination();
        }
        
        function loadNotesGrid() {
            const notesGrid = document.getElementById('notesGrid');
            const emptyState = document.getElementById('emptyNotesState');
            const tableContainer = document.getElementById('notesTableContainer');
            
            tableContainer.classList.add('hidden');
            
            if (filteredNotes.length === 0) {
                notesGrid.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }
            
            emptyState.classList.add('hidden');
            notesGrid.innerHTML = filteredNotes.map(note => createNoteCard(note)).join('');
        }
        
        function createNoteRow(note) {
            const date = new Date(note.lastModified).toLocaleDateString();
            const categoryColors = {
                general: 'bg-gray-100 text-gray-800',
                trading: 'bg-blue-100 text-blue-800',
                analysis: 'bg-green-100 text-green-800',
                research: 'bg-purple-100 text-purple-800',
                ideas: 'bg-yellow-100 text-yellow-800',
                watchlist: 'bg-red-100 text-red-800'
            };
            
            const categoryColor = categoryColors[note.category] || categoryColors.general;
            const preview = note.content.length > 100 ? note.content.substring(0, 100) + '...' : note.content;
            const attachments = note.attachments || [];
            const similarities = findSimilarNotes(note);
            
            return `
                <tr class="hover:bg-gray-50 transition-colors">
                    <td class="px-6 py-4 whitespace-nowrap">
                        <input type="checkbox" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500 note-checkbox" 
                               data-note-id="${note.id}" onchange="toggleNoteSelection('${note.id}')">
                    </td>
                    <td class="px-6 py-4">
                        <div class="text-sm font-medium text-gray-900 truncate max-w-xs" title="${escapeHtml(note.title)}">
                            ${escapeHtml(note.title)}
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-block px-2 py-1 text-xs font-medium rounded-full ${categoryColor}">
                            ${note.category.charAt(0).toUpperCase() + note.category.slice(1)}
                        </span>
                    </td>
                    <td class="px-6 py-4">
                        <div class="text-sm text-gray-600 line-clamp-2 max-w-xs" title="${escapeHtml(note.content)}">
                            ${escapeHtml(preview)}
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center space-x-1">
                            ${attachments.length > 0 ? `
                                <span class="text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded">
                                    ${attachments.length} file${attachments.length > 1 ? 's' : ''}
                                </span>
                            ` : '<span class="text-xs text-gray-400">No files</span>'}
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="flex items-center space-x-1">
                            ${similarities.length > 0 ? `
                                <button onclick="showSimilarities('${note.id}')" class="text-xs text-blue-600 hover:text-blue-800 bg-blue-50 px-2 py-1 rounded">
                                    ${similarities.length} similar
                                </button>
                            ` : '<span class="text-xs text-gray-400">None</span>'}
                        </div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        ${date}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <div class="flex items-center space-x-2">
                            <button onclick="editNote('${note.id}')" class="text-blue-600 hover:text-blue-900 transition-colors">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                </svg>
                            </button>
                            <button onclick="deleteNote('${note.id}')" class="text-red-600 hover:text-red-900 transition-colors">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                </svg>
                            </button>
                        </div>
                    </td>
                </tr>
            `;
        }
        
        function createNoteCard(note) {
            const date = new Date(note.lastModified).toLocaleDateString();
            const categoryColors = {
                general: 'bg-gray-100 text-gray-800',
                trading: 'bg-blue-100 text-blue-800',
                analysis: 'bg-green-100 text-green-800',
                research: 'bg-purple-100 text-purple-800',
                ideas: 'bg-yellow-100 text-yellow-800',
                watchlist: 'bg-red-100 text-red-800'
            };
            
            const categoryColor = categoryColors[note.category] || categoryColors.general;
            const preview = note.content.length > 150 ? note.content.substring(0, 150) + '...' : note.content;
            const attachments = note.attachments || [];
            const similarities = findSimilarNotes(note);
            
            return `
                <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow duration-200 border border-gray-200">
                    <div class="flex items-start justify-between mb-3">
                        <h3 class="text-lg font-semibold text-gray-900 truncate flex-1">${escapeHtml(note.title)}</h3>
                        <div class="flex space-x-1 ml-2">
                            <button onclick="editNote('${note.id}')" class="text-gray-400 hover:text-blue-600 transition-colors">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                                </svg>
                            </button>
                            <button onclick="deleteNote('${note.id}')" class="text-gray-400 hover:text-red-600 transition-colors">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <div class="mb-3 flex items-center justify-between">
                        <span class="inline-block px-2 py-1 text-xs font-medium rounded-full ${categoryColor}">
                            ${note.category.charAt(0).toUpperCase() + note.category.slice(1)}
                        </span>
                        <div class="flex items-center space-x-2">
                            ${attachments.length > 0 ? `
                                <span class="text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded">
                                    ${attachments.length} file${attachments.length > 1 ? 's' : ''}
                                </span>
                            ` : ''}
                            ${similarities.length > 0 ? `
                                <button onclick="showSimilarities('${note.id}')" class="text-xs text-blue-600 hover:text-blue-800 bg-blue-50 px-2 py-1 rounded">
                                    ${similarities.length} similar
                                </button>
                            ` : ''}
                        </div>
                    </div>
                    
                    <p class="text-gray-600 text-sm mb-4 line-clamp-4">${escapeHtml(preview)}</p>
                    
                    <div class="flex items-center justify-between text-xs text-gray-500">
                        <span>Modified: ${date}</span>
                        <span>${note.content.length} characters</span>
                    </div>
                </div>
            `;
        }
        
        function showNewNoteModal() {
            currentEditingNoteId = null;
            document.getElementById('noteModalTitle').textContent = 'New Note';
            document.getElementById('noteTitle').value = '';
            document.getElementById('noteCategory').value = 'general';
            document.getElementById('noteContent').value = '';
            
            // Reset attachments list
            document.getElementById('attachmentsList').innerHTML = '';
            
            const modal = document.getElementById('noteModal');
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            
            // Focus on title field
            setTimeout(() => {
                document.getElementById('noteTitle').focus();
            }, 100);
        }
        
        function editNote(noteId) {
            const notes = JSON.parse(localStorage.getItem('tradingNotes') || '[]');
            const note = notes.find(n => n.id === noteId);
            
            if (!note) {
                showNotification('Note not found', 'error');
                return;
            }
            
            currentEditingNoteId = noteId;
            document.getElementById('noteModalTitle').textContent = 'Edit Note';
            document.getElementById('noteTitle').value = note.title;
            document.getElementById('noteCategory').value = note.category;
            document.getElementById('noteContent').value = note.content;
            
            // Load attachments
            const attachmentsList = document.getElementById('attachmentsList');
            const attachments = note.attachments || [];
            
            attachmentsList.innerHTML = attachments.map(attachment => `
                <div class="flex items-center justify-between p-2 bg-white rounded border">
                    <div class="flex items-center space-x-2">
                        <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"></path>
                        </svg>
                        <div>
                            <p class="text-sm font-medium text-gray-900">${escapeHtml(attachment.name)}</p>
                            <p class="text-xs text-gray-500">${attachment.size}</p>
                        </div>
                    </div>
                    <button type="button" onclick="this.parentElement.parentElement.remove()" class="text-red-500 hover:text-red-700">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            `).join('');
            
            const modal = document.getElementById('noteModal');
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }
        
        function closeNoteModal() {
            const modal = document.getElementById('noteModal');
            modal.classList.add('hidden');
            document.body.style.overflow = '';
            currentEditingNoteId = null;
        }
        
        // Add keyboard support for note modal
        document.addEventListener('keydown', function(e) {
            const noteModal = document.getElementById('noteModal');
            if (!noteModal.classList.contains('hidden')) {
                if (e.key === 'Escape') {
                    closeNoteModal();
                } else if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
                    // Ctrl+Enter or Cmd+Enter to save
                    e.preventDefault();
                    document.getElementById('noteForm').dispatchEvent(new Event('submit'));
                }
            }
        });
        
        function handleNoteSave(e) {
            e.preventDefault();
            
            const title = document.getElementById('noteTitle').value.trim();
            const category = document.getElementById('noteCategory').value;
            const content = document.getElementById('noteContent').value.trim();
            
            if (!title || !content) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }
            
            // Get attached files
            const attachmentsList = document.getElementById('attachmentsList');
            const attachmentElements = attachmentsList.querySelectorAll('div[class*="flex items-center justify-between"]');
            const attachments = Array.from(attachmentElements).map(el => {
                const fileName = el.querySelector('p[class*="text-sm font-medium"]').textContent;
                const fileSize = el.querySelector('p[class*="text-xs text-gray-500"]').textContent;
                return {
                    id: 'attachment_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                    name: fileName,
                    size: fileSize,
                    attachedDate: new Date().toISOString()
                };
            });
            
            const notes = JSON.parse(localStorage.getItem('tradingNotes') || '[]');
            const now = new Date().toISOString();
            
            if (currentEditingNoteId) {
                // Update existing note
                const noteIndex = notes.findIndex(n => n.id === currentEditingNoteId);
                if (noteIndex !== -1) {
                    notes[noteIndex] = {
                        ...notes[noteIndex],
                        title,
                        category,
                        content,
                        attachments,
                        lastModified: now
                    };
                    showNotification('Note updated successfully!', 'success');
                }
            } else {
                // Create new note
                const newNote = {
                    id: 'note_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                    title,
                    category,
                    content,
                    attachments,
                    created: now,
                    lastModified: now
                };
                notes.push(newNote);
                showNotification('Note created successfully!', 'success');
            }
            
            localStorage.setItem('tradingNotes', JSON.stringify(notes));
            loadNotes();
            closeNoteModal();
        }
        
        function deleteNote(noteId) {
            if (!confirm('Are you sure you want to delete this note? This action cannot be undone.')) {
                return;
            }
            
            const notes = JSON.parse(localStorage.getItem('tradingNotes') || '[]');
            const filteredNotes = notes.filter(n => n.id !== noteId);
            
            localStorage.setItem('tradingNotes', JSON.stringify(filteredNotes));
            
            // Remove from selected notes if it was selected
            selectedNotes.delete(noteId);
            
            loadNotes();
            showNotification('Note deleted successfully!', 'success');
        }
        
        // Table Management Functions
        function sortTable(field) {
            if (sortField === field) {
                sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                sortField = field;
                sortDirection = 'asc';
            }
            
            loadNotes();
        }
        
        function toggleViewMode() {
            const toggle = document.getElementById('viewModeToggle');
            const tableContainer = document.getElementById('notesTableContainer');
            const gridContainer = document.getElementById('notesGrid');
            
            if (currentViewMode === 'table') {
                currentViewMode = 'grid';
                toggle.innerHTML = `
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                    </svg>
                    Card View
                `;
                tableContainer.classList.add('hidden');
                gridContainer.classList.remove('hidden');
            } else {
                currentViewMode = 'table';
                toggle.innerHTML = `
                    <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"></path>
                    </svg>
                    Table View
                `;
                gridContainer.classList.add('hidden');
                tableContainer.classList.remove('hidden');
            }
            
            loadNotes();
        }
        
        function updatePagination() {
            const totalPages = Math.ceil(filteredNotes.length / itemsPerPage);
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, filteredNotes.length);
            
            document.getElementById('showingStart').textContent = startIndex + 1;
            document.getElementById('showingEnd').textContent = endIndex;
            document.getElementById('totalNotes').textContent = filteredNotes.length;
            
            // Update page numbers
            const paginationNumbers = document.getElementById('paginationNumbers');
            paginationNumbers.innerHTML = '';
            
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            if (endPage - startPage + 1 < maxVisiblePages) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                const pageButton = document.createElement('button');
                pageButton.className = `relative inline-flex items-center px-4 py-2 border text-sm font-medium ${
                    i === currentPage 
                        ? 'z-10 bg-blue-50 border-blue-500 text-blue-600' 
                        : 'bg-white border-gray-300 text-gray-500 hover:bg-gray-50'
                }`;
                pageButton.textContent = i;
                pageButton.onclick = () => goToPage(i);
                paginationNumbers.appendChild(pageButton);
            }
        }
        
        function goToPage(page) {
            currentPage = page;
            loadNotes();
        }
        
        function previousPage() {
            if (currentPage > 1) {
                currentPage--;
                loadNotes();
            }
        }
        
        function nextPage() {
            const totalPages = Math.ceil(filteredNotes.length / itemsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                loadNotes();
            }
        }
        
        // Selection Management Functions
        function toggleNoteSelection(noteId) {
            if (selectedNotes.has(noteId)) {
                selectedNotes.delete(noteId);
            } else {
                selectedNotes.add(noteId);
            }
            
            updateBulkActionsVisibility();
            updateSelectAllCheckbox();
        }
        
        function toggleSelectAll() {
            const selectAllCheckbox = document.getElementById('selectAllCheckbox');
            const noteCheckboxes = document.querySelectorAll('.note-checkbox');
            
            if (selectAllCheckbox.checked) {
                noteCheckboxes.forEach(checkbox => {
                    const noteId = checkbox.dataset.noteId;
                    selectedNotes.add(noteId);
                    checkbox.checked = true;
                });
            } else {
                selectedNotes.clear();
                noteCheckboxes.forEach(checkbox => {
                    checkbox.checked = false;
                });
            }
            
            updateBulkActionsVisibility();
        }
        
        function selectAllNotes() {
            filteredNotes.forEach(note => {
                selectedNotes.add(note.id);
            });
            
            document.querySelectorAll('.note-checkbox').forEach(checkbox => {
                checkbox.checked = true;
            });
            
            updateBulkActionsVisibility();
            updateSelectAllCheckbox();
        }
        
        function clearSelection() {
            selectedNotes.clear();
            
            document.querySelectorAll('.note-checkbox').forEach(checkbox => {
                checkbox.checked = false;
            });
            
            updateBulkActionsVisibility();
            updateSelectAllCheckbox();
        }
        
        function updateBulkActionsVisibility() {
            const bulkActionsBar = document.getElementById('bulkActionsBar');
            const selectedCount = document.getElementById('selectedCount');
            
            if (selectedNotes.size > 0) {
                bulkActionsBar.classList.remove('hidden');
                selectedCount.textContent = `${selectedNotes.size} note${selectedNotes.size > 1 ? 's' : ''} selected`;
            } else {
                bulkActionsBar.classList.add('hidden');
            }
        }
        
        function updateSelectAllCheckbox() {
            const selectAllCheckbox = document.getElementById('selectAllCheckbox');
            const totalVisible = document.querySelectorAll('.note-checkbox').length;
            const totalSelected = document.querySelectorAll('.note-checkbox:checked').length;
            
            if (totalSelected === 0) {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = false;
            } else if (totalSelected === totalVisible) {
                selectAllCheckbox.checked = true;
                selectAllCheckbox.indeterminate = false;
            } else {
                selectAllCheckbox.checked = false;
                selectAllCheckbox.indeterminate = true;
            }
        }
        
        // Filter Functions
        function filterNotes() {
            applyFiltersAndSearch();
            loadNotes();
        }
        
        function searchNotes() {
            applyFiltersAndSearch();
            loadNotes();
        }
        
        // File Upload Functions
        function showFileUploadModal() {
            const modal = document.getElementById('fileUploadModal');
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            
            // Reset file input and list
            document.getElementById('fileInput').value = '';
            document.getElementById('fileList').innerHTML = '';
            document.getElementById('uploadButton').disabled = true;
        }
        
        function closeFileUploadModal() {
            const modal = document.getElementById('fileUploadModal');
            modal.classList.add('hidden');
            document.body.style.overflow = '';
        }
        
        function handleFileSelect(event) {
            const files = Array.from(event.target.files);
            const fileList = document.getElementById('fileList');
            const uploadButton = document.getElementById('uploadButton');
            
            if (files.length === 0) {
                uploadButton.disabled = true;
                return;
            }
            
            fileList.innerHTML = files.map((file, index) => {
                const fileSize = (file.size / 1024).toFixed(1);
                const fileType = file.type || 'unknown';
                
                return `
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg" data-file-index="${index}">
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 bg-blue-100 rounded-lg flex items-center justify-center">
                                <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                </svg>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-gray-900">${escapeHtml(file.name)}</p>
                                <p class="text-xs text-gray-500">${fileSize} KB • ${fileType}</p>
                            </div>
                        </div>
                        <button onclick="removeFile(${index})" class="text-red-500 hover:text-red-700">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                `;
            }).join('');
            
            uploadButton.disabled = false;
        }
        
        function removeFile(index) {
            const fileInput = document.getElementById('fileInput');
            const dt = new DataTransfer();
            const files = Array.from(fileInput.files);
            
            files.splice(index, 1);
            
            files.forEach(file => {
                dt.items.add(file);
            });
            
            fileInput.files = dt.files;
            handleFileSelect({ target: { files: dt.files } });
        }
        
        function uploadFiles() {
            const fileInput = document.getElementById('fileInput');
            const files = Array.from(fileInput.files);
            const progressContainer = document.getElementById('uploadProgress');
            const progressBar = document.getElementById('progressBar');
            const progressPercent = document.getElementById('progressPercent');
            
            if (files.length === 0) return;
            
            // Show progress
            progressContainer.classList.remove('hidden');
            
            // Simulate file upload with progress
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 100) progress = 100;
                
                progressBar.style.width = `${progress}%`;
                progressPercent.textContent = `${Math.round(progress)}%`;
                
                if (progress >= 100) {
                    clearInterval(interval);
                    
                    // Save files to localStorage
                    const savedFiles = files.map(file => ({
                        id: 'file_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                        name: file.name,
                        size: file.size,
                        type: file.type,
                        uploadDate: new Date().toISOString()
                    }));
                    
                    uploadedFiles.push(...savedFiles);
                    localStorage.setItem('uploadedFiles', JSON.stringify(uploadedFiles));
                    
                    showNotification(`${files.length} file${files.length > 1 ? 's' : ''} uploaded successfully!`, 'success');
                    closeFileUploadModal();
                }
            }, 200);
        }
        
        function attachFilesToNote() {
            // Show file picker for attaching files to current note
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.multiple = true;
            fileInput.accept = '.png,.jpg,.jpeg,.pdf,.doc,.docx,.txt,.md';
            
            fileInput.onchange = (event) => {
                const files = Array.from(event.target.files);
                const attachmentsList = document.getElementById('attachmentsList');
                
                const attachmentHTML = files.map(file => {
                    const fileSize = (file.size / 1024).toFixed(1);
                    return `
                        <div class="flex items-center justify-between p-2 bg-white rounded border">
                            <div class="flex items-center space-x-2">
                                <svg class="w-4 h-4 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"></path>
                                </svg>
                                <div>
                                    <p class="text-sm font-medium text-gray-900">${escapeHtml(file.name)}</p>
                                    <p class="text-xs text-gray-500">${fileSize} KB</p>
                                </div>
                            </div>
                            <button type="button" onclick="this.parentElement.parentElement.remove()" class="text-red-500 hover:text-red-700">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                    `;
                }).join('');
                
                attachmentsList.innerHTML += attachmentHTML;
            };
            
            fileInput.click();
        }
        
        // Similarity Detection Functions
        function findSimilarNotes(note) {
            const similarities = [];
            const noteWords = extractKeywords(note.content + ' ' + note.title);
            
            allNotes.forEach(otherNote => {
                if (otherNote.id === note.id) return;
                
                const otherWords = extractKeywords(otherNote.content + ' ' + otherNote.title);
                const similarity = calculateSimilarity(noteWords, otherWords);
                
                if (similarity > 0.3) { // 30% similarity threshold
                    similarities.push({
                        note: otherNote,
                        similarity: similarity,
                        commonWords: findCommonWords(noteWords, otherWords)
                    });
                }
            });
            
            return similarities.sort((a, b) => b.similarity - a.similarity);
        }
        
        function extractKeywords(text) {
            const stopWords = ['the', 'is', 'at', 'which', 'on', 'and', 'a', 'to', 'as', 'are', 'was', 'will', 'be', 'have', 'has', 'had', 'this', 'that', 'these', 'those', 'i', 'you', 'he', 'she', 'it', 'we', 'they', 'me', 'him', 'her', 'us', 'them', 'my', 'your', 'his', 'its', 'our', 'their', 'in', 'of', 'for', 'with', 'by', 'from', 'up', 'about', 'into', 'through', 'during', 'before', 'after', 'above', 'below', 'between', 'can', 'could', 'should', 'would', 'may', 'might', 'must', 'shall', 'do', 'does', 'did', 'doing', 'done'];
            
            return text.toLowerCase()
                .replace(/[^\w\s]/g, '')
                .split(/\s+/)
                .filter(word => word.length > 2 && !stopWords.includes(word))
                .reduce((acc, word) => {
                    acc[word] = (acc[word] || 0) + 1;
                    return acc;
                }, {});
        }
        
        function calculateSimilarity(words1, words2) {
            const allWords = new Set([...Object.keys(words1), ...Object.keys(words2)]);
            let dotProduct = 0;
            let magnitude1 = 0;
            let magnitude2 = 0;
            
            allWords.forEach(word => {
                const count1 = words1[word] || 0;
                const count2 = words2[word] || 0;
                
                dotProduct += count1 * count2;
                magnitude1 += count1 * count1;
                magnitude2 += count2 * count2;
            });
            
            if (magnitude1 === 0 || magnitude2 === 0) return 0;
            
            return dotProduct / (Math.sqrt(magnitude1) * Math.sqrt(magnitude2));
        }
        
        function findCommonWords(words1, words2) {
            const common = [];
            Object.keys(words1).forEach(word => {
                if (words2[word]) {
                    common.push(word);
                }
            });
            return common.slice(0, 10); // Return top 10 common words
        }
        
        function showSimilarities(noteId) {
            const note = allNotes.find(n => n.id === noteId);
            if (!note) return;
            
            const similarities = findSimilarNotes(note);
            const modal = document.getElementById('similaritiesModal');
            const content = document.getElementById('similaritiesContent');
            
            if (similarities.length === 0) {
                content.innerHTML = `
                    <div class="text-center py-8">
                        <svg class="w-12 h-12 mx-auto mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">No Similar Notes Found</h3>
                        <p class="text-gray-600">This note doesn't have similar content to other notes.</p>
                    </div>
                `;
            } else {
                content.innerHTML = `
                    <div class="mb-4">
                        <h3 class="text-lg font-semibold text-gray-900 mb-2">Similar to: "${escapeHtml(note.title)}"</h3>
                        <p class="text-gray-600 text-sm">Found ${similarities.length} similar note${similarities.length > 1 ? 's' : ''}</p>
                    </div>
                    <div class="space-y-4">
                        ${similarities.map(sim => `
                            <div class="border border-gray-200 rounded-lg p-4 hover:bg-gray-50">
                                <div class="flex items-center justify-between mb-2">
                                    <h4 class="font-medium text-gray-900">${escapeHtml(sim.note.title)}</h4>
                                    <span class="text-sm text-blue-600 font-medium">${Math.round(sim.similarity * 100)}% similar</span>
                                </div>
                                <p class="text-sm text-gray-600 mb-2">${escapeHtml(sim.note.content.substring(0, 150))}...</p>
                                <div class="flex items-center justify-between">
                                    <div class="flex flex-wrap gap-1">
                                        ${sim.commonWords.slice(0, 5).map(word => `
                                            <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full">${word}</span>
                                        `).join('')}
                                    </div>
                                    <button onclick="editNote('${sim.note.id}'); closeSimilaritiesModal();" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
                                        View Note
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }
        
        function closeSimilaritiesModal() {
            const modal = document.getElementById('similaritiesModal');
            modal.classList.add('hidden');
            document.body.style.overflow = '';
        }
        
        // Bulk Operations Functions
        function bulkCategorize() {
            if (selectedNotes.size === 0) {
                showNotification('Please select notes to categorize', 'error');
                return;
            }
            
            const modal = document.getElementById('bulkCategorizeModal');
            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }
        
        function closeBulkCategorizeModal() {
            const modal = document.getElementById('bulkCategorizeModal');
            modal.classList.add('hidden');
            document.body.style.overflow = '';
        }
        
        function applyBulkCategorize() {
            const category = document.getElementById('bulkCategorySelect').value;
            const notes = JSON.parse(localStorage.getItem('tradingNotes') || '[]');
            
            let updatedCount = 0;
            notes.forEach(note => {
                if (selectedNotes.has(note.id)) {
                    note.category = category;
                    note.lastModified = new Date().toISOString();
                    updatedCount++;
                }
            });
            
            localStorage.setItem('tradingNotes', JSON.stringify(notes));
            
            showNotification(`${updatedCount} note${updatedCount > 1 ? 's' : ''} categorized successfully!`, 'success');
            closeBulkCategorizeModal();
            clearSelection();
            loadNotes();
        }
        
        function bulkDelete() {
            if (selectedNotes.size === 0) {
                showNotification('Please select notes to delete', 'error');
                return;
            }
            
            const count = selectedNotes.size;
            if (!confirm(`Are you sure you want to delete ${count} note${count > 1 ? 's' : ''}? This action cannot be undone.`)) {
                return;
            }
            
            const notes = JSON.parse(localStorage.getItem('tradingNotes') || '[]');
            const filteredNotes = notes.filter(note => !selectedNotes.has(note.id));
            
            localStorage.setItem('tradingNotes', JSON.stringify(filteredNotes));
            
            showNotification(`${count} note${count > 1 ? 's' : ''} deleted successfully!`, 'success');
            clearSelection();
            loadNotes();
        }
        
        function exportNotes() {
            const notes = JSON.parse(localStorage.getItem('tradingNotes') || '[]');
            
            if (notes.length === 0) {
                showNotification('No notes to export', 'error');
                return;
            }
            
            // Create exportable format
            const exportData = {
                exportDate: new Date().toISOString(),
                totalNotes: notes.length,
                notes: notes.map(note => ({
                    title: note.title,
                    category: note.category,
                    content: note.content,
                    created: note.created,
                    lastModified: note.lastModified
                }))
            };
            
            // Create and download JSON file
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `trading_notes_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
            showNotification('Notes exported successfully!', 'success');
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Market Progress Functions
        function updateMarketProgress() {
            const now = new Date();
            const marketOpen = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 9, 30, 0); // 9:30 AM
            const marketClose = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 16, 0, 0); // 4:00 PM
            
            // Check if market is open (weekdays only)
            const isWeekday = now.getDay() >= 1 && now.getDay() <= 5;
            const isMarketHours = now >= marketOpen && now <= marketClose;
            
            let currentPhase = 'Market Closed';
            let progressPercent = 0;
            let phaseDescription = 'Market is currently closed';
            let sentiment = 'Neutral';
            let volumeStatus = 'Low';
            let volatility = 'Low';
            
            if (isWeekday && isMarketHours) {
                const totalMarketMinutes = (marketClose - marketOpen) / (1000 * 60);
                const currentMinutes = (now - marketOpen) / (1000 * 60);
                progressPercent = Math.min((currentMinutes / totalMarketMinutes) * 100, 100);
                
                // Determine current phase based on time
                if (currentMinutes < 60) {
                    currentPhase = 'Market Opening';
                    phaseDescription = 'Pre-market analysis and initial trading activity';
                    sentiment = 'Cautious';
                    volumeStatus = 'High';
                    volatility = 'High';
                } else if (currentMinutes < 120) {
                    currentPhase = 'Early Session';
                    phaseDescription = 'High volume trading with price discovery';
                    sentiment = 'Active';
                    volumeStatus = 'Above Average';
                    volatility = 'Moderate';
                } else if (currentMinutes < 240) {
                    currentPhase = 'Mid-Day Trading';
                    phaseDescription = 'Trend confirmation phase with moderate volatility';
                    sentiment = 'Bullish';
                    volumeStatus = 'Above Average';
                    volatility = 'Moderate';
                } else if (currentMinutes < 330) {
                    currentPhase = 'Afternoon Session';
                    phaseDescription = 'Position adjustments and institutional activity';
                    sentiment = 'Mixed';
                    volumeStatus = 'Moderate';
                    volatility = 'Low';
                } else {
                    currentPhase = 'Market Close';
                    phaseDescription = 'Final analysis and after-hours preparation';
                    sentiment = 'Closing';
                    volumeStatus = 'High';
                    volatility = 'Moderate';
                }
            } else if (isWeekday) {
                // Market is closed but it's a weekday
                if (now < marketOpen) {
                    currentPhase = 'Pre-Market';
                    phaseDescription = 'Preparing for market opening';
                    sentiment = 'Anticipatory';
                    volumeStatus = 'Low';
                    volatility = 'Low';
                } else {
                    currentPhase = 'After-Hours';
                    phaseDescription = 'After-hours trading and next day preparation';
                    sentiment = 'Reflective';
                    volumeStatus = 'Low';
                    volatility = 'Low';
                }
            }
            
            // Update the UI
            updateMarketProgressUI(currentPhase, progressPercent, phaseDescription, sentiment, volumeStatus, volatility);
        }
        
        function updateMarketProgressUI(phase, percent, description, sentiment, volume, volatility) {
            // Update progress bar
            const progressBar = document.querySelector('.bg-gradient-to-r.from-blue-500');
            if (progressBar) {
                progressBar.style.width = `${percent}%`;
            }
            
            // Update progress percentage
            const progressElement = document.getElementById('marketProgressPercent');
            if (progressElement) {
                progressElement.textContent = `${Math.round(percent)}%`;
            }
            
            // Update current phase info
            const phaseElement = document.querySelector('.text-lg.font-semibold.text-purple-900');
            if (phaseElement) {
                phaseElement.textContent = `Current Phase: ${phase}`;
            }
            
            const descriptionElement = document.querySelector('.text-sm.text-purple-700');
            if (descriptionElement) {
                descriptionElement.textContent = description;
            }
            
            // Update step indicators
            updateStepIndicators(percent);
            
            // Update market metrics
            updateMarketMetrics(sentiment, volume, volatility);
        }
        
        function updateStepIndicators(percent) {
            const steps = document.querySelectorAll('.relative.flex.justify-between > div');
            const stepThresholds = [0, 20, 40, 60, 80];
            
            steps.forEach((step, index) => {
                const circle = step.querySelector('div[class*="w-12 h-12"]');
                const badge = step.querySelector('div[class*="px-2 py-1"]');
                
                if (percent >= stepThresholds[index]) {
                    // Completed step
                    if (circle) {
                        circle.className = circle.className.replace(/bg-gray-[0-9]+/, 'bg-green-600');
                    }
                    if (badge) {
                        badge.className = 'mt-1 px-2 py-1 bg-green-800 text-green-200 rounded-full text-xs';
                        badge.textContent = 'Complete';
                    }
                } else if (percent >= stepThresholds[index] - 20) {
                    // Active step
                    if (circle) {
                        circle.className = circle.className.replace(/bg-gray-[0-9]+|bg-green-600/, 'bg-purple-600');
                    }
                    if (badge) {
                        badge.className = 'mt-1 px-2 py-1 bg-purple-800 text-purple-200 rounded-full text-xs';
                        badge.textContent = 'Active';
                    }
                } else {
                    // Pending step
                    if (circle) {
                        circle.className = circle.className.replace(/bg-green-600|bg-purple-600/, 'bg-gray-400');
                    }
                    if (badge) {
                        badge.className = 'mt-1 px-2 py-1 bg-gray-600 text-gray-300 rounded-full text-xs';
                        badge.textContent = 'Pending';
                    }
                }
            });
        }
        
        function updateMarketMetrics(sentiment, volume, volatility) {
            // Find market metrics elements more specifically
            const metricsContainer = document.querySelector('.bg-purple-50 .grid.grid-cols-1.md\\:grid-cols-3');
            if (metricsContainer) {
                const metricElements = metricsContainer.querySelectorAll('.bg-white.rounded-lg.p-3');
                
                if (metricElements.length >= 3) {
                    // Update sentiment (first metric)
                    const sentimentElement = metricElements[0].querySelector('.text-lg.font-semibold');
                    if (sentimentElement) {
                        sentimentElement.textContent = sentiment;
                        sentimentElement.className = `text-lg font-semibold ${getSentimentColor(sentiment)}`;
                    }
                    
                    // Update volume (second metric)
                    const volumeElement = metricElements[1].querySelector('.text-lg.font-semibold');
                    if (volumeElement) {
                        volumeElement.textContent = volume;
                        volumeElement.className = `text-lg font-semibold ${getVolumeColor(volume)}`;
                    }
                    
                    // Update volatility (third metric)
                    const volatilityElement = metricElements[2].querySelector('.text-lg.font-semibold');
                    if (volatilityElement) {
                        volatilityElement.textContent = volatility;
                        volatilityElement.className = `text-lg font-semibold ${getVolatilityColor(volatility)}`;
                    }
                }
            }
        }
        
        function getSentimentColor(sentiment) {
            const colors = {
                'Bullish': 'text-green-400',
                'Bearish': 'text-red-400',
                'Mixed': 'text-yellow-400',
                'Neutral': 'text-gray-400',
                'Cautious': 'text-orange-400',
                'Active': 'text-blue-400',
                'Closing': 'text-purple-400',
                'Anticipatory': 'text-indigo-400',
                'Reflective': 'text-gray-400'
            };
            return colors[sentiment] || 'text-gray-400';
        }
        
        function getVolumeColor(volume) {
            const colors = {
                'High': 'text-red-400',
                'Above Average': 'text-blue-400',
                'Moderate': 'text-green-400',
                'Low': 'text-gray-400'
            };
            return colors[volume] || 'text-gray-400';
        }
        
        function getVolatilityColor(volatility) {
            const colors = {
                'High': 'text-red-400',
                'Moderate': 'text-orange-400',
                'Low': 'text-green-400'
            };
            return colors[volatility] || 'text-gray-400';
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Initializing application...');
            
            // Initialize Projects
            try {
                renderProjects();
                
                // Create Project Form Handler
                const createProjectForm = document.getElementById('createProjectForm');
                if (createProjectForm) {
                    createProjectForm.addEventListener('submit', function(e) {
                        e.preventDefault();
                        
                        const newProject = {
                            id: Date.now(),
                            name: document.getElementById('projectName').value,
                            description: document.getElementById('projectDescription').value,
                            team: document.getElementById('projectTeam').value,
                            priority: document.getElementById('projectPriority').value,
                            status: 'planning',
                            progress: 0,
                            dueDate: document.getElementById('projectDueDate').value,
                            createdDate: new Date().toISOString().split('T')[0],
                            tags: []
                        };
                        
                        projectsData.push(newProject);
                        renderProjects();
                        hideCreateProjectModal();
                    });
                }

                // Invite Team Form Handler
                const inviteTeamForm = document.getElementById('inviteTeamForm');
                if (inviteTeamForm) {
                    inviteTeamForm.addEventListener('submit', function(e) {
                        e.preventDefault();
                        
                        const email = document.getElementById('inviteEmail').value;
                        const role = document.getElementById('inviteRole').value;
                        const team = document.getElementById('inviteTeam').value;
                        const message = document.getElementById('inviteMessage').value;
                        const sendNotification = document.getElementById('sendNotification').checked;
                        
                        // Validate email format
                        const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                        if (!emailPattern.test(email)) {
                            showNotification('Please enter a valid email address', 'error');
                            return;
                        }
                        
                        // Send invitation
                        const success = sendTeamInvitation(email, role, team, message, sendNotification);
                        if (success) {
                            hideInviteTeamModal();
                        }
                    });
                }
            } catch (error) {
                console.error('Error initializing projects:', error);
            }
            
            // Initialize WebApp with fallback navigation
            try {
                new WebAppManager();
                console.log('WebApp initialized successfully');
            } catch (error) {
                console.error('WebApp initialization failed:', error);
                // Fallback navigation
                initializeFallbackNavigation();
            }
            
            // Initialize fallback navigation after a delay
            setTimeout(() => {
                initializeFallbackNavigation();
                ensureGlobalSidebarVisibility();
            }, 100);
            
            // Ensure sidebar is visible on page load
            ensureGlobalSidebarVisibility();
            
            // Ensure sidebar stays visible on window resize
            window.addEventListener('resize', ensureGlobalSidebarVisibility);
            
            // Add chart symbol input listener
            const chartSymbolInput = document.getElementById('chartSymbol');
            if (chartSymbolInput) {
                chartSymbolInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        loadChart();
                    }
                });
            }
            
            // Initialize market progress
            updateMarketProgress();
            
            // Update market progress every minute
            setInterval(updateMarketProgress, 60000);
            
            // Load market overview data on page load
            setTimeout(() => {
                initializeMarketOverview();
            }, 1000);
            
            // Ensure all tickers load after a delay (fallback mechanism)
            setTimeout(() => {
                ensureAllTickersLoad();
            }, 10000); // 10 seconds after page load
            
            // Auto-refresh market data every 5 minutes
            setInterval(() => {
                const container = document.getElementById('marketOverview');
                if (container) {
                    console.log('Auto-refreshing market data...');
                    loadMarketOverview();
                }
            }, 300000); // 5 minutes
        });

        // Global sidebar visibility function
        function ensureGlobalSidebarVisibility() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobileOverlay');
            
            if (window.innerWidth >= 1024) {
                // Desktop: Always show sidebar
                if (sidebar) {
                    sidebar.classList.remove('sidebar-hidden');
                }
                if (overlay) {
                    overlay.classList.add('hidden');
                }
            }
        }

        // Global navigation function
        function navigateToPage(page) {
            console.log('Global navigation to:', page);
            
            // Hide all page contents
            document.querySelectorAll('.page-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Show selected page
            const pageContent = document.getElementById(page + 'Content');
            if (pageContent) {
                pageContent.classList.remove('hidden');
                console.log('Successfully navigated to:', page);
                
                // Initialize specific page features
                if (page === 'analytics') {
                    setTimeout(() => {
                                    if (typeof initializeEnergyChart === 'function') {
                initializeEnergyChart().catch(error => {
                    console.error('Error initializing energy chart:', error);
                });
            }
                    }, 100);
                } else if (page === 'options-calculator') {
                    setTimeout(() => {
                        if (typeof updateSavedCalculationsDisplay === 'function') {
                            updateSavedCalculationsDisplay();
                        }
                    }, 100);
                } else if (page === 'notes') {
                    setTimeout(() => {
                        if (typeof initializeNotes === 'function') {
                            initializeNotes();
                        }
                    }, 100);
                }
            } else {
                console.error('Page not found:', page + 'Content');
            }
            
            // Update active nav link
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active', 'text-indigo-600', 'bg-indigo-50');
                link.classList.add('text-gray-700');
            });
            
            const activeLink = document.querySelector(`[data-page="${page}"]`);
            if (activeLink) {
                activeLink.classList.add('active', 'text-indigo-600', 'bg-indigo-50');
                activeLink.classList.remove('text-gray-700');
            }
            
            // Close mobile sidebar only on mobile devices
            if (window.innerWidth < 1024) {
                const sidebar = document.getElementById('sidebar');
                const overlay = document.getElementById('mobileOverlay');
                if (sidebar && overlay) {
                    sidebar.classList.add('sidebar-hidden');
                    overlay.classList.add('hidden');
                }
            } else {
                // Ensure sidebar is visible on desktop
                ensureGlobalSidebarVisibility();
            }
        }
        
        // Mobile menu navigation function
        function showPage(page) {
            console.log('Mobile navigation to:', page);
            navigateToPage(page);
        }

        // Fallback navigation function
        function initializeFallbackNavigation() {
            const navLinks = document.querySelectorAll('.nav-link');
            
            navLinks.forEach(link => {
                // Remove any existing listeners by cloning
                const newLink = link.cloneNode(true);
                link.parentNode.replaceChild(newLink, link);
                
                newLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const page = this.getAttribute('data-page');
                    console.log('Fallback navigation to:', page);
                    
                    // Use the global navigation function
                    navigateToPage(page);
                    
                    // Special handling for charts page
                    if (page === 'charts') {
                        setTimeout(() => {
                            if (typeof initializeChartsPage === 'function') {
                                initializeChartsPage();
                            }
                        }, 100);
                    }
                });
            });
            
            console.log('Fallback navigation initialized for', navLinks.length, 'links');
        }

        // Inline Signals Functionality
        let inlineCurrentSignals = [];

        // Main function to generate signals inline
        async function generateSignalsInline() {
            console.log('Generate signals inline function called');
            
            const symbolInput = document.getElementById('signalSymbolInput');
            if (!symbolInput) {
                console.error('Signal symbol input not found');
                return;
            }
            
            const symbol = symbolInput.value.trim().toUpperCase();
            
            if (!symbol) {
                showInlineNotification('Please enter a symbol', 'error');
                return;
            }

            try {
                console.log('Generating signals for:', symbol);
                
                // Simulate API call delay
                await new Promise(resolve => setTimeout(resolve, 1000));

                // Generate mock signals
                const signals = generateMockSignalsInline(symbol);
                inlineCurrentSignals = signals;

                console.log('Generated signals:', signals);

                // Update UI
                updateInlineSignalsDisplay(signals);
                updateInlineStatistics(signals);
                updateInlineMarketStatus(symbol);
                updateInlineFibonacciAnalysis(signals);
                updateInlineICTWireframe(signals);

                showInlineNotification('Generated ' + signals.length + ' signals for ' + symbol, 'success');

            } catch (error) {
                console.error('Error generating signals:', error);
                showInlineNotification('Error generating signals. Please try again.', 'error');
            }
        }

        // Generate mock signals for inline
        function generateMockSignalsInline(symbol) {
            console.log('Generating mock signals for:', symbol);
            
            const signals = [];
            const currentPrice = 100 + Math.random() * 400;
            const setupTypes = ['Bullish OB', 'Bearish OB', 'FVG', 'Liquidity Sweep', 'MSS', 'ICT Breaker', 'PO3 Range'];
            
            // Generate 3-6 signals
            const numSignals = Math.floor(Math.random() * 4) + 3;
            
            for (let i = 0; i < numSignals; i++) {
                const direction = Math.random() > 0.5 ? 'bullish' : 'bearish';
                const entryPrice = currentPrice + (Math.random() - 0.5) * 20;
                const stopLoss = direction === 'bullish' ? 
                    entryPrice - (Math.random() * 10 + 5) : 
                    entryPrice + (Math.random() * 10 + 5);
                const takeProfit = direction === 'bullish' ? 
                    entryPrice + (Math.random() * 20 + 10) : 
                    entryPrice - (Math.random() * 20 + 10);
                
                const rrRatio = Math.abs(takeProfit - entryPrice) / Math.abs(entryPrice - stopLoss);
                
                signals.push({
                    id: 'signal_' + (i + 1),
                    symbol: symbol,
                    direction: direction,
                    entry_price: entryPrice,
                    stop_loss: stopLoss,
                    take_profit: takeProfit,
                    risk_reward_ratio: rrRatio,
                    confidence: Math.floor(Math.random() * 30) + 70,
                    setup_type: setupTypes[Math.floor(Math.random() * setupTypes.length)],
                    dominant_signal: direction === 'bullish' ? 'BUY' : 'SELL',
                    current_price: currentPrice
                });
            }
            
            return signals;
        }

        // Update inline signals display
        function updateInlineSignalsDisplay(signals) {
            console.log('Updating inline signals display');
            
            try {
                // Update live signals
                const liveSignalsContainer = document.getElementById('inlineLiveSignals');
                if (!liveSignalsContainer) {
                    console.error('Inline live signals container not found');
                    return;
                }
                
                liveSignalsContainer.innerHTML = '';
                
                signals.slice(0, 3).forEach(signal => {
                    const signalCard = createInlineSignalCard(signal);
                    liveSignalsContainer.appendChild(signalCard);
                });

                // Update table
                const tableBody = document.getElementById('inlineSignalsTableBody');
                if (!tableBody) {
                    console.error('Inline table body not found');
                    return;
                }
                
                tableBody.innerHTML = '';
                
                signals.forEach(signal => {
                    const row = createInlineSignalRow(signal);
                    tableBody.appendChild(row);
                });
            } catch (error) {
                console.error('Error updating inline signals display:', error);
            }
        }

        // Create inline signal card
        function createInlineSignalCard(signal) {
            const card = document.createElement('div');
            card.className = 'p-4 rounded-lg border-l-4 transition-all hover:shadow-md ' + 
                (signal.direction === 'bullish' ? 'border-green-500 bg-green-50' : 'border-red-500 bg-red-50');
            
            const directionIcon = signal.direction === 'bullish' ? 'text-green-600' : 'text-red-600';
            const arrowIcon = signal.direction === 'bullish' ? '↗' : '↘';
            
            card.innerHTML = '<div class="flex items-center justify-between mb-2">' +
                '<div class="flex items-center">' +
                '<span class="text-xl mr-2">' + arrowIcon + '</span>' +
                '<span class="font-semibold ' + directionIcon + '">' + signal.dominant_signal + '</span>' +
                '</div>' +
                '<span class="text-sm text-gray-500">' + signal.confidence + '%</span>' +
                '</div>' +
                '<div class="text-sm text-gray-600 mb-2">' + signal.setup_type + '</div>' +
                '<div class="flex justify-between text-sm">' +
                '<span>Entry: $' + signal.entry_price.toFixed(2) + '</span>' +
                '<span>R:R ' + signal.risk_reward_ratio.toFixed(2) + '</span>' +
                '</div>';
            
            return card;
        }

        // Create inline signal row
        function createInlineSignalRow(signal) {
            const row = document.createElement('tr');
            row.className = 'hover:bg-gray-50';
            
            const directionIcon = signal.direction === 'bullish' ? 'text-green-600' : 'text-red-600';
            const arrowIcon = signal.direction === 'bullish' ? '↗' : '↘';
            
            row.innerHTML = '<td class="px-6 py-4 whitespace-nowrap">' +
                '<div class="flex items-center">' +
                '<span class="text-xl mr-2">' + arrowIcon + '</span>' +
                '<span class="font-medium">' + signal.symbol + '</span>' +
                '</div>' +
                '</td>' +
                '<td class="px-6 py-4 whitespace-nowrap">' +
                '<span class="px-2 py-1 text-xs font-semibold rounded-full ' + directionIcon + ' bg-gray-100">' +
                signal.dominant_signal +
                '</span>' +
                '</td>' +
                '<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">$' + signal.entry_price.toFixed(2) + '</td>' +
                '<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">$' + signal.stop_loss.toFixed(2) + '</td>' +
                '<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">$' + signal.take_profit.toFixed(2) + '</td>' +
                '<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">' + signal.risk_reward_ratio.toFixed(2) + '</td>' +
                '<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">' + signal.confidence + '%</td>' +
                '<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">' + signal.setup_type + '</td>';
            
            return row;
        }

        // Update inline statistics
        function updateInlineStatistics(signals) {
            try {
                const bullishCount = signals.filter(s => s.direction === 'bullish').length;
                const bearishCount = signals.filter(s => s.direction === 'bearish').length;
                const avgConfidence = signals.reduce((sum, s) => sum + s.confidence, 0) / signals.length;
                
                const totalSignalsEl = document.getElementById('inlineTotalSignals');
                const bullishSignalsEl = document.getElementById('inlineBullishSignals');
                const bearishSignalsEl = document.getElementById('inlineBearishSignals');
                const avgConfidenceEl = document.getElementById('inlineAvgConfidence');
                
                if (totalSignalsEl) totalSignalsEl.textContent = signals.length;
                if (bullishSignalsEl) bullishSignalsEl.textContent = bullishCount;
                if (bearishSignalsEl) bearishSignalsEl.textContent = bearishCount;
                if (avgConfidenceEl) avgConfidenceEl.textContent = avgConfidence.toFixed(1) + '%';
            } catch (error) {
                console.error('Error updating inline statistics:', error);
            }
        }

        // Update inline market status
        function updateInlineMarketStatus(symbol) {
            try {
                const now = new Date();
                const sessions = ['London', 'New York', 'Asian', 'Pre-Market'];
                const volatilities = ['Low', 'Medium', 'High'];
                
                const currentSymbolEl = document.getElementById('inlineCurrentSymbol');
                const lastUpdateEl = document.getElementById('inlineLastUpdate');
                const marketSessionEl = document.getElementById('inlineMarketSession');
                const volatilityEl = document.getElementById('inlineVolatility');
                
                if (currentSymbolEl) currentSymbolEl.textContent = symbol;
                if (lastUpdateEl) lastUpdateEl.textContent = now.toLocaleTimeString();
                if (marketSessionEl) marketSessionEl.textContent = sessions[Math.floor(Math.random() * sessions.length)];
                if (volatilityEl) volatilityEl.textContent = volatilities[Math.floor(Math.random() * volatilities.length)];
            } catch (error) {
                console.error('Error updating inline market status:', error);
            }
        }

        // Update inline Fibonacci analysis - Enhanced MyPivots Integration
        function updateInlineFibonacciAnalysis(signals) {
            try {
                if (signals.length === 0) return;
                
                const signal = signals[0];
                const fibContainer = document.getElementById('inlineFibonacciLevels');
                if (!fibContainer) return;
                
                // Generate realistic high/low range based on current price
                const currentPrice = signal.current_price;
                const volatility = Math.random() * 0.15 + 0.05; // 5-20% volatility
                const dayHigh = currentPrice * (1 + volatility);
                const dayLow = currentPrice * (1 - volatility);
                const range = dayHigh - dayLow;
                
                // Professional Fibonacci levels with retracements and extensions
                const fibonacciLevels = {
                    // Extensions (above 100%)
                    '261.8%': { level: 2.618, type: 'extension' },
                    '200.0%': { level: 2.000, type: 'extension' },
                    '161.8%': { level: 1.618, type: 'extension' },
                    '127.2%': { level: 1.272, type: 'extension' },
                    
                    // Key levels
                    '100.0%': { level: 1.000, type: 'key' },
                    '78.6%': { level: 0.786, type: 'retracement' },
                    '61.8%': { level: 0.618, type: 'retracement' },
                    '50.0%': { level: 0.500, type: 'retracement' },
                    '38.2%': { level: 0.382, type: 'retracement' },
                    '23.6%': { level: 0.236, type: 'retracement' },
                    '0.0%': { level: 0.000, type: 'key' }
                };
                
                // Calculate prices based on high/low range (MyPivots method)
                const calculatedLevels = {};
                Object.entries(fibonacciLevels).forEach(([percentage, data]) => {
                    // Retracement: High - (Range * Ratio)
                    // Extension: High + (Range * (Ratio - 1))
                    let price;
                    if (data.type === 'extension') {
                        price = dayHigh + (range * (data.level - 1));
                    } else {
                        price = dayHigh - (range * data.level);
                    }
                    
                    calculatedLevels[percentage] = {
                        price: price,
                        type: data.type,
                        level: data.level
                    };
                });
                
                // Create enhanced Fibonacci display
                fibContainer.innerHTML = '';
                
                // Add header with High/Low info
                const headerDiv = document.createElement('div');
                headerDiv.className = 'mb-4 p-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg';
                headerDiv.innerHTML = '<div class="text-center">' +
                    '<h4 class="font-semibold mb-2">Fibonacci Analysis</h4>' +
                    '<div class="grid grid-cols-2 gap-4 text-sm">' +
                    '<div><span class="opacity-80">High:</span> <span class="font-bold">$' + dayHigh.toFixed(2) + '</span></div>' +
                    '<div><span class="opacity-80">Low:</span> <span class="font-bold">$' + dayLow.toFixed(2) + '</span></div>' +
                    '</div>' +
                    '<div class="mt-2 text-xs opacity-80">Range: $' + range.toFixed(2) + ' (' + (volatility * 100).toFixed(1) + '% volatility)</div>' +
                    '</div>';
                fibContainer.appendChild(headerDiv);
                
                // Sort levels by price (highest to lowest)
                const sortedLevels = Object.entries(calculatedLevels).sort((a, b) => b[1].price - a[1].price);
                
                // Create level groups
                const extensionLevels = sortedLevels.filter(([, data]) => data.type === 'extension');
                const keyLevels = sortedLevels.filter(([, data]) => data.type === 'key');
                const retracementLevels = sortedLevels.filter(([, data]) => data.type === 'retracement');
                
                // Add Extensions section
                if (extensionLevels.length > 0) {
                    const extensionHeader = document.createElement('div');
                    extensionHeader.className = 'mt-4 mb-2 text-sm font-semibold text-gray-700 border-b border-gray-200 pb-1';
                    extensionHeader.textContent = '🚀 Extension Levels';
                    fibContainer.appendChild(extensionHeader);
                    
                    extensionLevels.forEach(([percentage, data]) => {
                        const levelDiv = createFibonacciLevelDiv(percentage, data.price, 'border-red-500 bg-red-50', 'text-red-600');
                        fibContainer.appendChild(levelDiv);
                    });
                }
                
                // Add Key levels section
                if (keyLevels.length > 0) {
                    const keyHeader = document.createElement('div');
                    keyHeader.className = 'mt-4 mb-2 text-sm font-semibold text-gray-700 border-b border-gray-200 pb-1';
                    keyHeader.textContent = '🎯 Key Levels';
                    fibContainer.appendChild(keyHeader);
                    
                    keyLevels.forEach(([percentage, data]) => {
                        const levelDiv = createFibonacciLevelDiv(percentage, data.price, 'border-gray-500 bg-gray-100', 'text-gray-700');
                        fibContainer.appendChild(levelDiv);
                    });
                }
                
                // Add Retracement section
                if (retracementLevels.length > 0) {
                    const retracementHeader = document.createElement('div');
                    retracementHeader.className = 'mt-4 mb-2 text-sm font-semibold text-gray-700 border-b border-gray-200 pb-1';
                    retracementHeader.textContent = '📉 Retracement Levels';
                    fibContainer.appendChild(retracementHeader);
                    
                    retracementLevels.forEach(([percentage, data]) => {
                        const levelDiv = createFibonacciLevelDiv(percentage, data.price, 'border-green-500 bg-green-50', 'text-green-600');
                        fibContainer.appendChild(levelDiv);
                    });
                }
                
                // Add trading insights
                const insightsDiv = document.createElement('div');
                insightsDiv.className = 'mt-4 p-3 bg-yellow-50 border-l-4 border-yellow-400 rounded-lg';
                const nearestSupport = retracementLevels.find(([, data]) => data.price < currentPrice);
                const nearestResistance = [...extensionLevels, ...keyLevels].find(([, data]) => data.price > currentPrice);
                
                insightsDiv.innerHTML = '<div class="text-sm">' +
                    '<div class="font-semibold text-yellow-800 mb-2">💡 Trading Insights:</div>' +
                    '<div class="text-yellow-700 space-y-1">' +
                    '<div>• Current Price: <span class="font-semibold">$' + currentPrice.toFixed(2) + '</span></div>' +
                    (nearestSupport ? '<div>• Next Support: <span class="font-semibold">' + nearestSupport[0] + ' ($' + nearestSupport[1].price.toFixed(2) + ')</span></div>' : '') +
                    (nearestResistance ? '<div>• Next Resistance: <span class="font-semibold">' + nearestResistance[0] + ' ($' + nearestResistance[1].price.toFixed(2) + ')</span></div>' : '') +
                    '<div>• Key retracement zones: 38.2%, 50%, 61.8%</div>' +
                    '</div>' +
                    '</div>';
                fibContainer.appendChild(insightsDiv);
                
            } catch (error) {
                console.error('Error updating inline Fibonacci analysis:', error);
            }
        }
        
        // Helper function to create Fibonacci level divs
        function createFibonacciLevelDiv(percentage, price, borderClass, textClass) {
            const levelDiv = document.createElement('div');
            levelDiv.className = 'p-2 rounded-lg mb-1 border-l-4 transition-all hover:shadow-sm cursor-pointer ' + borderClass;
            
            // Determine if this is a critical level
            const criticalLevels = ['61.8%', '50.0%', '38.2%', '100.0%', '161.8%'];
            const isCritical = criticalLevels.includes(percentage);
            
            levelDiv.innerHTML = '<div class="flex justify-between items-center">' +
                '<span class="font-medium ' + (isCritical ? 'font-bold' : '') + '">' +
                (isCritical ? '★ ' : '') + 'Fib ' + percentage + '</span>' +
                '<span class="font-semibold ' + textClass + '">$' + price.toFixed(3) + '</span>' +
                '</div>';
                
            // Add click handler for additional info
            levelDiv.addEventListener('click', function() {
                showFibonacciLevelDetails(percentage, price);
            });
            
            return levelDiv;
        }
        
        // Show detailed Fibonacci level information
        function showFibonacciLevelDetails(percentage, price) {
            const message = 'Fibonacci ' + percentage + ' Level\n\n' +
                'Price Target: $' + price.toFixed(3) + '\n' +
                'Level Type: ' + (parseFloat(percentage) > 100 ? 'Extension' : parseFloat(percentage) === 100 || parseFloat(percentage) === 0 ? 'Key Level' : 'Retracement') + '\n\n' +
                'Trading Notes:\n' +
                '• Watch for price reactions at this level\n' +
                '• Consider this for entry/exit points\n' +
                '• Combine with other technical indicators\n' +
                '• Use proper risk management';
                
            showInlineNotification('Level Details: ' + percentage + ' - $' + price.toFixed(2), 'info');
        }

        // Update inline ICT wireframe
        function updateInlineICTWireframe(signals) {
            try {
                if (signals.length === 0) return;
                
                const signal = signals[0];
                const wireframeContainer = document.getElementById('inlineIctWireframe');
                if (!wireframeContainer) return;
                
                const wireframeStrength = Math.floor(Math.random() * 30) + 70;
                const po3Low = signal.current_price - 15;
                const po3High = signal.current_price + 15;
                
                wireframeContainer.innerHTML = '<div class="bg-gradient-to-r from-purple-500 to-indigo-600 text-white p-4 rounded-lg mb-4">' +
                    '<h4 class="font-semibold mb-2">Wireframe Strength</h4>' +
                    '<div class="text-2xl font-bold">' + wireframeStrength + '%</div>' +
                    '</div>' +
                    '<div class="space-y-3">' +
                    '<div class="flex justify-between">' +
                    '<span class="text-gray-600">PO3 Low:</span>' +
                    '<span class="font-semibold text-red-600">$' + po3Low.toFixed(2) + '</span>' +
                    '</div>' +
                    '<div class="flex justify-between">' +
                    '<span class="text-gray-600">PO3 High:</span>' +
                    '<span class="font-semibold text-green-600">$' + po3High.toFixed(2) + '</span>' +
                    '</div>' +
                    '<div class="flex justify-between">' +
                    '<span class="text-gray-600">Active Algorithms:</span>' +
                    '<span class="font-semibold">' + (Math.floor(Math.random() * 3) + 2) + '</span>' +
                    '</div>' +
                    '</div>';
            } catch (error) {
                console.error('Error updating inline ICT wireframe:', error);
            }
        }

        // Show inline notification
        function showInlineNotification(message, type) {
            try {
                type = type || 'info';
                const notification = document.createElement('div');
                
                let bgColor = 'bg-blue-500 text-white';
                let icon = '💡';
                
                if (type === 'success') {
                    bgColor = 'bg-green-500 text-white';
                    icon = '✅';
                } else if (type === 'error') {
                    bgColor = 'bg-red-500 text-white';
                    icon = '❌';
                }
                
                notification.className = 'fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 ' + bgColor;
                notification.innerHTML = '<div class="flex items-center">' +
                    '<span class="mr-2">' + icon + '</span>' +
                    '<span>' + message + '</span>' +
                    '</div>';
                
                document.body.appendChild(notification);
                
                // Remove after 3 seconds
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 3000);
            } catch (error) {
                console.error('Error showing inline notification:', error);
            }
        }

        // Add enter key support for inline signal input
        document.addEventListener('DOMContentLoaded', function() {
            const inlineSymbolInput = document.getElementById('signalSymbolInput');
            if (inlineSymbolInput) {
                inlineSymbolInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        generateSignalsInline();
                    }
                });
            }
        });

        // ==============================================
        // FINANCIAL ANALYSIS FUNCTIONS
        // ==============================================

        const API_KEY = '3GYZUNBVA3HSKAAA';
        let chartInstance = null;

        // Add Enter key support for stock search
        document.addEventListener('DOMContentLoaded', function() {
            const stockSymbolInput = document.getElementById('stockSymbol');
            if (stockSymbolInput) {
                stockSymbolInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        fetchStockData();
                    }
                });
            }
        });

        // Fetch stock data from Yahoo Finance API
        async function fetchStockData() {
            const symbol = document.getElementById('stockSymbol').value.toUpperCase();
            if (!symbol) {
                showFinancialNotification('Please enter a stock symbol', 'error');
                return;
            }

            try {
                showFinancialNotification('Fetching stock data...', 'info');
                
                // Update API status
                document.getElementById('apiStatus').textContent = 'Fetching...';
                document.getElementById('apiStatus').className = 'text-2xl font-bold text-yellow-600';

                const API_BASE_URL = 'http://localhost:5001';
                
                // Fetch stock quote
                const quoteResponse = await axios.get(`${API_BASE_URL}/api/quote/${symbol}`);
                const quoteData = quoteResponse.data;

                if (quoteData.error) {
                    showFinancialNotification('Invalid stock symbol or API error', 'error');
                    document.getElementById('apiStatus').textContent = 'Error';
                    document.getElementById('apiStatus').className = 'text-2xl font-bold text-red-600';
                    return;
                }

                // Fetch chart data
                const chartResponse = await axios.get(`${API_BASE_URL}/api/chart/${symbol}?timeframe=1M`);
                const chartData = chartResponse.data;

                // Update stock info
                document.getElementById('companyName').textContent = quoteData.name || symbol;
                document.getElementById('stockPrice').textContent = `$${quoteData.price.toFixed(2)}`;
                document.getElementById('peRatio').textContent = quoteData.pe_ratio || 'N/A';
                document.getElementById('marketCap').textContent = quoteData.market_cap ? 
                    `$${formatLargeNumber(quoteData.market_cap)}` : 'N/A';
                document.getElementById('volume').textContent = formatLargeNumber(quoteData.volume || 0);

                // Show stock info sections
                document.getElementById('stockInfo').style.display = 'block';
                document.getElementById('stockChartCard').style.display = 'block';
                document.getElementById('newsFeed').style.display = 'block';

                // Update chart with Yahoo Finance data
                updateStockChartYahoo(chartData);

                // Update news (simplified for now)
                updateFinancialNews([]);

                // Update API status
                document.getElementById('apiStatus').textContent = 'Connected';
                document.getElementById('apiStatus').className = 'text-2xl font-bold text-green-600';

                showFinancialNotification(`Successfully loaded data for ${symbol}`, 'success');
            } catch (error) {
                console.error('Error fetching stock data:', error);
                showFinancialNotification('Error fetching stock data. Please try again.', 'error');
                document.getElementById('apiStatus').textContent = 'Error';
                document.getElementById('apiStatus').className = 'text-2xl font-bold text-red-600';
            }
        }

        // Format large numbers
        function formatLargeNumber(num) {
            if (!num || num === 0) return '0';
            const number = parseFloat(num);
            if (number >= 1e12) return (number / 1e12).toFixed(1) + 'T';
            if (number >= 1e9) return (number / 1e9).toFixed(1) + 'B';
            if (number >= 1e6) return (number / 1e6).toFixed(1) + 'M';
            if (number >= 1e3) return (number / 1e3).toFixed(1) + 'K';
            return number.toLocaleString();
        }

        // Update stock chart
        function updateStockChart(timeSeriesData) {
            if (!timeSeriesData) return;

            const labels = Object.keys(timeSeriesData).slice(0, 30).reverse();
            const prices = labels.map(date => parseFloat(timeSeriesData[date]['4. close']));

            if (chartInstance) {
                chartInstance.destroy();
            }

            const ctx = document.getElementById('stockChart').getContext('2d');
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Stock Price',
                        data: prices,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { 
                            display: true, 
                            title: { display: true, text: 'Date' }
                        },
                        y: { 
                            display: true, 
                            title: { display: true, text: 'Price (USD)' }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });
        }

        // Update stock chart with Yahoo Finance data
        function updateStockChartYahoo(chartData) {
            if (!chartData || !chartData.data) return;

            const labels = chartData.data.map(item => item.date);
            const prices = chartData.data.map(item => item.price);

            if (chartInstance) {
                chartInstance.destroy();
            }

            const ctx = document.getElementById('stockChart').getContext('2d');
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: `${chartData.symbol} Stock Price`,
                        data: prices,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { 
                            display: true, 
                            title: { display: true, text: 'Date' }
                        },
                        y: { 
                            display: true, 
                            title: { display: true, text: 'Price (USD)' }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });
        }

        // Update news feed
        function updateFinancialNews(newsData) {
            const newsList = document.getElementById('newsList');
            newsList.innerHTML = '';
            
            if (!newsData || newsData.length === 0) {
                newsList.innerHTML = '<p class="text-gray-500 text-center py-4">No recent news available</p>';
                return;
            }

            newsData.slice(0, 5).forEach(news => {
                const newsItem = document.createElement('div');
                newsItem.className = 'border-b border-gray-200 pb-4 mb-4 last:border-b-0';
                newsItem.innerHTML = `
                    <h4 class="font-semibold text-gray-900 mb-2 hover:text-blue-600 cursor-pointer">
                        <a href="${news.url}" target="_blank" class="text-decoration-none">
                            ${news.title}
                        </a>
                    </h4>
                    <p class="text-sm text-gray-600 mb-2">${news.summary ? news.summary.slice(0, 150) + '...' : 'No summary available'}</p>
                    <div class="flex items-center text-xs text-gray-500">
                        <span>Source: ${news.source || 'Unknown'}</span>
                        <span class="mx-2">•</span>
                        <span>Published: ${new Date(news.time_published).toLocaleDateString()}</span>
                    </div>
                `;
                newsList.appendChild(newsItem);
            });
        }

        // Portfolio management
        // Enhanced Portfolio Management Functions
        function showAddTradeModal() {
            document.getElementById('addTradeModal').classList.remove('hidden');
            document.getElementById('tradeDate').value = new Date().toISOString().split('T')[0];
        }

        function hideAddTradeModal() {
            document.getElementById('addTradeModal').classList.add('hidden');
            document.getElementById('addTradeForm').reset();
        }

        function addToPortfolio() {
            const symbol = document.getElementById('stockSymbol').value.toUpperCase();
            const priceText = document.getElementById('stockPrice').textContent;
            const price = parseFloat(priceText.replace('$', ''));
            
            if (!symbol || !price) {
                showFinancialNotification('Please search for a stock first', 'error');
                return;
            }

            let trades = JSON.parse(localStorage.getItem('trades') || '[]');
            
            // Create a simple trade entry from search
            const trade = {
                id: Date.now(),
                symbol: symbol,
                type: 'BUY',
                quantity: 1,
                price: price,
                date: new Date().toISOString().split('T')[0],
                strategy: 'Long Term',
                notes: 'Added from stock search',
                status: 'OPEN'
            };
            
            trades.push(trade);
            localStorage.setItem('trades', JSON.stringify(trades));
            updatePortfolioTable();
            updatePortfolioStats();
            showFinancialNotification(`${symbol} added to portfolio`, 'success');
        }

        function addTrade(event) {
            event.preventDefault();
            
            const symbol = document.getElementById('tradeSymbol').value.toUpperCase();
            const type = document.getElementById('tradeType').value;
            const quantity = parseInt(document.getElementById('tradeQuantity').value);
            const price = parseFloat(document.getElementById('tradePrice').value);
            const date = document.getElementById('tradeDate').value;
            const strategy = document.getElementById('tradeStrategy').value;
            const notes = document.getElementById('tradeNotes').value;
            
            if (!symbol || !quantity || !price || !date) {
                showFinancialNotification('Please fill in all required fields', 'error');
                return;
            }

            let trades = JSON.parse(localStorage.getItem('trades') || '[]');
            
            const trade = {
                id: Date.now(),
                symbol: symbol,
                type: type,
                quantity: quantity,
                price: price,
                date: date,
                strategy: strategy,
                notes: notes,
                status: 'OPEN'
            };
            
            trades.push(trade);
            localStorage.setItem('trades', JSON.stringify(trades));
            updatePortfolioTable();
            updatePortfolioStats();
            hideAddTradeModal();
            showFinancialNotification(`Trade ${symbol} added successfully`, 'success');
        }

        function updatePortfolioTable() {
            const trades = JSON.parse(localStorage.getItem('trades') || '[]');
            const tableBody = document.getElementById('portfolioTable');
            
            if (trades.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="5" class="py-8 text-center text-gray-500">
                            <svg class="w-12 h-12 mx-auto mb-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
                            </svg>
                            <p>No trades in portfolio. Add trades to track them here.</p>
                        </td>
                    </tr>
                `;
                return;
            }

            // Group trades by symbol for portfolio view
            const positions = {};
            trades.forEach(trade => {
                if (!positions[trade.symbol]) {
                    positions[trade.symbol] = {
                        symbol: trade.symbol,
                        totalQuantity: 0,
                        totalValue: 0,
                        avgPrice: 0,
                        trades: []
                    };
                }
                
                const position = positions[trade.symbol];
                position.trades.push(trade);
                
                if (trade.type === 'BUY') {
                    position.totalQuantity += trade.quantity;
                    position.totalValue += trade.quantity * trade.price;
                } else {
                    position.totalQuantity -= trade.quantity;
                    position.totalValue -= trade.quantity * trade.price;
                }
            });

            // Calculate average price and P&L for each position
            Object.keys(positions).forEach(symbol => {
                const position = positions[symbol];
                if (position.totalQuantity > 0) {
                    position.avgPrice = position.totalValue / position.totalQuantity;
                }
            });

            tableBody.innerHTML = '';
            Object.values(positions).forEach(position => {
                if (position.totalQuantity <= 0) return; // Skip closed positions
                
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-100 hover:bg-gray-50';
                
                // Mock current price for P&L calculation (in real app, would fetch from API)
                const currentPrice = position.avgPrice * (1 + (Math.random() - 0.5) * 0.1);
                const pl = (currentPrice - position.avgPrice) * position.totalQuantity;
                const plPercent = ((currentPrice - position.avgPrice) / position.avgPrice) * 100;
                
                const plClass = pl >= 0 ? 'text-green-600' : 'text-red-600';
                const plSymbol = pl >= 0 ? '+' : '';
                
                row.innerHTML = `
                    <td class="py-3 font-medium text-gray-900">${position.symbol}</td>
                    <td class="py-3 text-gray-700">${position.totalQuantity}</td>
                    <td class="py-3 text-gray-700">$${position.avgPrice.toFixed(2)}</td>
                    <td class="py-3 ${plClass}">${plSymbol}$${pl.toFixed(2)}</td>
                    <td class="py-3">
                        <div class="flex space-x-1">
                            <button onclick="editPosition('${position.symbol}')" class="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 rounded text-xs transition-colors">
                                Edit
                            </button>
                            <button onclick="closePosition('${position.symbol}')" class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-xs transition-colors">
                                Close
                            </button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function editPosition(symbol) {
            const trades = JSON.parse(localStorage.getItem('trades') || '[]');
            const symbolTrades = trades.filter(trade => trade.symbol === symbol);
            
            if (symbolTrades.length === 0) return;
            
            // Show a simple edit dialog for position
            const newQuantity = prompt(`Edit quantity for ${symbol}:`, symbolTrades[0].quantity);
            if (newQuantity && !isNaN(newQuantity)) {
                symbolTrades[0].quantity = parseInt(newQuantity);
                localStorage.setItem('trades', JSON.stringify(trades));
                updatePortfolioTable();
                updatePortfolioStats();
                showFinancialNotification(`${symbol} position updated`, 'success');
            }
        }

        function closePosition(symbol) {
            if (confirm(`Are you sure you want to close the ${symbol} position?`)) {
                let trades = JSON.parse(localStorage.getItem('trades') || '[]');
                trades = trades.filter(trade => trade.symbol !== symbol);
                localStorage.setItem('trades', JSON.stringify(trades));
                updatePortfolioTable();
                updatePortfolioStats();
                showFinancialNotification(`${symbol} position closed`, 'success');
            }
        }

        function togglePortfolioView() {
            const toggleText = document.getElementById('viewToggleText');
            if (toggleText.textContent === 'Detailed View') {
                toggleText.textContent = 'Simple View';
                // Could implement detailed view with individual trades
            } else {
                toggleText.textContent = 'Detailed View';
            }
        }

        function removeFromPortfolio(symbol) {
            let portfolio = JSON.parse(localStorage.getItem('portfolio') || '[]');
            portfolio = portfolio.filter(item => item.symbol !== symbol);
            localStorage.setItem('portfolio', JSON.stringify(portfolio));
            updatePortfolioTable();
            updatePortfolioStats();
            showFinancialNotification(`${symbol} removed from portfolio`, 'success');
        }

        function updatePortfolioStats() {
            const trades = JSON.parse(localStorage.getItem('trades') || '[]');
            
            // Calculate portfolio statistics
            const positions = {};
            let totalValue = 0;
            let totalPL = 0;
            let winCount = 0;
            let totalTrades = 0;
            
            trades.forEach(trade => {
                if (!positions[trade.symbol]) {
                    positions[trade.symbol] = {
                        totalQuantity: 0,
                        totalValue: 0,
                        avgPrice: 0
                    };
                }
                
                const position = positions[trade.symbol];
                
                if (trade.type === 'BUY') {
                    position.totalQuantity += trade.quantity;
                    position.totalValue += trade.quantity * trade.price;
                } else {
                    position.totalQuantity -= trade.quantity;
                    position.totalValue -= trade.quantity * trade.price;
                }
            });
            
            // Calculate stats for each position
            Object.keys(positions).forEach(symbol => {
                const position = positions[symbol];
                if (position.totalQuantity > 0) {
                    position.avgPrice = position.totalValue / position.totalQuantity;
                    
                    // Mock current price for P&L calculation
                    const currentPrice = position.avgPrice * (1 + (Math.random() - 0.5) * 0.1);
                    const positionValue = currentPrice * position.totalQuantity;
                    const pl = (currentPrice - position.avgPrice) * position.totalQuantity;
                    
                    totalValue += positionValue;
                    totalPL += pl;
                    totalTrades++;
                    
                    if (pl > 0) winCount++;
                }
            });
            
            const winRate = totalTrades > 0 ? (winCount / totalTrades) * 100 : 0;
            
            // Update UI
            document.getElementById('portfolioTotalValue').textContent = `$${totalValue.toFixed(2)}`;
            document.getElementById('portfolioTotalPL').textContent = `$${totalPL.toFixed(2)}`;
            document.getElementById('portfolioTotalPL').className = `text-lg font-bold ${totalPL >= 0 ? 'text-green-600' : 'text-red-600'}`;
            document.getElementById('portfolioWinRate').textContent = `${winRate.toFixed(1)}%`;
            
            // Update legacy portfolio stats
            document.getElementById('portfolioValue').textContent = `$${totalValue.toFixed(2)}`;
            document.getElementById('portfolioHoldings').textContent = Object.keys(positions).length;
        }

        // Watchlist Management Functions
        function showAddWatchlistModal() {
            document.getElementById('addWatchlistModal').classList.remove('hidden');
        }

        function hideAddWatchlistModal() {
            document.getElementById('addWatchlistModal').classList.add('hidden');
            document.getElementById('addWatchlistForm').reset();
        }

        function addWatchlistItem(event) {
            event.preventDefault();
            
            const symbol = document.getElementById('watchlistSymbol').value.toUpperCase();
            const targetPrice = parseFloat(document.getElementById('watchlistTargetPrice').value);
            const alertType = document.getElementById('watchlistAlertType').value;
            const notes = document.getElementById('watchlistNotes').value;
            
            if (!symbol || !targetPrice) {
                showFinancialNotification('Please fill in all required fields', 'error');
                return;
            }

            let watchlist = JSON.parse(localStorage.getItem('watchlist') || '[]');
            
            // Check if symbol already exists
            if (watchlist.find(item => item.symbol === symbol)) {
                showFinancialNotification(`${symbol} is already in your watchlist`, 'warning');
                return;
            }
            
            const watchlistItem = {
                id: Date.now(),
                symbol: symbol,
                targetPrice: targetPrice,
                alertType: alertType,
                notes: notes,
                dateAdded: new Date().toISOString(),
                currentPrice: targetPrice * (1 + (Math.random() - 0.5) * 0.2) // Mock current price
            };
            
            watchlist.push(watchlistItem);
            localStorage.setItem('watchlist', JSON.stringify(watchlist));
            updateWatchlistTable();
            hideAddWatchlistModal();
            showFinancialNotification(`${symbol} added to watchlist`, 'success');
        }

        function updateWatchlistTable() {
            const watchlist = JSON.parse(localStorage.getItem('watchlist') || '[]');
            const tableBody = document.getElementById('watchlistTable');
            
            if (watchlist.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="6" class="py-8 text-center text-gray-500">
                            <svg class="w-12 h-12 mx-auto mb-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                            </svg>
                            <p>No stocks in watchlist. Add stocks to track price targets.</p>
                        </td>
                    </tr>
                `;
                return;
            }

            tableBody.innerHTML = '';
            watchlist.forEach(item => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-100 hover:bg-gray-50';
                
                const percentToTarget = ((item.targetPrice - item.currentPrice) / item.currentPrice) * 100;
                const alertStatus = getAlertStatus(item.currentPrice, item.targetPrice, item.alertType);
                
                row.innerHTML = `
                    <td class="py-3 font-medium text-gray-900">${item.symbol}</td>
                    <td class="py-3 text-gray-700">$${item.currentPrice.toFixed(2)}</td>
                    <td class="py-3 text-gray-700">$${item.targetPrice.toFixed(2)}</td>
                    <td class="py-3 ${percentToTarget >= 0 ? 'text-green-600' : 'text-red-600'}">
                        ${percentToTarget >= 0 ? '+' : ''}${percentToTarget.toFixed(1)}%
                    </td>
                    <td class="py-3">
                        <span class="px-2 py-1 rounded-full text-xs font-medium ${alertStatus.class}">
                            ${alertStatus.text}
                        </span>
                    </td>
                    <td class="py-3">
                        <button onclick="removeWatchlistItem(${item.id})" class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-xs transition-colors">
                            Remove
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function getAlertStatus(currentPrice, targetPrice, alertType) {
            const diff = currentPrice - targetPrice;
            
            if (alertType === 'Above' && diff >= 0) {
                return { class: 'bg-green-100 text-green-800', text: 'Triggered' };
            } else if (alertType === 'Below' && diff <= 0) {
                return { class: 'bg-red-100 text-red-800', text: 'Triggered' };
            } else if (alertType === 'Both' && Math.abs(diff) <= targetPrice * 0.05) {
                return { class: 'bg-yellow-100 text-yellow-800', text: 'Near Target' };
            } else {
                return { class: 'bg-gray-100 text-gray-800', text: 'Watching' };
            }
        }

        function removeWatchlistItem(id) {
            let watchlist = JSON.parse(localStorage.getItem('watchlist') || '[]');
            watchlist = watchlist.filter(item => item.id !== id);
            localStorage.setItem('watchlist', JSON.stringify(watchlist));
            updateWatchlistTable();
            showFinancialNotification('Item removed from watchlist', 'success');
        }

        // Trade Journal Functions
        function showTradeJournalModal() {
            document.getElementById('tradeJournalModal').classList.remove('hidden');
            document.getElementById('journalDate').value = new Date().toISOString().split('T')[0];
        }

        function hideTradeJournalModal() {
            document.getElementById('tradeJournalModal').classList.add('hidden');
            document.getElementById('tradeJournalForm').reset();
        }

        function addJournalEntry(event) {
            event.preventDefault();
            
            const symbol = document.getElementById('journalSymbol').value.toUpperCase();
            const date = document.getElementById('journalDate').value;
            const entryPrice = parseFloat(document.getElementById('journalEntryPrice').value);
            const exitPrice = parseFloat(document.getElementById('journalExitPrice').value) || null;
            const positionSize = parseInt(document.getElementById('journalPositionSize').value);
            const tradeType = document.getElementById('journalTradeType').value;
            const strategy = document.getElementById('journalStrategy').value;
            const notes = document.getElementById('journalNotes').value;
            
            if (!symbol || !date || !entryPrice || !positionSize) {
                showFinancialNotification('Please fill in all required fields', 'error');
                return;
            }

            let journal = JSON.parse(localStorage.getItem('tradeJournal') || '[]');
            
            // Calculate P&L if exit price is provided
            let pl = 0;
            if (exitPrice) {
                pl = tradeType === 'Long' 
                    ? (exitPrice - entryPrice) * positionSize
                    : (entryPrice - exitPrice) * positionSize;
            }
            
            const journalEntry = {
                id: Date.now(),
                symbol: symbol,
                date: date,
                entryPrice: entryPrice,
                exitPrice: exitPrice,
                positionSize: positionSize,
                tradeType: tradeType,
                strategy: strategy,
                notes: notes,
                pl: pl,
                status: exitPrice ? 'Closed' : 'Open'
            };
            
            journal.push(journalEntry);
            localStorage.setItem('tradeJournal', JSON.stringify(journal));
            updateJournalTable();
            updateJournalStats();
            hideTradeJournalModal();
            showFinancialNotification('Journal entry added successfully', 'success');
        }

        function updateJournalTable() {
            const journal = JSON.parse(localStorage.getItem('tradeJournal') || '[]');
            const tableBody = document.getElementById('journalTable');
            
            if (journal.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="7" class="py-8 text-center text-gray-500">
                            <svg class="w-12 h-12 mx-auto mb-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                            </svg>
                            <p>No journal entries yet. Start documenting your trades.</p>
                        </td>
                    </tr>
                `;
                return;
            }

            tableBody.innerHTML = '';
            journal.forEach(entry => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-100 hover:bg-gray-50';
                
                const plClass = entry.pl > 0 ? 'text-green-600' : entry.pl < 0 ? 'text-red-600' : 'text-gray-600';
                const plSymbol = entry.pl > 0 ? '+' : '';
                
                row.innerHTML = `
                    <td class="py-3 text-gray-700">${new Date(entry.date).toLocaleDateString()}</td>
                    <td class="py-3 font-medium text-gray-900">${entry.symbol}</td>
                    <td class="py-3 text-gray-700">$${entry.entryPrice.toFixed(2)}</td>
                    <td class="py-3 text-gray-700">${entry.exitPrice ? '$' + entry.exitPrice.toFixed(2) : 'Open'}</td>
                    <td class="py-3 ${plClass} font-medium">${plSymbol}$${entry.pl.toFixed(2)}</td>
                    <td class="py-3 text-gray-700">${entry.notes.substring(0, 50)}${entry.notes.length > 50 ? '...' : ''}</td>
                    <td class="py-3">
                        <button onclick="removeJournalEntry(${entry.id})" class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-xs transition-colors">
                            Delete
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function updateJournalStats() {
            const journal = JSON.parse(localStorage.getItem('tradeJournal') || '[]');
            const closedTrades = journal.filter(entry => entry.status === 'Closed');
            
            const winningTrades = closedTrades.filter(entry => entry.pl > 0).length;
            const losingTrades = closedTrades.filter(entry => entry.pl < 0).length;
            const totalPL = closedTrades.reduce((sum, entry) => sum + entry.pl, 0);
            
            document.getElementById('winningTrades').textContent = winningTrades;
            document.getElementById('losingTrades').textContent = losingTrades;
            document.getElementById('totalPL').textContent = `$${totalPL.toFixed(2)}`;
            document.getElementById('totalPL').className = `text-2xl font-bold ${totalPL >= 0 ? 'text-green-600' : 'text-red-600'}`;
        }

        function removeJournalEntry(id) {
            let journal = JSON.parse(localStorage.getItem('tradeJournal') || '[]');
            journal = journal.filter(entry => entry.id !== id);
            localStorage.setItem('tradeJournal', JSON.stringify(journal));
            updateJournalTable();
            updateJournalStats();
            showFinancialNotification('Journal entry deleted', 'success');
        }

        function exportTradeJournal() {
            const journal = JSON.parse(localStorage.getItem('tradeJournal') || '[]');
            
            if (journal.length === 0) {
                showFinancialNotification('No journal entries to export', 'warning');
                return;
            }
            
            const csvContent = "Date,Symbol,Entry Price,Exit Price,Position Size,Trade Type,Strategy,P&L,Notes\n" +
                journal.map(entry => 
                    `${entry.date},${entry.symbol},${entry.entryPrice},${entry.exitPrice || 'Open'},${entry.positionSize},${entry.tradeType},${entry.strategy},${entry.pl},"${entry.notes}"`
                ).join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `trade-journal-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
            
            showFinancialNotification('Trade journal exported successfully', 'success');
        }

        // Portfolio Analytics Functions
        function refreshPortfolioAnalytics() {
            const trades = JSON.parse(localStorage.getItem('trades') || '[]');
            const journal = JSON.parse(localStorage.getItem('tradeJournal') || '[]');
            
            // Calculate portfolio analytics
            const positions = {};
            trades.forEach(trade => {
                if (!positions[trade.symbol]) {
                    positions[trade.symbol] = { totalQuantity: 0, totalValue: 0 };
                }
                
                if (trade.type === 'BUY') {
                    positions[trade.symbol].totalQuantity += trade.quantity;
                    positions[trade.symbol].totalValue += trade.quantity * trade.price;
                } else {
                    positions[trade.symbol].totalQuantity -= trade.quantity;
                    positions[trade.symbol].totalValue -= trade.quantity * trade.price;
                }
            });
            
            // Calculate metrics (mock data for demo)
            const beta = 1.2 + (Math.random() - 0.5) * 0.4;
            const sharpeRatio = 1.45 + (Math.random() - 0.5) * 0.3;
            const maxDrawdown = -12.3 + (Math.random() - 0.5) * 5;
            const volatility = 18.2 + (Math.random() - 0.5) * 6;
            
            // Update UI
            document.getElementById('portfolioBeta').textContent = beta.toFixed(2);
            document.getElementById('sharpeRatio').textContent = sharpeRatio.toFixed(2);
            document.getElementById('maxDrawdown').textContent = maxDrawdown.toFixed(1) + '%';
            document.getElementById('portfolioVolatility').textContent = volatility.toFixed(1) + '%';
            
            // Calculate performance metrics from journal
            const closedTrades = journal.filter(entry => entry.status === 'Closed');
            const totalPL = closedTrades.reduce((sum, entry) => sum + entry.pl, 0);
            const bestTrade = closedTrades.length > 0 ? Math.max(...closedTrades.map(t => t.pl)) : 0;
            const worstTrade = closedTrades.length > 0 ? Math.min(...closedTrades.map(t => t.pl)) : 0;
            const avgTrade = closedTrades.length > 0 ? totalPL / closedTrades.length : 0;
            
            document.getElementById('ytdReturn').textContent = `+${(24.5 + (Math.random() - 0.5) * 10).toFixed(1)}%`;
            document.getElementById('oneYearReturn').textContent = `+${(18.2 + (Math.random() - 0.5) * 8).toFixed(1)}%`;
            document.getElementById('bestTrade').textContent = `+$${bestTrade.toFixed(0)}`;
            document.getElementById('worstTrade').textContent = `${worstTrade.toFixed(0) >= 0 ? '+' : ''}$${worstTrade.toFixed(0)}`;
            document.getElementById('avgTrade').textContent = `${avgTrade.toFixed(0) >= 0 ? '+' : ''}$${avgTrade.toFixed(0)}`;
            
            showFinancialNotification('Portfolio analytics updated', 'success');
        }

        // Risk Management Functions
        function showRiskManagementModal() {
            // Simple alert for now - could be expanded to a full modal
            const currentRules = JSON.parse(localStorage.getItem('riskRules') || '{}');
            
            const positionLimit = prompt('Position Size Limit (% per trade):', currentRules.positionLimit || '5');
            const stopLoss = prompt('Default Stop Loss (%):', currentRules.stopLoss || '2');
            const dailyLossLimit = prompt('Daily Loss Limit ($):', currentRules.dailyLossLimit || '1000');
            
            if (positionLimit && stopLoss && dailyLossLimit) {
                const riskRules = {
                    positionLimit: parseFloat(positionLimit),
                    stopLoss: parseFloat(stopLoss),
                    dailyLossLimit: parseFloat(dailyLossLimit),
                    updatedAt: new Date().toISOString()
                };
                
                localStorage.setItem('riskRules', JSON.stringify(riskRules));
                updateRiskManagementDisplay();
                showFinancialNotification('Risk management rules updated', 'success');
            }
        }

        function updateRiskManagementDisplay() {
            const riskRules = JSON.parse(localStorage.getItem('riskRules') || '{}');
            const watchlist = JSON.parse(localStorage.getItem('watchlist') || '[]');
            
            // Update active alerts count
            const activeAlerts = watchlist.filter(item => {
                const alertStatus = getAlertStatus(item.currentPrice, item.targetPrice, item.alertType);
                return alertStatus.text === 'Triggered' || alertStatus.text === 'Near Target';
            }).length;
            
            document.getElementById('activeAlerts').textContent = activeAlerts;
            
            // Calculate risk score based on portfolio composition
            const trades = JSON.parse(localStorage.getItem('trades') || '[]');
            const uniqueSymbols = [...new Set(trades.map(t => t.symbol))];
            const riskScore = uniqueSymbols.length > 10 ? 'Low' : uniqueSymbols.length > 5 ? 'Medium' : 'High';
            
            document.getElementById('riskScore').textContent = riskScore;
            document.getElementById('stopLossCount').textContent = Math.min(trades.length, 7);
            
            // Update correlation risk based on sector concentration
            const techStocks = ['AAPL', 'MSFT', 'GOOGL', 'AMZN', 'TSLA'];
            const techCount = trades.filter(t => techStocks.includes(t.symbol)).length;
            const correlationRisk = techCount > trades.length * 0.6 ? 'High' : techCount > trades.length * 0.4 ? 'Medium' : 'Low';
            
            // This would update the correlation risk display if we had the element
            // document.getElementById('correlationRisk').textContent = correlationRisk;
        }

        // Investment calculator
        function calculateInvestment() {
            const initial = parseFloat(document.getElementById('initialInvestment').value) || 0;
            const monthly = parseFloat(document.getElementById('monthlyContribution').value) || 0;
            const rate = parseFloat(document.getElementById('expectedReturn').value) || 0;
            const years = 10; // Default to 10 years

            if (initial <= 0 && monthly <= 0) {
                showFinancialNotification('Please enter initial investment or monthly contribution', 'error');
                return;
            }

            const monthlyRate = rate / 100 / 12;
            const totalMonths = years * 12;
            
            // Future value of initial investment
            const futureValueInitial = initial * Math.pow(1 + monthlyRate, totalMonths);
            
            // Future value of monthly contributions
            const futureValueMonthly = monthly * ((Math.pow(1 + monthlyRate, totalMonths) - 1) / monthlyRate);
            
            const totalFutureValue = futureValueInitial + futureValueMonthly;
            const totalInvested = initial + (monthly * totalMonths);
            const totalGain = totalFutureValue - totalInvested;

            document.getElementById('calculationResult').innerHTML = `
                <div class="bg-green-50 p-4 rounded-lg">
                    <p class="text-sm text-gray-600">After ${years} years:</p>
                    <p class="text-xl font-bold text-green-600">$${totalFutureValue.toFixed(2)}</p>
                    <p class="text-sm text-gray-600">Total invested: $${totalInvested.toFixed(2)}</p>
                    <p class="text-sm text-green-600">Total gain: $${totalGain.toFixed(2)}</p>
                </div>
            `;
        }

        // Financial notification system
        function showFinancialNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg transform transition-all duration-300 ${
                type === 'success' ? 'bg-green-500' :
                type === 'error' ? 'bg-red-500' :
                type === 'warning' ? 'bg-yellow-500' :
                'bg-blue-500'
            } text-white`;
            
            notification.innerHTML = `
                <div class="flex items-center">
                    <span class="mr-2">${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-auto text-white hover:text-gray-200">×</button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

                 // Initialize financial analysis on page load
         document.addEventListener('DOMContentLoaded', function() {
             updatePortfolioTable();
             updatePortfolioStats();
             updateWatchlistTable();
             updateJournalTable();
             updateJournalStats();
             updateRiskManagementDisplay();
             refreshPortfolioAnalytics();
             
             // Update market status
             const now = new Date();
             const hour = now.getHours();
             const day = now.getDay();
             
             // Simple market hours check (9:30 AM - 4:00 PM EST, Monday-Friday)
             if (day >= 1 && day <= 5 && hour >= 9 && hour <= 16) {
                 document.getElementById('marketStatus').textContent = 'Open';
                 document.getElementById('marketStatus').className = 'text-2xl font-bold text-green-600';
                 document.getElementById('marketTime').textContent = 'Live trading';
             } else {
                 document.getElementById('marketStatus').textContent = 'Closed';
                 document.getElementById('marketStatus').className = 'text-2xl font-bold text-red-600';
                 document.getElementById('marketTime').textContent = 'Market closed';
             }

             // Initialize numerology forecast
             initializeNumerologyForecast();
         });

         // ==============================================
         // DAILY GLOBAL NUMEROLOGY SYSTEM (Steps 1-3)
         // ==============================================

         // Step 1: Backend Implementation (adapted for frontend)
         const numerologyInterpretations = {
             1: "Today's energy emphasizes new beginnings and leadership. Global events may focus on innovation, pioneering efforts, or taking decisive action. It's a day for independence and originality.",
             2: "Harmony and cooperation are highlighted. Expect guidance through collaboration, relationships, and partnerships. Global events may involve diplomatic efforts, partnerships, and collaborative actions.",
             3: "Creative expression and optimism dominate. Social interactions and artistic endeavors may shine. Communication, creative projects, and joyful activities are favored globally.",
             4: "A methodical energy prevails, focusing on stability and building secure foundations for the future. Global events may emphasize structure, discipline, and practical solutions.",
             5: "Change and freedom are in the air. Global events may involve dynamic shifts or a push for liberation. Travel, adventure, and breaking free from constraints are highlighted.",
             6: "Move, family, and community concerns take center stage. Efforts toward nurturing and social harmony are likely. Global events may focus on care, service, and community building.",
             7: "Introspection and spirituality are key. Global focus may turn to scientific or philosophical matters. Research, analysis, and seeking deeper truths are emphasized.",
             8: "Power and material success are emphasized. Economic or leadership-driven events may take center stage. Business achievements and material progress are in focus.",
             9: "Humanitarianism and completion resonate. Global attention may focus on aiding those in need or wrapping up significant projects. Service and completion are key themes.",
             11: "Inspiration and intuition are heightened. Expect visionary ideas or spiritual movements to gain prominence. Higher consciousness and enlightenment are featured.",
             22: "Practical idealism drives progress. Large-scale projects or cooperative efforts may shape the day. Master building and grand visions are highlighted.",
             33: "Compassion and teaching are prominent. Global efforts may center on uplifting communities, education, and healing. Service to humanity is the focus."
         };

         // Function to calculate universal day number (Step 1 backend logic)
         function calculateUniversalDayNumber(date) {
             const year = date.getFullYear();
             const month = date.getMonth() + 1; // Months are 0-based in JS
             const day = date.getDate();

             // Convert date to string and sum all digits
             const dateStr = `${year}${month < 10 ? '0' + month : month}${day < 10 ? '0' + day : day}`;
             let sum = dateStr.split('').reduce((acc, digit) => acc + parseInt(digit), 0);

             // Reduce to single digit or master number
             while (sum > 9 && ![11, 22, 33].includes(sum)) {
                 sum = sum.toString().split('').reduce((acc, digit) => acc + parseInt(digit), 0);
             }

             return sum;
         }

         // Get energy level description
         function getEnergyLevel(dayNumber) {
             const energyLevels = {
                 1: "High", 2: "Balanced", 3: "Creative", 4: "Steady", 5: "Dynamic",
                 6: "Nurturing", 7: "Introspective", 8: "Powerful", 9: "Transformative",
                 11: "Inspirational", 22: "Master Builder", 33: "Master Teacher"
             };
             return energyLevels[dayNumber] || "Unknown";
         }

         // Step 2: Frontend Implementation (adapted from React to vanilla JS)
         let numerologyRefreshInterval;
         let numerologyCountdownInterval;
         
         function initializeNumerologyForecast() {
             // Immediately fetch the forecast to ensure current date is displayed
             fetchNumerologyForecast();
             
             // Simulate loading for better UX on subsequent loads
             setTimeout(() => {
                 fetchNumerologyForecast();
             }, 1500);
             
             // Set up auto-refresh every 5 minutes
             numerologyRefreshInterval = setInterval(() => {
                 refreshNumerologyForecast();
             }, 300000); // 5 minutes = 300,000 ms
             
             // Also refresh every hour for more frequent updates
             setInterval(() => {
                 fetchNumerologyForecast();
             }, 3600000); // 1 hour = 3,600,000 ms
             
             // Start countdown timer after initial load
             setTimeout(() => {
                 if (numerologyCountdownInterval) clearInterval(numerologyCountdownInterval);
                 numerologyCountdownInterval = startNumerologyCountdown();
             }, 3000);
         }

         function fetchNumerologyForecast() {
             try {
                 const today = new Date();
                 const dayNumber = calculateUniversalDayNumber(today);
                 const forecast = numerologyInterpretations[dayNumber] || "No forecast available.";
                 const energyLevel = getEnergyLevel(dayNumber);

                 // Update the display
                 updateNumerologyDisplay({
                     date: today, // Pass the actual Date object instead of ISO string
                     universalDayNumber: dayNumber,
                     forecast: forecast,
                     energyLevel: energyLevel,
                     disclaimer: "These are global tendencies, not personal predictions. Free will prevails, and individual choices shape your day."
                 });

             } catch (error) {
                 console.error('Error calculating numerology forecast:', error);
                 showNumerologyError();
             }
         }

         function updateNumerologyDisplay(data) {
             // Hide loading and show content
             document.getElementById('numerologyLoading').style.display = 'none';
             document.getElementById('numerologyContent').classList.remove('hidden');

             // Update all the display elements - use the date object directly to avoid timezone issues
             document.getElementById('forecastDate').textContent = data.date.toLocaleDateString('en-US', {
                 weekday: 'long',
                 year: 'numeric',
                 month: 'long',
                 day: 'numeric'
             });
             document.getElementById('universalDayNumber').textContent = data.universalDayNumber;
             document.getElementById('energyLevel').textContent = data.energyLevel;
             document.getElementById('forecastText').textContent = data.forecast;
             document.getElementById('disclaimer').textContent = data.disclaimer;

             // Update timestamp information
             const now = new Date();
             document.getElementById('lastUpdated').textContent = `Last updated: ${now.toLocaleTimeString('en-US', { 
                 hour: '2-digit', 
                 minute: '2-digit',
                 second: '2-digit'
             })}`;
             
             // Calculate next update time (5 minutes from now)
             const nextUpdateTime = new Date(now.getTime() + 5 * 60 * 1000);
             document.getElementById('nextUpdate').textContent = `Next update: ${nextUpdateTime.toLocaleTimeString('en-US', { 
                 hour: '2-digit', 
                 minute: '2-digit'
             })}`;

             // Add animation effect
             document.getElementById('numerologyContent').classList.add('animate-fade-in');

             // Update additional insights
             updateNumerologyInsights(data.universalDayNumber);
             
             // Show success notification
             showNotification('Numerology forecast updated', 'success');
             
             // Restart countdown timer
             if (numerologyCountdownInterval) clearInterval(numerologyCountdownInterval);
             numerologyCountdownInterval = startNumerologyCountdown();
         }

         function updateNumerologyInsights(dayNumber) {
             // Update the insights section with relevant information
             const cyclePhases = {
                 1: "New Beginnings", 2: "Cooperation", 3: "Expression", 4: "Foundation",
                 5: "Freedom", 6: "Nurturing", 7: "Analysis", 8: "Achievement",
                 9: "Completion", 11: "Illumination", 22: "Master Building", 33: "Service"
             };

             // Use more dynamic trend calculation based on time and day number
             const hour = new Date().getHours();
             const trendIndex = (dayNumber + hour) % 4;
             const trends = ["↗ Rising", "↘ Declining", "↔ Stable", "🔄 Cycling"];
             
             document.getElementById('frequentNumber').textContent = dayNumber;
             document.getElementById('cyclePhase').textContent = cyclePhases[dayNumber] || "Unknown";
             document.getElementById('energyTrend').textContent = trends[trendIndex];
         }

         // Add countdown timer for next update
         let nextUpdateTime;
         
         function startNumerologyCountdown() {
             // Set next update time to 5 minutes from now
             nextUpdateTime = new Date(Date.now() + 5 * 60 * 1000);
             
             const countdownInterval = setInterval(() => {
                 const nextUpdateElement = document.getElementById('nextUpdate');
                 if (nextUpdateElement) {
                     const now = new Date();
                     const timeUntilNext = nextUpdateTime - now;
                     
                     if (timeUntilNext > 0) {
                         const minutes = Math.floor(timeUntilNext / 60000);
                         const seconds = Math.floor((timeUntilNext % 60000) / 1000);
                         nextUpdateElement.textContent = `Next update: ${minutes}m ${seconds}s`;
                     } else {
                         nextUpdateElement.textContent = 'Updating...';
                         // Trigger refresh when countdown reaches zero
                         setTimeout(() => {
                             refreshNumerologyForecast();
                         }, 1000);
                     }
                 }
             }, 1000);
             
             return countdownInterval;
         }

         function showNumerologyError() {
             document.getElementById('numerologyLoading').innerHTML = `
                 <div class="text-center py-8">
                     <svg class="w-12 h-12 mx-auto mb-4 text-red-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                     </svg>
                     <p>Unable to calculate today's forecast. Please try again later.</p>
                 </div>
             `;
         }

         // Step 3: Integration functionality
         // Add refresh functionality for numerology forecast
         function refreshNumerologyForecast() {
             const refreshButton = document.querySelector('button[onclick="refreshNumerologyForecast()"]');
             
             // Show loading state
             if (refreshButton) {
                 refreshButton.disabled = true;
                 refreshButton.innerHTML = '<svg class="w-4 h-4 mr-1 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>Refreshing...';
             }
             
             document.getElementById('numerologyLoading').style.display = 'block';
             document.getElementById('numerologyContent').classList.add('hidden');
             
             // Fetch with enhanced feedback
             setTimeout(() => {
                 fetchNumerologyForecast();
                 
                 // Restore button state
                 if (refreshButton) {
                     setTimeout(() => {
                         refreshButton.disabled = false;
                         refreshButton.innerHTML = '<svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>Refresh';
                     }, 2000);
                 }
             }, 500);
         }

         // Add CSS animation class
         const style = document.createElement('style');
         style.textContent = `
             .animate-fade-in {
                 animation: fadeIn 0.8s ease-in-out;
             }
             
             @keyframes fadeIn {
                 from { opacity: 0; transform: translateY(20px); }
                 to { opacity: 1; transform: translateY(0); }
             }
         `;
         document.head.appendChild(style);
    </script>
</body>
</html> 